<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ayrat Aymetov">

<title>Monte Carlo-Informed Selection of CUNY Retirement Plans – STA 9750 2024 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">

<script src="site_libs/datatables-binding-0.33/datatables.js"></script>

<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">

<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>

<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>



</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 2024 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#task-1---register-for-alphavantage-api-key" id="toc-task-1---register-for-alphavantage-api-key" class="nav-link active" data-scroll-target="#task-1---register-for-alphavantage-api-key">Task 1 - Register for AlphaVantage API Key</a></li>
  <li><a href="#task-2---register-for-fred-api-key" id="toc-task-2---register-for-fred-api-key" class="nav-link" data-scroll-target="#task-2---register-for-fred-api-key">Task 2 - Register for FRED API Key</a></li>
  <li><a href="#task-3---data-acquisition" id="toc-task-3---data-acquisition" class="nav-link" data-scroll-target="#task-3---data-acquisition">Task 3 - Data Acquisition</a></li>
  <li><a href="#task-4---initial-analysis" id="toc-task-4---initial-analysis" class="nav-link" data-scroll-target="#task-4---initial-analysis">Task 4 - Initial Analysis</a></li>
  <li><a href="#task-5---historical-comparison-of-trs-and-orp" id="toc-task-5---historical-comparison-of-trs-and-orp" class="nav-link" data-scroll-target="#task-5---historical-comparison-of-trs-and-orp">Task 5 - Historical Comparison of TRS and ORP</a></li>
  <li><a href="#task-6---fixed-rate-analysis" id="toc-task-6---fixed-rate-analysis" class="nav-link" data-scroll-target="#task-6---fixed-rate-analysis">Task 6 - Fixed-Rate Analysis</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Monte Carlo-Informed Selection of CUNY Retirement Plans</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Ayrat Aymetov </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>required_packages <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"httr"</span>, <span class="st">"jsonlite"</span>, <span class="st">"tidyverse"</span>, <span class="st">"DT"</span>, <span class="st">"patchwork"</span>, <span class="st">"sf"</span>, <span class="st">"scales"</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pkg <span class="cf">in</span> required_packages) {</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(pkg, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this project, we will analyze and compare CUNY’s two retirement plans: the Teachers Retirement System (TRS) and the Optional Retirement Plan (ORP). Using historical financial data from AlphaVantage and FRED, we will perform exploratory data analysis to identify key trends and compute long-term averages for economic indicators such as inflation, wage growth, and market returns.</p>
<p>Next, we will implement the TRS and ORP rules to simulate retirement contributions and benefits for a hypothetical CUNY employee. We will use bootstrap resampling and Monte Carlo simulations to create artificial economic histories, allowing us to estimate retirement outcomes under various scenarios.</p>
<p>Finally, we will evaluate and compare the plans based on metrics such as retirement wealth, probability of fund depletion, and potential inheritance. Based on this analysis, we will provide a data-driven recommendation to help a hypothetical employee make an informed decision about their retirement plan.</p>
<section id="task-1---register-for-alphavantage-api-key" class="level2">
<h2 class="anchored" data-anchor-id="task-1---register-for-alphavantage-api-key">Task 1 - Register for AlphaVantage API Key</h2>
<p>The AlphaVantage API key has been obtained and securely stored in a text file named alphavantage_key.txt. This file will be read in the project using the readLines function for secure and efficient access during data acquisition.</p>
</section>
<section id="task-2---register-for-fred-api-key" class="level2">
<h2 class="anchored" data-anchor-id="task-2---register-for-fred-api-key">Task 2 - Register for FRED API Key</h2>
<p>The FRED API key has also been obtained and stored in a text file named FRED_API_Key.txt. Similarly, this file will be accessed securely using the readLines function to fetch data from the FRED API as needed.</p>
</section>
<section id="task-3---data-acquisition" class="level2">
<h2 class="anchored" data-anchor-id="task-3---data-acquisition">Task 3 - Data Acquisition</h2>
<p>In this task, we will identify and download historical financial data for key economic indicators such as wage growth, inflation, equity market returns, bond market returns, and short-term debt returns. We will use the APIs of AlphaVantage and FRED to access at least one dataset from each source.</p>
</section>
<section id="task-4---initial-analysis" class="level2">
<h2 class="anchored" data-anchor-id="task-4---initial-analysis">Task 4 - Initial Analysis</h2>
<p>In Task 4, we performed an exploratory data analysis to examine the key properties of the input data. This included calculating analyzing trends, and visualizing correlations through tables and plots. By summarizing and visualizing the data, we gained insights into the relationships and patterns across different series, such as inflation, bond yields, and faculty income. These findings will support further analysis in the upcoming tasks.</p>
<p>Tasks 3 and 4 will be completed together</p>
<section id="fetching-etf-spy-that-tracks-the-sp-500-index-from-alphavantage.co" class="level4">
<h4 class="anchored" data-anchor-id="fetching-etf-spy-that-tracks-the-sp-500-index-from-alphavantage.co">Fetching ETF ‘Spy’ that tracks the S&amp;P 500 index from alphavantage.co</h4>
<p>Here we acquire historical monthly data for the S&amp;P 500 ETF (SPY) using the AlphaVantage API. If a local CSV file (SPY_monthly_data.csv) already exists, we will load it directly; otherwise, we will securely fetch, process, and save the data. This ensures we have clean and consistent financial data to analyze market trends and simulate retirement outcomes in later tasks.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading and processing S&amp;P 500 monthly data through SPY index</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>csv_file <span class="ot">&lt;-</span> <span class="st">"SPY_monthly_data.csv"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(csv_file)) {</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  api_key <span class="ot">&lt;-</span> <span class="fu">trimws</span>(<span class="fu">readLines</span>(<span class="st">"alphavantage_key.txt"</span>))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://www.alphavantage.co/query?"</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"function=TIME_SERIES_MONTHLY"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"&amp;symbol=SPY"</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"&amp;apikey="</span>, api_key</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  response <span class="ot">&lt;-</span> <span class="fu">GET</span>(url)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (response<span class="sc">$</span>status_code <span class="sc">!=</span> <span class="dv">200</span>) <span class="fu">stop</span>(<span class="st">"API request failed."</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">content</span>(response, <span class="st">"text"</span>) <span class="sc">|&gt;</span> <span class="fu">fromJSON</span>(<span class="at">flatten =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  monthly_data <span class="ot">&lt;-</span> data[[<span class="st">"Monthly Time Series"</span>]]</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  SPY_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">names</span>(monthly_data)),</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">close_value =</span> <span class="fu">map_dbl</span>(monthly_data, <span class="sc">~</span> <span class="fu">as.numeric</span>(.x[[<span class="st">"4. close"</span>]])),</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">symbol =</span> <span class="st">"SPY"</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(date, symbol, close_value) <span class="sc">|&gt;</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2005-01-01"</span>)) <span class="sc">|&gt;</span> <span class="do">## this is the time limit in all our data sets</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(date))</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(SPY_data, csv_file)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  SPY_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(csv_file)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  SPY_data <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">format</span>(date, <span class="st">"%Y-%m"</span>)),</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;"</span>,</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"S&amp;P 500 monthly close values in last 20 years"</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">10</span>,</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'lfrtip'</span>,</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">className =</span> <span class="st">"dt-center"</span>, <span class="at">targets =</span> <span class="st">"_all"</span>))</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatStyle</span>(</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">names</span>(SPY_data),</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">textAlign =</span> <span class="st">"center"</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-2bba433447ebd49487cc" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-2bba433447ebd49487cc">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;\">S&amp;P 500 monthly close values in last 20 years<\/caption>","data":[["2024-12","2024-11","2024-10","2024-09","2024-08","2024-07","2024-06","2024-05","2024-04","2024-03","2024-02","2024-01","2023-12","2023-11","2023-10","2023-09","2023-08","2023-07","2023-06","2023-05","2023-04","2023-03","2023-02","2023-01","2022-12","2022-11","2022-10","2022-09","2022-08","2022-07","2022-06","2022-05","2022-04","2022-03","2022-02","2022-01","2021-12","2021-11","2021-10","2021-09","2021-08","2021-07","2021-06","2021-05","2021-04","2021-03","2021-02","2021-01","2020-12","2020-11","2020-10","2020-09","2020-08","2020-07","2020-06","2020-05","2020-04","2020-03","2020-02","2020-01","2019-12","2019-11","2019-10","2019-09","2019-08","2019-07","2019-06","2019-05","2019-04","2019-03","2019-02","2019-01","2018-12","2018-11","2018-10","2018-09","2018-08","2018-07","2018-06","2018-05","2018-04","2018-03","2018-02","2018-01","2017-12","2017-11","2017-10","2017-09","2017-08","2017-07","2017-06","2017-05","2017-04","2017-03","2017-02","2017-01","2016-12","2016-11","2016-10","2016-09","2016-08","2016-07","2016-06","2016-05","2016-04","2016-03","2016-02","2016-01","2015-12","2015-11","2015-10","2015-09","2015-08","2015-07","2015-06","2015-05","2015-04","2015-03","2015-02","2015-01","2014-12","2014-11","2014-10","2014-09","2014-08","2014-07","2014-06","2014-05","2014-04","2014-03","2014-02","2014-01","2013-12","2013-11","2013-10","2013-09","2013-08","2013-07","2013-06","2013-05","2013-04","2013-03","2013-02","2013-01","2012-12","2012-11","2012-10","2012-09","2012-08","2012-07","2012-06","2012-05","2012-04","2012-03","2012-02","2012-01","2011-12","2011-11","2011-10","2011-09","2011-08","2011-07","2011-06","2011-05","2011-04","2011-03","2011-02","2011-01","2010-12","2010-11","2010-10","2010-09","2010-08","2010-07","2010-06","2010-05","2010-04","2010-03","2010-02","2010-01","2009-12","2009-11","2009-10","2009-09","2009-08","2009-07","2009-06","2009-05","2009-04","2009-03","2009-02","2009-01","2008-12","2008-11","2008-10","2008-09","2008-08","2008-07","2008-06","2008-05","2008-04","2008-03","2008-02","2008-01","2007-12","2007-11","2007-10","2007-09","2007-08","2007-07","2007-06","2007-05","2007-04","2007-03","2007-02","2007-01","2006-12","2006-11","2006-10","2006-09","2006-08","2006-07","2006-06","2006-05","2006-04","2006-03","2006-02","2006-01","2005-12","2005-11","2005-10","2005-09","2005-08","2005-07","2005-06","2005-05","2005-04","2005-03","2005-02","2005-01"],["SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY","SPY"],[607.8099999999999,602.55,568.64,573.76,563.6799999999999,550.8099999999999,544.22,527.37,501.98,523.0700000000001,508.08,482.88,475.31,456.4,418.2,427.48,450.35,457.79,443.28,417.85,415.93,409.39,396.26,406.48,382.43,407.68,386.21,357.18,395.18,411.99,377.25,412.93,412,451.64,436.63,449.91,474.96,455.56,459.25,429.14,451.56,438.51,428.06,420.04,417.3,396.33,380.36,370.07,373.88,362.06,326.54,334.89,349.31,326.52,308.36,304.32,290.48,257.75,296.26,321.73,321.86,314.31,303.33,296.77,292.45,297.43,293,275.27,294.02,282.48,278.68,269.93,249.92,275.65,270.63,290.72,290.31,281.33,271.28,270.94,264.51,263.15,271.65,281.9,266.86,265.01,257.15,251.23,247.49,246.77,241.8,241.44,238.08,235.74,236.47,227.53,223.53,220.38,212.55,216.3,217.38,217.12,209.48,209.84,206.33,205.52,193.56,193.72,203.87,208.69,207.93,191.59,197.54,210.45,205.89,211.14,208.46,206.43,210.66,199.45,205.54,207.2,201.66,197.02,200.71,193.09,195.72,192.68,188.31,187.01,186.29,178.18,184.69,181,175.79,168.01,163.65,168.71,160.42,163.45,159.68,156.67,151.61,149.7,142.41,142.15,141.35,143.97,141.16,137.71,136.1,131.47,139.87,140.81,137.02,131.32,125.5,124.99,125.5,113.15,122.22,129.33,131.97,134.9,136.43,132.59,133.15,128.68,125.75,118.49,118.49,114.13,105.31,110.27,103.22,109.37,118.81,117,110.74,107.39,111.44,109.94,103.56,105.59,102.46,98.81,91.95,92.53,87.42,79.52,73.93000000000001,82.83,90.23999999999999,90.09,96.83,115.99,128.79,126.83,127.98,140.35,138.26,131.97,133.82,137.37,146.21,148.66,154.65,152.58,147.59,145.72,150.43,153.32,148.29,142,140.93,143.75,141.62,140.53,137.79,133.58,130.64,127.85,127.28,127.51,131.47,129.83,128.23,127.5,124.51,125.41,120.13,123.04,122.58,123.74,119.18,119.48,115.75,117.96,120.63,118.16]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>date<\/th>\n      <th>symbol<\/th>\n      <th>close_value<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"dom":"lfrtip","columnDefs":[{"className":"dt-center","targets":"_all"},{"name":"date","targets":0},{"name":"symbol","targets":1},{"name":"close_value","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[0]; $(this.api().cell(row, 0).node()).css({'text-align':'center'});\nvar value=data[1]; $(this.api().cell(row, 1).node()).css({'text-align':'center'});\nvar value=data[2]; $(this.api().cell(row, 2).node()).css({'text-align':'center'});\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="fetching-international-equity-data-veu.-vanguard-ftse-all-world-ex-us-etf-from-alphavantage.co" class="level4">
<h4 class="anchored" data-anchor-id="fetching-international-equity-data-veu.-vanguard-ftse-all-world-ex-us-etf-from-alphavantage.co">Fetching International equity data (VEU). Vanguard FTSE All-World ex-US ETF from alphavantage.co</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Acquiring and processing international equity market data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>api_key <span class="ot">&lt;-</span> <span class="fu">trimws</span>(<span class="fu">readLines</span>(<span class="st">"alphavantage_key.txt"</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>csv_file <span class="ot">&lt;-</span> <span class="st">"international_equity_data.csv"</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>international_equity_data <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">file.exists</span>(csv_file)) {</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(csv_file, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  symbol <span class="ot">&lt;-</span> <span class="st">"VEU"</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://www.alphavantage.co/query?"</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"function=TIME_SERIES_MONTHLY"</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"&amp;symbol="</span>, symbol,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"&amp;apikey="</span>, api_key</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  response <span class="ot">&lt;-</span> <span class="fu">GET</span>(url)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (response<span class="sc">$</span>status_code <span class="sc">!=</span> <span class="dv">200</span>) <span class="fu">stop</span>(<span class="st">"API request failed."</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">content</span>(response, <span class="st">"text"</span>) <span class="sc">|&gt;</span> <span class="fu">fromJSON</span>(<span class="at">flatten =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  international_monthly_data <span class="ot">&lt;-</span> data[[<span class="st">"Monthly Time Series"</span>]]</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">names</span>(international_monthly_data)),</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">close_value =</span> <span class="fu">map_dbl</span>(international_monthly_data, <span class="sc">~</span> <span class="fu">as.numeric</span>(.x[[<span class="st">"4. close"</span>]])),</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">symbol =</span> symbol</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2005-01-01"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(date, symbol, close_value) <span class="sc">|&gt;</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(csv_file) <span class="sc">|&gt;</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(csv_file, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Rendering the data as an interactive table</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  international_equity_data <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">format</span>(date, <span class="st">"%Y-%m"</span>)),</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;"</span>,</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">"International Equity Market Returns (VEU)"</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">10</span>,</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'lfrtip'</span>,</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">className =</span> <span class="st">"dt-center"</span>, <span class="at">targets =</span> <span class="st">"_all"</span>))</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">'cell-border stripe'</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatStyle</span>(</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">names</span>(international_equity_data),</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">textAlign =</span> <span class="st">"center"</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-b3fab7d6d8808dec3b73" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b3fab7d6d8808dec3b73">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;\">International Equity Market Returns (VEU)<\/caption>","data":[["2007-04","2007-05","2007-06","2007-07","2007-08","2007-09","2007-10","2007-11","2007-12","2008-01","2008-02","2008-03","2008-04","2008-05","2008-06","2008-07","2008-08","2008-09","2008-10","2008-11","2008-12","2009-01","2009-02","2009-03","2009-04","2009-05","2009-06","2009-07","2009-08","2009-09","2009-10","2009-11","2009-12","2010-01","2010-02","2010-03","2010-04","2010-05","2010-06","2010-07","2010-08","2010-09","2010-10","2010-11","2010-12","2011-01","2011-02","2011-03","2011-04","2011-05","2011-06","2011-07","2011-08","2011-09","2011-10","2011-11","2011-12","2012-01","2012-02","2012-03","2012-04","2012-05","2012-06","2012-07","2012-08","2012-09","2012-10","2012-11","2012-12","2013-01","2013-02","2013-03","2013-04","2013-05","2013-06","2013-07","2013-08","2013-09","2013-10","2013-11","2013-12","2014-01","2014-02","2014-03","2014-04","2014-05","2014-06","2014-07","2014-08","2014-09","2014-10","2014-11","2014-12","2015-01","2015-02","2015-03","2015-04","2015-05","2015-06","2015-07","2015-08","2015-09","2015-10","2015-11","2015-12","2016-01","2016-02","2016-03","2016-04","2016-05","2016-06","2016-07","2016-08","2016-09","2016-10","2016-11","2016-12","2017-01","2017-02","2017-03","2017-04","2017-05","2017-06","2017-07","2017-08","2017-09","2017-10","2017-11","2017-12","2018-01","2018-02","2018-03","2018-04","2018-05","2018-06","2018-07","2018-08","2018-09","2018-10","2018-11","2018-12","2019-01","2019-02","2019-03","2019-04","2019-05","2019-06","2019-07","2019-08","2019-09","2019-10","2019-11","2019-12","2020-01","2020-02","2020-03","2020-04","2020-05","2020-06","2020-07","2020-08","2020-09","2020-10","2020-11","2020-12","2021-01","2021-02","2021-03","2021-04","2021-05","2021-06","2021-07","2021-08","2021-09","2021-10","2021-11","2021-12","2022-01","2022-02","2022-03","2022-04","2022-05","2022-06","2022-07","2022-08","2022-09","2022-10","2022-11","2022-12","2023-01","2023-02","2023-03","2023-04","2023-05","2023-06","2023-07","2023-08","2023-09","2023-10","2023-11","2023-12","2024-01","2024-02","2024-03","2024-04","2024-05","2024-06","2024-07","2024-08","2024-09","2024-10","2024-11","2024-12"],["VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU","VEU"],[54.8,56.62,57,56.34,56.23,59.69,63.49,60.34,58.609,54.07,53.95,53.9,57.09,57.9,53.05,51.1,48.45,42.44,32.78,30.56,32.32,28.12,25.53,28.12,31.84,36.67,35.91,39.72,40.88,43.2,41.83,43.86,43.61,41.1,41.64,44.44,43.66,38.9,38.38,42.51,41.05,45.4,47.03,45.1,47.73,48.11,49.43,49.32,52.01,50.36,49.81,48.63,44.51,38.72,43.17,42.06,39.65,42.37,44.62,44.22,43.42,38.47,40.98,41.18,42.27,42.96,43.29,44.07,45.75,46.86,46.21,46.36,48.1,46.51,44.22,46.3,45.38,48.6,50.22,50.39,50.73,47.79,50.48,50.31,51.05,52.03,52.29,51.52,52.04,49.24,49.34,49.18,46.86,46.85,49.59,48.73,51.04,50.51,48.55,48.41,44.66,42.63,45.48,44.88,43.41,40.98,39.98,43.15,44.06,43.71,42.85,44.67,44.98,45.43,44.66,43.71,44.18,46.01,46.59,47.83,48.83,50.32,50.03,51.72,52.05,52.71,53.74,54.08,54.72,57.84,54.77,54.37,54.68,53.59,51.84,53.34,52.09,52.05,47.73,48.43,45.58,49.03,49.83,50.15,51.58,48.72,50.99,50.07,48.85,49.9,51.62,52.16,53.75,51.92,48.49,41.02,43.81,45.86,47.61,49.48,51.66,50.45,49.41,55.64,58.36,58.58,59.8,60.68,62.24,64.20999999999999,63.39,62.49,63.44,60.96,62.63,59.94,61.28,59.81,57.98,57.59,53.86,54.74,49.96,51.65,49.38,44.36,45.87,51.9,50.14,54.5,52.11,53.47,54.48,52.62,54.41,56.46,53.98,51.87,50.21,54.34,56.14,55.21,56.96,58.65,57.18,59.44,58.64,60.13,61.68,63,60.14,59.91,60.58]],"container":"<table class=\"cell-border stripe\">\n  <thead>\n    <tr>\n      <th>date<\/th>\n      <th>symbol<\/th>\n      <th>close_value<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"dom":"lfrtip","columnDefs":[{"className":"dt-center","targets":"_all"},{"name":"date","targets":0},{"name":"symbol","targets":1},{"name":"close_value","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[0]; $(this.api().cell(row, 0).node()).css({'text-align':'center'});\nvar value=data[1]; $(this.api().cell(row, 1).node()).css({'text-align':'center'});\nvar value=data[2]; $(this.api().cell(row, 2).node()).css({'text-align':'center'});\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="lets-compare-the-sp500-and-veu-indexed-we-downloaded." class="level4">
<h4 class="anchored" data-anchor-id="lets-compare-the-sp500-and-veu-indexed-we-downloaded.">Let’s compare the S&amp;P500 and VEU indexed we downloaded.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Processing and visualizing SPY and international equity data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Processing SPY data</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>SPY_processed <span class="ot">&lt;-</span> SPY_data <span class="sc">|&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2005-01-01"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">baseline =</span> <span class="fu">first</span>(close_value),</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">percent_increase =</span> (close_value <span class="sc">/</span> baseline <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"SPY (S&amp;P 500)"</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, percent_increase, type)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Processing international equity data</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>international_processed <span class="ot">&lt;-</span> international_equity_data <span class="sc">|&gt;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2007-04-01"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(symbol) <span class="sc">|&gt;</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">baseline =</span> <span class="fu">first</span>(close_value),</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">percent_increase =</span> (close_value <span class="sc">/</span> baseline <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">paste0</span>(<span class="st">"International - "</span>, symbol)) <span class="sc">|&gt;</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, percent_increase, type)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Combining datasets</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(SPY_processed, international_processed)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizing percentage increases</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(combined_data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> percent_increase, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Percentage Increase Comparison: SPY (S&amp;P 500) vs. International Equities (VEU)"</span>,</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Percentage Increase (%)"</span>,</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Type"</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The graph clearly shows that U.S. stocks (S&amp;P 500) have significantly outperformed the global stock index (VEU) over the past 20 years.</p>
</section>
<section id="fetching-inflation-data-set-from-alphavantage.co" class="level4">
<h4 class="anchored" data-anchor-id="fetching-inflation-data-set-from-alphavantage.co">Fetching inflation data set from alphavantage.co</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Acquiring and processing US inflation data</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>csv_file <span class="ot">&lt;-</span> <span class="st">"US_inflation_data.csv"</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>inflation_data <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(csv_file)) {</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  api_key <span class="ot">&lt;-</span> <span class="fu">trimws</span>(<span class="fu">readLines</span>(<span class="st">"alphavantage_key.txt"</span>))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://www.alphavantage.co/query?"</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"function=INFLATION"</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"&amp;apikey="</span>, api_key</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  response <span class="ot">&lt;-</span> <span class="fu">GET</span>(url)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (response<span class="sc">$</span>status_code <span class="sc">!=</span> <span class="dv">200</span>) <span class="fu">stop</span>(<span class="st">"API request failed."</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">content</span>(response, <span class="st">"text"</span>) <span class="sc">|&gt;</span> <span class="fu">fromJSON</span>(<span class="at">flatten =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  data[[<span class="st">"data"</span>]] <span class="sc">|&gt;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">date =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">inflation_percent =</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(value), <span class="dv">1</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2005-01-01"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(date, inflation_percent) <span class="sc">|&gt;</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(csv_file) <span class="sc">|&gt;</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(csv_file)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(csv_file)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Rendering inflation data as an interactive table</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  inflation_data <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">format</span>(date, <span class="st">"%Y"</span>)),</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;"</span>,</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"US Inflation in the Last 20 Years"</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">10</span>,</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'lfrtip'</span>,</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">className =</span> <span class="st">"dt-center"</span>, <span class="at">targets =</span> <span class="st">"_all"</span>))</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">'cell-border stripe'</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatStyle</span>(</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">names</span>(inflation_data),</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">textAlign =</span> <span class="st">"center"</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-136983e8193778bf07a4" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-136983e8193778bf07a4">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;\">US Inflation in the Last 20 Years<\/caption>","data":[["2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020","2021","2022","2023"],[3.4,3.2,2.9,3.8,-0.4,1.6,3.2,2.1,1.5,1.6,0.1,1.3,2.1,2.4,1.8,1.2,4.7,8,4.1]],"container":"<table class=\"cell-border stripe\">\n  <thead>\n    <tr>\n      <th>date<\/th>\n      <th>inflation_percent<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"dom":"lfrtip","columnDefs":[{"className":"dt-center","targets":"_all"},{"name":"date","targets":0},{"name":"inflation_percent","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[0]; $(this.api().cell(row, 0).node()).css({'text-align':'center'});\nvar value=data[1]; $(this.api().cell(row, 1).node()).css({'text-align':'center'});\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="fetching-cpi-data-set-from-alphavantage.co" class="level4">
<h4 class="anchored" data-anchor-id="fetching-cpi-data-set-from-alphavantage.co">Fetching CPI data set from alphavantage.co</h4>
<p>Now we will download the CPI dataset, which will be used to calculate inflation rates and adjust pension benefits in our project. The table provides monthly inflation values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Acquiring and processing US Consumer Price Index (CPI) data</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>cpi_csv_file <span class="ot">&lt;-</span> <span class="st">"US_CPI_data.csv"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>cpi_data <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(cpi_csv_file)) {</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  api_key <span class="ot">&lt;-</span> <span class="fu">trimws</span>(<span class="fu">readLines</span>(<span class="st">"alphavantage_key.txt"</span>))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://www.alphavantage.co/query?"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"function=CPI"</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"&amp;interval=monthly"</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"&amp;apikey="</span>, api_key</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  response <span class="ot">&lt;-</span> <span class="fu">GET</span>(url)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (response<span class="sc">$</span>status_code <span class="sc">!=</span> <span class="dv">200</span>) <span class="fu">stop</span>(<span class="st">"API request failed."</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">content</span>(response, <span class="st">"text"</span>) <span class="sc">|&gt;</span> <span class="fu">fromJSON</span>(<span class="at">flatten =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  data[[<span class="st">"data"</span>]] <span class="sc">|&gt;</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">value =</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(value), <span class="dv">2</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2004-12-01"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">inflation =</span> <span class="fu">round</span>(((value <span class="sc">-</span> <span class="fu">lag</span>(value)) <span class="sc">/</span> <span class="fu">lag</span>(value)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(cpi_csv_file) <span class="sc">|&gt;</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(cpi_csv_file)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(cpi_csv_file)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Rendering CPI data as an interactive table</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  cpi_data <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">format</span>(date, <span class="st">"%Y-%m"</span>)),</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;"</span>,</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"US Consumer Price Index (CPI) - Monthly"</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">10</span>,</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'lfrtip'</span>,</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">className =</span> <span class="st">"dt-center"</span>, <span class="at">targets =</span> <span class="st">"_all"</span>))</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">'cell-border stripe'</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatStyle</span>(</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">names</span>(cpi_data),</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">textAlign =</span> <span class="st">"center"</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-255752af8e4a782a2ce2" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-255752af8e4a782a2ce2">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;\">US Consumer Price Index (CPI) - Monthly<\/caption>","data":[["2004-12","2005-01","2005-02","2005-03","2005-04","2005-05","2005-06","2005-07","2005-08","2005-09","2005-10","2005-11","2005-12","2006-01","2006-02","2006-03","2006-04","2006-05","2006-06","2006-07","2006-08","2006-09","2006-10","2006-11","2006-12","2007-01","2007-02","2007-03","2007-04","2007-05","2007-06","2007-07","2007-08","2007-09","2007-10","2007-11","2007-12","2008-01","2008-02","2008-03","2008-04","2008-05","2008-06","2008-07","2008-08","2008-09","2008-10","2008-11","2008-12","2009-01","2009-02","2009-03","2009-04","2009-05","2009-06","2009-07","2009-08","2009-09","2009-10","2009-11","2009-12","2010-01","2010-02","2010-03","2010-04","2010-05","2010-06","2010-07","2010-08","2010-09","2010-10","2010-11","2010-12","2011-01","2011-02","2011-03","2011-04","2011-05","2011-06","2011-07","2011-08","2011-09","2011-10","2011-11","2011-12","2012-01","2012-02","2012-03","2012-04","2012-05","2012-06","2012-07","2012-08","2012-09","2012-10","2012-11","2012-12","2013-01","2013-02","2013-03","2013-04","2013-05","2013-06","2013-07","2013-08","2013-09","2013-10","2013-11","2013-12","2014-01","2014-02","2014-03","2014-04","2014-05","2014-06","2014-07","2014-08","2014-09","2014-10","2014-11","2014-12","2015-01","2015-02","2015-03","2015-04","2015-05","2015-06","2015-07","2015-08","2015-09","2015-10","2015-11","2015-12","2016-01","2016-02","2016-03","2016-04","2016-05","2016-06","2016-07","2016-08","2016-09","2016-10","2016-11","2016-12","2017-01","2017-02","2017-03","2017-04","2017-05","2017-06","2017-07","2017-08","2017-09","2017-10","2017-11","2017-12","2018-01","2018-02","2018-03","2018-04","2018-05","2018-06","2018-07","2018-08","2018-09","2018-10","2018-11","2018-12","2019-01","2019-02","2019-03","2019-04","2019-05","2019-06","2019-07","2019-08","2019-09","2019-10","2019-11","2019-12","2020-01","2020-02","2020-03","2020-04","2020-05","2020-06","2020-07","2020-08","2020-09","2020-10","2020-11","2020-12","2021-01","2021-02","2021-03","2021-04","2021-05","2021-06","2021-07","2021-08","2021-09","2021-10","2021-11","2021-12","2022-01","2022-02","2022-03","2022-04","2022-05","2022-06","2022-07","2022-08","2022-09","2022-10","2022-11","2022-12","2023-01","2023-02","2023-03","2023-04","2023-05","2023-06","2023-07","2023-08","2023-09","2023-10","2023-11","2023-12","2024-01","2024-02","2024-03","2024-04","2024-05","2024-06","2024-07","2024-08","2024-09","2024-10"],[190.3,190.7,191.8,193.3,194.6,194.4,194.5,195.4,196.4,198.8,199.2,197.6,196.8,198.3,198.7,199.8,201.5,202.5,202.9,203.5,203.9,202.9,201.8,201.5,201.8,202.42,203.5,205.35,206.69,207.95,208.35,208.3,207.92,208.49,208.94,210.18,210.04,211.08,211.69,213.53,214.82,216.63,218.82,219.96,219.09,218.78,216.57,212.43,210.23,211.14,212.19,212.71,213.24,213.86,215.69,215.35,215.83,215.97,216.18,216.33,215.95,216.69,216.74,217.63,218.01,218.18,217.96,218.01,218.31,218.44,218.71,218.8,219.18,220.22,221.31,223.47,224.91,225.96,225.72,225.92,226.54,226.89,226.42,226.23,225.67,226.66,227.66,229.39,230.08,229.82,229.48,229.1,230.38,231.41,231.32,230.22,229.6,230.28,232.17,232.77,232.53,232.94,233.5,233.6,233.88,234.15,233.55,233.07,233.05,233.92,234.78,236.29,237.07,237.9,238.34,238.25,237.85,238.03,237.43,236.15,234.81,233.71,234.72,236.12,236.6,237.8,238.64,238.65,238.32,237.94,237.84,237.34,236.52,236.92,237.11,238.13,239.26,240.23,241.02,240.63,240.85,241.43,241.73,241.35,241.43,242.84,243.6,243.8,244.52,244.73,244.96,244.79,245.52,246.82,246.66,246.67,246.52,247.87,248.99,249.55,250.55,251.59,251.99,252.01,252.15,252.44,252.88,252.04,251.23,251.71,252.78,254.2,255.55,256.09,256.14,256.57,256.56,256.76,257.35,257.21,256.97,257.97,258.68,258.12,256.39,256.39,257.8,259.1,259.92,260.28,260.39,260.23,260.47,261.58,263.01,264.88,267.05,269.2,271.7,273,273.57,274.31,276.59,277.95,278.8,281.15,283.72,287.5,289.11,292.3,296.31,296.28,296.17,296.81,298.01,297.71,296.8,299.17,300.84,301.84,303.36,304.13,305.11,305.69,307.03,307.79,307.67,307.05,306.75,308.42,310.33,312.33,313.55,314.07,314.18,314.54,314.8,315.3,315.66],[null,0.21,0.58,0.78,0.67,-0.1,0.05,0.46,0.51,1.22,0.2,-0.8,-0.4,0.76,0.2,0.55,0.85,0.5,0.2,0.3,0.2,-0.49,-0.54,-0.15,0.15,0.31,0.53,0.91,0.65,0.61,0.19,-0.02,-0.18,0.27,0.22,0.59,-0.07000000000000001,0.5,0.29,0.87,0.6,0.84,1.01,0.52,-0.4,-0.14,-1.01,-1.91,-1.04,0.43,0.5,0.25,0.25,0.29,0.86,-0.16,0.22,0.06,0.1,0.07000000000000001,-0.18,0.34,0.02,0.41,0.17,0.08,-0.1,0.02,0.14,0.06,0.12,0.04,0.17,0.47,0.49,0.98,0.64,0.47,-0.11,0.09,0.27,0.15,-0.21,-0.08,-0.25,0.44,0.44,0.76,0.3,-0.11,-0.15,-0.17,0.5600000000000001,0.45,-0.04,-0.48,-0.27,0.3,0.82,0.26,-0.1,0.18,0.24,0.04,0.12,0.12,-0.26,-0.21,-0.01,0.37,0.37,0.64,0.33,0.35,0.18,-0.04,-0.17,0.08,-0.25,-0.54,-0.57,-0.47,0.43,0.6,0.2,0.51,0.35,0,-0.14,-0.16,-0.04,-0.21,-0.35,0.17,0.08,0.43,0.47,0.41,0.33,-0.16,0.09,0.24,0.12,-0.16,0.03,0.58,0.31,0.08,0.3,0.09,0.09,-0.07000000000000001,0.3,0.53,-0.06,0,-0.06,0.55,0.45,0.22,0.4,0.42,0.16,0.01,0.06,0.12,0.17,-0.33,-0.32,0.19,0.43,0.5600000000000001,0.53,0.21,0.02,0.17,-0,0.08,0.23,-0.05,-0.09,0.39,0.28,-0.22,-0.67,0,0.55,0.5,0.32,0.14,0.04,-0.06,0.09,0.43,0.55,0.71,0.82,0.8100000000000001,0.93,0.48,0.21,0.27,0.83,0.49,0.31,0.84,0.91,1.33,0.5600000000000001,1.1,1.37,-0.01,-0.04,0.22,0.4,-0.1,-0.31,0.8,0.5600000000000001,0.33,0.5,0.25,0.32,0.19,0.44,0.25,-0.04,-0.2,-0.1,0.54,0.62,0.64,0.39,0.17,0.04,0.11,0.08,0.16,0.11]],"container":"<table class=\"cell-border stripe\">\n  <thead>\n    <tr>\n      <th>date<\/th>\n      <th>value<\/th>\n      <th>inflation<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"dom":"lfrtip","columnDefs":[{"className":"dt-center","targets":"_all"},{"name":"date","targets":0},{"name":"value","targets":1},{"name":"inflation","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[0]; $(this.api().cell(row, 0).node()).css({'text-align':'center'});\nvar value=data[1]; $(this.api().cell(row, 1).node()).css({'text-align':'center'});\nvar value=data[2]; $(this.api().cell(row, 2).node()).css({'text-align':'center'});\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="fetching-treasury_yield-data-from-alphavantage.co-bond-returns-and-short-term-debt-returns" class="level4">
<h4 class="anchored" data-anchor-id="fetching-treasury_yield-data-from-alphavantage.co-bond-returns-and-short-term-debt-returns">Fetching TREASURY_YIELD Data from alphavantage.co (Bond Returns and Short Term Debt Returns)</h4>
<p>We will download the TREASURY_YIELD dataset, which provides percentage yields for various bonds, including 2-year and 10-year bonds, to use in our data analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetching Treasury yield data and processing for analysis</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>api_key <span class="ot">&lt;-</span> <span class="fu">trimws</span>(<span class="fu">readLines</span>(<span class="st">"alphavantage_key.txt"</span>))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>fetch_treasury_yield <span class="ot">&lt;-</span> <span class="cf">function</span>(interval, maturity) {</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://www.alphavantage.co/query?"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"function=TREASURY_YIELD"</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"&amp;interval="</span>, interval,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"&amp;maturity="</span>, maturity,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"&amp;apikey="</span>, api_key</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  response <span class="ot">&lt;-</span> <span class="fu">GET</span>(url)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (response<span class="sc">$</span>status_code <span class="sc">!=</span> <span class="dv">200</span>) {</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"API request failed. Status code: "</span>, response<span class="sc">$</span>status_code)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">content</span>(response, <span class="st">"text"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fromJSON</span>(<span class="at">flatten =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  yield_data <span class="ot">&lt;-</span> data[[<span class="st">"data"</span>]] <span class="sc">|&gt;</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">date =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">yield_percent =</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(value), <span class="dv">2</span>)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2005-01-01"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(date, yield_percent)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(yield_data)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparing file names and variables for storing results</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>bond_file <span class="ot">&lt;-</span> <span class="st">"10year_bond_returns.csv"</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>short_term_file <span class="ot">&lt;-</span> <span class="st">"2year_short_term_debt.csv"</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>bond_returns <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>short_term_debt <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetching 10-year bond returns or loading from a local file</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(bond_file)) {</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>  bond_returns <span class="ot">&lt;-</span> <span class="fu">fetch_treasury_yield</span>(<span class="at">interval =</span> <span class="st">"monthly"</span>, <span class="at">maturity =</span> <span class="st">"10year"</span>)</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(bond_returns, bond_file)</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetching 2-year short-term debt returns or loading from a local file</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(short_term_file)) {</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>  short_term_debt <span class="ot">&lt;-</span> <span class="fu">fetch_treasury_yield</span>(<span class="at">interval =</span> <span class="st">"monthly"</span>, <span class="at">maturity =</span> <span class="st">"2year"</span>)</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(short_term_debt, short_term_file)</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>bond_returns <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(bond_file)</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>short_term_debt <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(short_term_file)</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizing bond returns data as an interactive table</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>  bond_returns <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">format</span>(date, <span class="st">"%Y-%m"</span>)),</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;"</span>,</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>    <span class="st">"10-Year Bond Returns"</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">10</span>,</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'lfrtip'</span>,</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">className =</span> <span class="st">"dt-center"</span>, <span class="at">targets =</span> <span class="st">"_all"</span>))</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">'cell-border stripe'</span></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatStyle</span>(</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">names</span>(bond_returns),</span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">textAlign =</span> <span class="st">"center"</span></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-edcd750d9cfd64508774" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-edcd750d9cfd64508774">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;\">10-Year Bond Returns<\/caption>","data":[["2024-11","2024-10","2024-09","2024-08","2024-07","2024-06","2024-05","2024-04","2024-03","2024-02","2024-01","2023-12","2023-11","2023-10","2023-09","2023-08","2023-07","2023-06","2023-05","2023-04","2023-03","2023-02","2023-01","2022-12","2022-11","2022-10","2022-09","2022-08","2022-07","2022-06","2022-05","2022-04","2022-03","2022-02","2022-01","2021-12","2021-11","2021-10","2021-09","2021-08","2021-07","2021-06","2021-05","2021-04","2021-03","2021-02","2021-01","2020-12","2020-11","2020-10","2020-09","2020-08","2020-07","2020-06","2020-05","2020-04","2020-03","2020-02","2020-01","2019-12","2019-11","2019-10","2019-09","2019-08","2019-07","2019-06","2019-05","2019-04","2019-03","2019-02","2019-01","2018-12","2018-11","2018-10","2018-09","2018-08","2018-07","2018-06","2018-05","2018-04","2018-03","2018-02","2018-01","2017-12","2017-11","2017-10","2017-09","2017-08","2017-07","2017-06","2017-05","2017-04","2017-03","2017-02","2017-01","2016-12","2016-11","2016-10","2016-09","2016-08","2016-07","2016-06","2016-05","2016-04","2016-03","2016-02","2016-01","2015-12","2015-11","2015-10","2015-09","2015-08","2015-07","2015-06","2015-05","2015-04","2015-03","2015-02","2015-01","2014-12","2014-11","2014-10","2014-09","2014-08","2014-07","2014-06","2014-05","2014-04","2014-03","2014-02","2014-01","2013-12","2013-11","2013-10","2013-09","2013-08","2013-07","2013-06","2013-05","2013-04","2013-03","2013-02","2013-01","2012-12","2012-11","2012-10","2012-09","2012-08","2012-07","2012-06","2012-05","2012-04","2012-03","2012-02","2012-01","2011-12","2011-11","2011-10","2011-09","2011-08","2011-07","2011-06","2011-05","2011-04","2011-03","2011-02","2011-01","2010-12","2010-11","2010-10","2010-09","2010-08","2010-07","2010-06","2010-05","2010-04","2010-03","2010-02","2010-01","2009-12","2009-11","2009-10","2009-09","2009-08","2009-07","2009-06","2009-05","2009-04","2009-03","2009-02","2009-01","2008-12","2008-11","2008-10","2008-09","2008-08","2008-07","2008-06","2008-05","2008-04","2008-03","2008-02","2008-01","2007-12","2007-11","2007-10","2007-09","2007-08","2007-07","2007-06","2007-05","2007-04","2007-03","2007-02","2007-01","2006-12","2006-11","2006-10","2006-09","2006-08","2006-07","2006-06","2006-05","2006-04","2006-03","2006-02","2006-01","2005-12","2005-11","2005-10","2005-09","2005-08","2005-07","2005-06","2005-05","2005-04","2005-03","2005-02","2005-01"],[4.36,4.1,3.72,3.87,4.25,4.31,4.48,4.54,4.21,4.21,4.06,4.02,4.5,4.8,4.38,4.17,3.9,3.75,3.57,3.46,3.66,3.75,3.53,3.62,3.89,3.98,3.52,2.9,2.9,3.14,2.9,2.75,2.13,1.93,1.76,1.47,1.56,1.58,1.37,1.28,1.32,1.52,1.62,1.64,1.61,1.26,1.08,0.93,0.87,0.79,0.68,0.65,0.62,0.73,0.67,0.66,0.87,1.5,1.76,1.86,1.81,1.71,1.7,1.63,2.06,2.07,2.4,2.53,2.57,2.68,2.71,2.83,3.12,3.15,3,2.89,2.89,2.91,2.98,2.87,2.84,2.86,2.58,2.4,2.35,2.36,2.2,2.21,2.32,2.19,2.3,2.3,2.48,2.42,2.43,2.49,2.14,1.76,1.63,1.56,1.5,1.64,1.81,1.81,1.89,1.78,2.09,2.24,2.26,2.07,2.17,2.17,2.32,2.36,2.2,1.94,2.04,1.98,1.88,2.21,2.33,2.3,2.53,2.42,2.54,2.6,2.56,2.71,2.72,2.71,2.86,2.9,2.72,2.62,2.81,2.74,2.58,2.3,1.93,1.76,1.96,1.98,1.91,1.72,1.65,1.75,1.72,1.68,1.53,1.62,1.8,2.05,2.17,1.97,1.97,1.98,2.01,2.15,1.98,2.3,3,3,3.17,3.46,3.41,3.58,3.39,3.29,2.76,2.54,2.65,2.7,3.01,3.2,3.42,3.85,3.73,3.69,3.73,3.59,3.4,3.39,3.4,3.59,3.56,3.72,3.29,2.93,2.82,2.87,2.52,2.42,3.53,3.81,3.69,3.89,4.01,4.1,3.88,3.68,3.51,3.74,3.74,4.1,4.15,4.53,4.52,4.67,5,5.1,4.75,4.69,4.56,4.72,4.76,4.56,4.6,4.73,4.72,4.88,5.09,5.11,5.11,4.99,4.72,4.57,4.42,4.47,4.54,4.46,4.2,4.26,4.18,4,4.14,4.34,4.5,4.17,4.22]],"container":"<table class=\"cell-border stripe\">\n  <thead>\n    <tr>\n      <th>date<\/th>\n      <th>yield_percent<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"dom":"lfrtip","columnDefs":[{"className":"dt-center","targets":"_all"},{"name":"date","targets":0},{"name":"yield_percent","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[0]; $(this.api().cell(row, 0).node()).css({'text-align':'center'});\nvar value=data[1]; $(this.api().cell(row, 1).node()).css({'text-align':'center'});\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizing short-term debt data as an interactive table</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  short_term_debt <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">format</span>(date, <span class="st">"%Y-%m"</span>)),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2-Year Short-Term Debt Returns"</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">10</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'lfrtip'</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">className =</span> <span class="st">"dt-center"</span>, <span class="at">targets =</span> <span class="st">"_all"</span>))</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">'cell-border stripe'</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatStyle</span>(</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">names</span>(short_term_debt),</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">textAlign =</span> <span class="st">"center"</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-190437245f801d5e7ba4" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-190437245f801d5e7ba4">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;\">2-Year Short-Term Debt Returns<\/caption>","data":[["2024-11","2024-10","2024-09","2024-08","2024-07","2024-06","2024-05","2024-04","2024-03","2024-02","2024-01","2023-12","2023-11","2023-10","2023-09","2023-08","2023-07","2023-06","2023-05","2023-04","2023-03","2023-02","2023-01","2022-12","2022-11","2022-10","2022-09","2022-08","2022-07","2022-06","2022-05","2022-04","2022-03","2022-02","2022-01","2021-12","2021-11","2021-10","2021-09","2021-08","2021-07","2021-06","2021-05","2021-04","2021-03","2021-02","2021-01","2020-12","2020-11","2020-10","2020-09","2020-08","2020-07","2020-06","2020-05","2020-04","2020-03","2020-02","2020-01","2019-12","2019-11","2019-10","2019-09","2019-08","2019-07","2019-06","2019-05","2019-04","2019-03","2019-02","2019-01","2018-12","2018-11","2018-10","2018-09","2018-08","2018-07","2018-06","2018-05","2018-04","2018-03","2018-02","2018-01","2017-12","2017-11","2017-10","2017-09","2017-08","2017-07","2017-06","2017-05","2017-04","2017-03","2017-02","2017-01","2016-12","2016-11","2016-10","2016-09","2016-08","2016-07","2016-06","2016-05","2016-04","2016-03","2016-02","2016-01","2015-12","2015-11","2015-10","2015-09","2015-08","2015-07","2015-06","2015-05","2015-04","2015-03","2015-02","2015-01","2014-12","2014-11","2014-10","2014-09","2014-08","2014-07","2014-06","2014-05","2014-04","2014-03","2014-02","2014-01","2013-12","2013-11","2013-10","2013-09","2013-08","2013-07","2013-06","2013-05","2013-04","2013-03","2013-02","2013-01","2012-12","2012-11","2012-10","2012-09","2012-08","2012-07","2012-06","2012-05","2012-04","2012-03","2012-02","2012-01","2011-12","2011-11","2011-10","2011-09","2011-08","2011-07","2011-06","2011-05","2011-04","2011-03","2011-02","2011-01","2010-12","2010-11","2010-10","2010-09","2010-08","2010-07","2010-06","2010-05","2010-04","2010-03","2010-02","2010-01","2009-12","2009-11","2009-10","2009-09","2009-08","2009-07","2009-06","2009-05","2009-04","2009-03","2009-02","2009-01","2008-12","2008-11","2008-10","2008-09","2008-08","2008-07","2008-06","2008-05","2008-04","2008-03","2008-02","2008-01","2007-12","2007-11","2007-10","2007-09","2007-08","2007-07","2007-06","2007-05","2007-04","2007-03","2007-02","2007-01","2006-12","2006-11","2006-10","2006-09","2006-08","2006-07","2006-06","2006-05","2006-04","2006-03","2006-02","2006-01","2005-12","2005-11","2005-10","2005-09","2005-08","2005-07","2005-06","2005-05","2005-04","2005-03","2005-02","2005-01"],[4.26,3.97,3.62,3.97,4.5,4.74,4.86,4.87,4.59,4.54,4.32,4.46,4.88,5.07,5.02,4.9,4.83,4.64,4.13,4.02,4.3,4.53,4.21,4.29,4.5,4.38,3.86,3.25,3.04,3,2.62,2.54,1.91,1.44,0.98,0.68,0.51,0.39,0.24,0.22,0.22,0.2,0.16,0.16,0.15,0.12,0.13,0.14,0.17,0.15,0.13,0.14,0.15,0.19,0.17,0.22,0.45,1.33,1.52,1.61,1.61,1.55,1.65,1.57,1.84,1.81,2.21,2.34,2.41,2.5,2.54,2.68,2.86,2.86,2.77,2.64,2.61,2.53,2.51,2.38,2.28,2.18,2.03,1.84,1.7,1.55,1.38,1.34,1.37,1.34,1.3,1.24,1.31,1.2,1.21,1.2,0.98,0.84,0.77,0.74,0.67,0.73,0.82,0.77,0.88,0.73,0.9,0.98,0.88,0.64,0.71,0.7,0.67,0.6899999999999999,0.61,0.54,0.64,0.62,0.55,0.64,0.53,0.45,0.57,0.47,0.51,0.45,0.39,0.42,0.4,0.33,0.39,0.34,0.3,0.34,0.4,0.36,0.34,0.33,0.25,0.23,0.26,0.27,0.27,0.26,0.27,0.28,0.26,0.27,0.25,0.29,0.29,0.29,0.34,0.28,0.24,0.26,0.25,0.28,0.21,0.23,0.41,0.41,0.5600000000000001,0.73,0.7,0.77,0.61,0.62,0.45,0.38,0.48,0.52,0.62,0.72,0.83,1.06,0.96,0.86,0.93,0.87,0.8,0.95,0.96,1.12,1.02,1.18,0.93,0.93,0.93,0.98,0.8100000000000001,0.82,1.21,1.61,2.08,2.42,2.57,2.77,2.45,2.05,1.62,1.97,2.48,3.12,3.34,3.97,4.01,4.31,4.82,4.98,4.77,4.67,4.57,4.85,4.88,4.67,4.74,4.8,4.77,4.9,5.12,5.12,4.97,4.89,4.73,4.67,4.4,4.4,4.42,4.27,3.95,4.04,3.87,3.64,3.64,3.65,3.73,3.38,3.22]],"container":"<table class=\"cell-border stripe\">\n  <thead>\n    <tr>\n      <th>date<\/th>\n      <th>yield_percent<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"dom":"lfrtip","columnDefs":[{"className":"dt-center","targets":"_all"},{"name":"date","targets":0},{"name":"yield_percent","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[0]; $(this.api().cell(row, 0).node()).css({'text-align':'center'});\nvar value=data[1]; $(this.api().cell(row, 1).node()).css({'text-align':'center'});\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="a-comparison-of-inflation-short-term-2-year-bonds-and-long-term-10-year-bonds-over-the-past-20-years." class="level4">
<h4 class="anchored" data-anchor-id="a-comparison-of-inflation-short-term-2-year-bonds-and-long-term-10-year-bonds-over-the-past-20-years.">A comparison of inflation, short-term (2-year) bonds, and long-term (10-year) bonds over the past 20 years.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Processing and visualizing debt and inflation data trends</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>debt_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  short_term_debt <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"Short-Term Bond"</span>),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  bond_returns <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"Long-Term Bond"</span>),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  inflation_data <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"Inflation"</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(date, <span class="at">yield_percent =</span> inflation_percent, type)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(debt_data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> yield_percent, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">filter</span>(debt_data, type <span class="sc">!=</span> <span class="st">"Inflation"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(debt_data, type <span class="sc">==</span> <span class="st">"Inflation"</span>), </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">span =</span> <span class="fl">0.3</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Inflation, Short-Term, and Long-Term Bond Returns Trends"</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Yield (%) or Inflation (%)"</span>,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Type"</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Inflation"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"Short-Term Bond"</span> <span class="ot">=</span> <span class="st">"green"</span>, <span class="st">"Long-Term Bond"</span> <span class="ot">=</span> <span class="st">"red"</span>),</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Inflation"</span>, <span class="st">"Short-Term Bond"</span>, <span class="st">"Long-Term Bond"</span>)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">"%Y"</span>, <span class="at">date_breaks =</span> <span class="st">"2 years"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This plot illustrates the trends of inflation, short-term (2-year) bonds, and long-term (10-year) bonds over the past 20 years.</p>
</section>
<section id="fetching-median-cuny-faculty-income-usd-data-set-from-fred" class="level4">
<h4 class="anchored" data-anchor-id="fetching-median-cuny-faculty-income-usd-data-set-from-fred">Fetching Median CUNY Faculty Income (USD) data set from FRED</h4>
<p>I downloaded the median household income dataset for New York State from FRED and compared it to the median CUNY faculty salary obtained from various websites. To approximate the CUNY faculty salary, I calculated 90% of the median household income. This approach was necessary because I could not find a dedicated dataset for CUNY faculty salaries in FRED or AlphaVantage.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading the FRED API key</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>api_key <span class="ot">&lt;-</span> <span class="fu">trimws</span>(<span class="fu">readLines</span>(<span class="st">"FRED_API_Key.txt"</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting up the series ID and output file for data storage</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>series_id <span class="ot">&lt;-</span> <span class="st">"MEHOINUSNYA646N"</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>output_file <span class="ot">&lt;-</span> <span class="st">"CUNY_faculty_Income.csv"</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking if the output file already exists</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(output_file)) {</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reading data from the existing CSV file</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  cuny_faculty_income <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(output_file, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fetching data from the FRED API</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://api.stlouisfed.org/fred/series/observations?"</span>,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"series_id="</span>, series_id,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"&amp;api_key="</span>, api_key,</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"&amp;file_type=json"</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  response <span class="ot">&lt;-</span> <span class="fu">GET</span>(url)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Stopping execution if the API request fails</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (response<span class="sc">$</span>status_code <span class="sc">!=</span> <span class="dv">200</span>) {</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"API request failed. Status code: "</span>, response<span class="sc">$</span>status_code)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Parsing the JSON response and extracting observations</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">content</span>(response, <span class="st">"text"</span>) <span class="sc">|&gt;</span> <span class="fu">fromJSON</span>(<span class="at">flatten =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  observations <span class="ot">&lt;-</span> data<span class="sc">$</span>observations</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cleaning and transforming the fetched data</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  cuny_faculty_income <span class="ot">&lt;-</span> observations <span class="sc">|&gt;</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">date =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">value =</span> <span class="fu">as.numeric</span>(value)</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2005-01-01"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(date, value) <span class="sc">|&gt;</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Median Household Income (USD)"</span> <span class="ot">=</span> value</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>      <span class="st">"CUNY Faculty Income (USD)"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Median Household Income (USD)</span><span class="st">`</span> <span class="sc">*</span> <span class="fl">0.9</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(date, <span class="st">"CUNY Faculty Income (USD)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(date)</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Saving the processed data to a CSV file</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(cuny_faculty_income, output_file)</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Displaying the processed data as an interactive table</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>  cuny_faculty_income <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">format</span>(date, <span class="st">"%Y"</span>)),</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;"</span>,</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Median CUNY Faculty Income (USD) in Last 20 Years"</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">colnames =</span> <span class="fu">c</span>(<span class="st">"Year"</span>, <span class="st">"CUNY Faculty Income (USD)"</span>),</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">10</span>,</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'lfrtip'</span>,</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">className =</span> <span class="st">"dt-center"</span>, <span class="at">targets =</span> <span class="st">"_all"</span>))</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">'cell-border stripe'</span></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatStyle</span>(</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">names</span>(cuny_faculty_income),</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">textAlign =</span> <span class="st">"center"</span></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-c20275e5e609ef542f62" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c20275e5e609ef542f62">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;\">Median CUNY Faculty Income (USD) in Last 20 Years<\/caption>","data":[["2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020","2021","2022","2023"],[42462,43398,44046,45414,45198,44802,45576,42912,44973,48879,52209,55296,55386,60543,64665,61794,65628,68319,73440]],"container":"<table class=\"cell-border stripe\">\n  <thead>\n    <tr>\n      <th>Year<\/th>\n      <th>CUNY Faculty Income (USD)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"dom":"lfrtip","columnDefs":[{"className":"dt-center","targets":"_all"},{"name":"date","targets":0},{"name":"CUNY Faculty Income (USD)","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[0]; $(this.api().cell(row, 0).node()).css({'text-align':'center'});\nvar value=data[1]; $(this.api().cell(row, 1).node()).css({'text-align':'center'});\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="task-5---historical-comparison-of-trs-and-orp" class="level2">
<h2 class="anchored" data-anchor-id="task-5---historical-comparison-of-trs-and-orp">Task 5 - Historical Comparison of TRS and ORP</h2>
<p>In this task, we will implement TRS and ORP formulas to compare their values at retirement. Using historical data on wage growth and inflation, we will calculate contributions and benefits for a hypothetical employee who worked at CUNY from the first to the last month of the data. This analysis will highlight the relative performance of both plans.</p>
<section id="teachers-retirement-system" class="level4">
<h4 class="anchored" data-anchor-id="teachers-retirement-system">Teachers Retirement System</h4>
<p>Let’s begin this the Teachers Retirement System. The Teachers Retirement System (TRS) is a defined-benefit pension plan where CUNY guarantees a fraction of an employee’s salary as a retirement benefit. Contributions are a fixed percentage of salary, and benefits are based on the Final Average Salary (FAS) over the last three years of service and the number of years worked. After retirement, benefits are adjusted annually based on inflation.</p>
<p>In this task, we will calculate the TRS pension for a hypothetical employee using historical income data, determining their FAS, years of service, and annual and monthly benefits.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating TRS benefits for a hypothetical CUNY employee</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>cuny_income <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"CUNY_faculty_Income.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">as.character</span>(date), <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>final_years <span class="ot">&lt;-</span> <span class="fu">filter</span>(cuny_income, date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2020-01-01"</span>))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(final_years) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">stop</span>(<span class="st">"No data available for the last three years."</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>FAS <span class="ot">&lt;-</span> <span class="fu">mean</span>(final_years<span class="sc">$</span><span class="st">`</span><span class="at">CUNY Faculty Income (USD)</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">2023</span> <span class="sc">-</span> <span class="dv">2005</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>annual_benefit <span class="ot">&lt;-</span> <span class="cf">if</span> (N <span class="sc">&lt;</span> <span class="dv">20</span>) {</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.0167</span> <span class="sc">*</span> FAS <span class="sc">*</span> N</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (N <span class="sc">==</span> <span class="dv">20</span>) {</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.0175</span> <span class="sc">*</span> FAS <span class="sc">*</span> N</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  (<span class="fl">0.35</span> <span class="sc">+</span> <span class="fl">0.02</span> <span class="sc">*</span> (N <span class="sc">-</span> <span class="dv">20</span>)) <span class="sc">*</span> FAS</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>monthly_benefit <span class="ot">&lt;-</span> <span class="fu">round</span>(annual_benefit <span class="sc">/</span> <span class="dv">12</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"Final Average Salary (FAS)"</span>, <span class="st">"Years of Work (N)"</span>, <span class="st">"Annual Benefit (pension)"</span>, <span class="st">"Monthly Benefit (pension)"</span>),</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">Value =</span> <span class="fu">c</span>(<span class="fu">round</span>(FAS, <span class="dv">2</span>), N, <span class="fu">round</span>(annual_benefit, <span class="dv">2</span>), monthly_benefit)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  results,</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;"</span>,</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Teachers Retirement System Calculations"</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'t'</span>,</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">ordering =</span> <span class="cn">FALSE</span>,</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">className =</span> <span class="st">"dt-center"</span>, <span class="at">targets =</span> <span class="st">"_all"</span>))</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">'cell-border stripe'</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatStyle</span>(</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">names</span>(results),</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">textAlign =</span> <span class="st">"center"</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-9596364d189482c1b47a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9596364d189482c1b47a">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;\">Teachers Retirement System Calculations<\/caption>","data":[["Final Average Salary (FAS)","Years of Work (N)","Annual Benefit (pension)","Monthly Benefit (pension)"],[67295.25,19,21352.78,1779]],"container":"<table class=\"cell-border stripe\">\n  <thead>\n    <tr>\n      <th>Metric<\/th>\n      <th>Value<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","ordering":false,"columnDefs":[{"className":"dt-center","targets":"_all"},{"name":"Metric","targets":0},{"name":"Value","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[0]; $(this.api().cell(row, 0).node()).css({'text-align':'center'});\nvar value=data[1]; $(this.api().cell(row, 1).node()).css({'text-align':'center'});\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="optional-retirement-plan" class="level4">
<h4 class="anchored" data-anchor-id="optional-retirement-plan">Optional Retirement Plan</h4>
<p>Now let’s calcualte the Optional Retirement Plan.</p>
<section id="preparing-salary-and-contribution-data" class="level5">
<h5 class="anchored" data-anchor-id="preparing-salary-and-contribution-data">Preparing Salary and Contribution Data</h5>
<p>This code chunk defines the employment period and processes the CUNY faculty salary data to calculate monthly income. It then determines the employee and employer contributions to the pension fund based on salary brackets and historical rules. The results are structured into a dataset of monthly contributions, which includes details like age, monthly income, and contributions. This data is displayed in an interactive table for review.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating contributions and preparing data for retirement analysis</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>retirement_age <span class="ot">&lt;-</span> <span class="dv">65</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>employment_start_year <span class="ot">&lt;-</span> <span class="dv">2005</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>employment_end_year <span class="ot">&lt;-</span> <span class="dv">2023</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>starting_age <span class="ot">&lt;-</span> retirement_age <span class="sc">-</span> (employment_end_year <span class="sc">-</span> employment_start_year <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Processing CUNY faculty salary data and calculating monthly income</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>cuny_faculty_salary <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"CUNY_faculty_Income.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">annual_income =</span> <span class="st">`</span><span class="at">CUNY Faculty Income (USD)</span><span class="st">`</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">monthly_income =</span> annual_income <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">monthly_data =</span> <span class="fu">list</span>(</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tibble</span>(</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">month =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>,</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">year =</span> <span class="fu">year</span>(date),</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">monthly_income =</span> monthly_income</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(monthly_data, <span class="at">names_sep =</span> <span class="st">"_"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">sprintf</span>(<span class="st">"%d-%02d-01"</span>, monthly_data_year, monthly_data_month))) <span class="sc">|&gt;</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, monthly_data_monthly_income) <span class="sc">|&gt;</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">monthly_income =</span> monthly_data_monthly_income)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Processing market data for US equities, international equities, and bonds</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>us_equities <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"SPY_monthly_data.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">us_return =</span> close_value)</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>international_equities <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"international_equity_data.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">int_return =</span> close_value)</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>bonds <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"10year_bond_returns.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">bond_return =</span> yield_percent)</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating contributions based on income and historical rules</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>monthly_contributions <span class="ot">&lt;-</span> cuny_faculty_salary <span class="sc">|&gt;</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> starting_age <span class="sc">+</span> <span class="fu">year</span>(date) <span class="sc">-</span> employment_start_year,</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">employee_contribution =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>      date <span class="sc">&lt;</span> <span class="fu">as.Date</span>(<span class="st">"2012-03-31"</span>) <span class="sc">~</span> monthly_income <span class="sc">*</span> <span class="fl">0.03</span>,</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>      monthly_income <span class="sc">&lt;=</span> <span class="dv">45000</span> <span class="sc">/</span> <span class="dv">12</span> <span class="sc">~</span> monthly_income <span class="sc">*</span> <span class="fl">0.03</span>,</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>      monthly_income <span class="sc">&lt;=</span> <span class="dv">55000</span> <span class="sc">/</span> <span class="dv">12</span> <span class="sc">~</span> monthly_income <span class="sc">*</span> <span class="fl">0.035</span>,</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>      monthly_income <span class="sc">&lt;=</span> <span class="dv">75000</span> <span class="sc">/</span> <span class="dv">12</span> <span class="sc">~</span> monthly_income <span class="sc">*</span> <span class="fl">0.045</span>,</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>      monthly_income <span class="sc">&lt;=</span> <span class="dv">100000</span> <span class="sc">/</span> <span class="dv">12</span> <span class="sc">~</span> monthly_income <span class="sc">*</span> <span class="fl">0.0575</span>,</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> monthly_income <span class="sc">*</span> <span class="fl">0.06</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">employer_contribution =</span> <span class="fu">ifelse</span>(</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">year</span>(date) <span class="sc">-</span> employment_start_year <span class="sc">&lt;</span> <span class="dv">7</span>, </span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>      monthly_income <span class="sc">*</span> <span class="fl">0.08</span>, </span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>      monthly_income <span class="sc">*</span> <span class="fl">0.10</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_contribution =</span> employee_contribution <span class="sc">+</span> employer_contribution</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2005-01-01"</span>) <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2023-12-31"</span>))</span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Displaying contributions in an interactive table</span></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>  monthly_contributions <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">format</span>(date, <span class="st">"%Y - %m"</span>)),</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;"</span>,</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Monthly Contributions to the Pension Plan"</span></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">colnames =</span> <span class="fu">c</span>(<span class="st">"Year"</span>, <span class="st">"Monthly Income"</span>, <span class="st">"Age"</span>, <span class="st">"Employee Contribution"</span>, <span class="st">"Employer Contribution"</span>, <span class="st">"Total Contribution"</span>),</span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">10</span>,</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'lfrtip'</span>,</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">className =</span> <span class="st">"dt-center"</span>, <span class="at">targets =</span> <span class="st">"_all"</span>))</span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">'cell-border stripe'</span></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatStyle</span>(</span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">names</span>(monthly_contributions),</span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">textAlign =</span> <span class="st">"center"</span></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-cb8ec8ed8be3a0ca075a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-cb8ec8ed8be3a0ca075a">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;\">Monthly Contributions to the Pension Plan<\/caption>","data":[["2005 - 01","2005 - 02","2005 - 03","2005 - 04","2005 - 05","2005 - 06","2005 - 07","2005 - 08","2005 - 09","2005 - 10","2005 - 11","2005 - 12","2006 - 01","2006 - 02","2006 - 03","2006 - 04","2006 - 05","2006 - 06","2006 - 07","2006 - 08","2006 - 09","2006 - 10","2006 - 11","2006 - 12","2007 - 01","2007 - 02","2007 - 03","2007 - 04","2007 - 05","2007 - 06","2007 - 07","2007 - 08","2007 - 09","2007 - 10","2007 - 11","2007 - 12","2008 - 01","2008 - 02","2008 - 03","2008 - 04","2008 - 05","2008 - 06","2008 - 07","2008 - 08","2008 - 09","2008 - 10","2008 - 11","2008 - 12","2009 - 01","2009 - 02","2009 - 03","2009 - 04","2009 - 05","2009 - 06","2009 - 07","2009 - 08","2009 - 09","2009 - 10","2009 - 11","2009 - 12","2010 - 01","2010 - 02","2010 - 03","2010 - 04","2010 - 05","2010 - 06","2010 - 07","2010 - 08","2010 - 09","2010 - 10","2010 - 11","2010 - 12","2011 - 01","2011 - 02","2011 - 03","2011 - 04","2011 - 05","2011 - 06","2011 - 07","2011 - 08","2011 - 09","2011 - 10","2011 - 11","2011 - 12","2012 - 01","2012 - 02","2012 - 03","2012 - 04","2012 - 05","2012 - 06","2012 - 07","2012 - 08","2012 - 09","2012 - 10","2012 - 11","2012 - 12","2013 - 01","2013 - 02","2013 - 03","2013 - 04","2013 - 05","2013 - 06","2013 - 07","2013 - 08","2013 - 09","2013 - 10","2013 - 11","2013 - 12","2014 - 01","2014 - 02","2014 - 03","2014 - 04","2014 - 05","2014 - 06","2014 - 07","2014 - 08","2014 - 09","2014 - 10","2014 - 11","2014 - 12","2015 - 01","2015 - 02","2015 - 03","2015 - 04","2015 - 05","2015 - 06","2015 - 07","2015 - 08","2015 - 09","2015 - 10","2015 - 11","2015 - 12","2016 - 01","2016 - 02","2016 - 03","2016 - 04","2016 - 05","2016 - 06","2016 - 07","2016 - 08","2016 - 09","2016 - 10","2016 - 11","2016 - 12","2017 - 01","2017 - 02","2017 - 03","2017 - 04","2017 - 05","2017 - 06","2017 - 07","2017 - 08","2017 - 09","2017 - 10","2017 - 11","2017 - 12","2018 - 01","2018 - 02","2018 - 03","2018 - 04","2018 - 05","2018 - 06","2018 - 07","2018 - 08","2018 - 09","2018 - 10","2018 - 11","2018 - 12","2019 - 01","2019 - 02","2019 - 03","2019 - 04","2019 - 05","2019 - 06","2019 - 07","2019 - 08","2019 - 09","2019 - 10","2019 - 11","2019 - 12","2020 - 01","2020 - 02","2020 - 03","2020 - 04","2020 - 05","2020 - 06","2020 - 07","2020 - 08","2020 - 09","2020 - 10","2020 - 11","2020 - 12","2021 - 01","2021 - 02","2021 - 03","2021 - 04","2021 - 05","2021 - 06","2021 - 07","2021 - 08","2021 - 09","2021 - 10","2021 - 11","2021 - 12","2022 - 01","2022 - 02","2022 - 03","2022 - 04","2022 - 05","2022 - 06","2022 - 07","2022 - 08","2022 - 09","2022 - 10","2022 - 11","2022 - 12","2023 - 01","2023 - 02","2023 - 03","2023 - 04","2023 - 05","2023 - 06","2023 - 07","2023 - 08","2023 - 09","2023 - 10","2023 - 11","2023 - 12"],[3538.5,3538.5,3538.5,3538.5,3538.5,3538.5,3538.5,3538.5,3538.5,3538.5,3538.5,3538.5,3616.5,3616.5,3616.5,3616.5,3616.5,3616.5,3616.5,3616.5,3616.5,3616.5,3616.5,3616.5,3670.5,3670.5,3670.5,3670.5,3670.5,3670.5,3670.5,3670.5,3670.5,3670.5,3670.5,3670.5,3784.5,3784.5,3784.5,3784.5,3784.5,3784.5,3784.5,3784.5,3784.5,3784.5,3784.5,3784.5,3766.5,3766.5,3766.5,3766.5,3766.5,3766.5,3766.5,3766.5,3766.5,3766.5,3766.5,3766.5,3733.5,3733.5,3733.5,3733.5,3733.5,3733.5,3733.5,3733.5,3733.5,3733.5,3733.5,3733.5,3798,3798,3798,3798,3798,3798,3798,3798,3798,3798,3798,3798,3576,3576,3576,3576,3576,3576,3576,3576,3576,3576,3576,3576,3747.75,3747.75,3747.75,3747.75,3747.75,3747.75,3747.75,3747.75,3747.75,3747.75,3747.75,3747.75,4073.25,4073.25,4073.25,4073.25,4073.25,4073.25,4073.25,4073.25,4073.25,4073.25,4073.25,4073.25,4350.75,4350.75,4350.75,4350.75,4350.75,4350.75,4350.75,4350.75,4350.75,4350.75,4350.75,4350.75,4608,4608,4608,4608,4608,4608,4608,4608,4608,4608,4608,4608,4615.5,4615.5,4615.5,4615.5,4615.5,4615.5,4615.5,4615.5,4615.5,4615.5,4615.5,4615.5,5045.25,5045.25,5045.25,5045.25,5045.25,5045.25,5045.25,5045.25,5045.25,5045.25,5045.25,5045.25,5388.75,5388.75,5388.75,5388.75,5388.75,5388.75,5388.75,5388.75,5388.75,5388.75,5388.75,5388.75,5149.5,5149.5,5149.5,5149.5,5149.5,5149.5,5149.5,5149.5,5149.5,5149.5,5149.5,5149.5,5469,5469,5469,5469,5469,5469,5469,5469,5469,5469,5469,5469,5693.25,5693.25,5693.25,5693.25,5693.25,5693.25,5693.25,5693.25,5693.25,5693.25,5693.25,5693.25,6120,6120,6120,6120,6120,6120,6120,6120,6120,6120,6120,6120],[46,46,46,46,46,46,46,46,46,46,46,46,47,47,47,47,47,47,47,47,47,47,47,47,48,48,48,48,48,48,48,48,48,48,48,48,49,49,49,49,49,49,49,49,49,49,49,49,50,50,50,50,50,50,50,50,50,50,50,50,51,51,51,51,51,51,51,51,51,51,51,51,52,52,52,52,52,52,52,52,52,52,52,52,53,53,53,53,53,53,53,53,53,53,53,53,54,54,54,54,54,54,54,54,54,54,54,54,55,55,55,55,55,55,55,55,55,55,55,55,56,56,56,56,56,56,56,56,56,56,56,56,57,57,57,57,57,57,57,57,57,57,57,57,58,58,58,58,58,58,58,58,58,58,58,58,59,59,59,59,59,59,59,59,59,59,59,59,60,60,60,60,60,60,60,60,60,60,60,60,61,61,61,61,61,61,61,61,61,61,61,61,62,62,62,62,62,62,62,62,62,62,62,62,63,63,63,63,63,63,63,63,63,63,63,63,64,64,64,64,64,64,64,64,64,64,64,64],[106.155,106.155,106.155,106.155,106.155,106.155,106.155,106.155,106.155,106.155,106.155,106.155,108.495,108.495,108.495,108.495,108.495,108.495,108.495,108.495,108.495,108.495,108.495,108.495,110.115,110.115,110.115,110.115,110.115,110.115,110.115,110.115,110.115,110.115,110.115,110.115,113.535,113.535,113.535,113.535,113.535,113.535,113.535,113.535,113.535,113.535,113.535,113.535,112.995,112.995,112.995,112.995,112.995,112.995,112.995,112.995,112.995,112.995,112.995,112.995,112.005,112.005,112.005,112.005,112.005,112.005,112.005,112.005,112.005,112.005,112.005,112.005,113.94,113.94,113.94,113.94,113.94,113.94,113.94,113.94,113.94,113.94,113.94,113.94,107.28,107.28,107.28,107.28,107.28,107.28,107.28,107.28,107.28,107.28,107.28,107.28,112.4325,112.4325,112.4325,112.4325,112.4325,112.4325,112.4325,112.4325,112.4325,112.4325,112.4325,112.4325,142.56375,142.56375,142.56375,142.56375,142.56375,142.56375,142.56375,142.56375,142.56375,142.56375,142.56375,142.56375,152.27625,152.27625,152.27625,152.27625,152.27625,152.27625,152.27625,152.27625,152.27625,152.27625,152.27625,152.27625,207.36,207.36,207.36,207.36,207.36,207.36,207.36,207.36,207.36,207.36,207.36,207.36,207.6975,207.6975,207.6975,207.6975,207.6975,207.6975,207.6975,207.6975,207.6975,207.6975,207.6975,207.6975,227.03625,227.03625,227.03625,227.03625,227.03625,227.03625,227.03625,227.03625,227.03625,227.03625,227.03625,227.03625,242.49375,242.49375,242.49375,242.49375,242.49375,242.49375,242.49375,242.49375,242.49375,242.49375,242.49375,242.49375,231.7275,231.7275,231.7275,231.7275,231.7275,231.7275,231.7275,231.7275,231.7275,231.7275,231.7275,231.7275,246.105,246.105,246.105,246.105,246.105,246.105,246.105,246.105,246.105,246.105,246.105,246.105,256.19625,256.19625,256.19625,256.19625,256.19625,256.19625,256.19625,256.19625,256.19625,256.19625,256.19625,256.19625,275.4,275.4,275.4,275.4,275.4,275.4,275.4,275.4,275.4,275.4,275.4,275.4],[283.08,283.08,283.08,283.08,283.08,283.08,283.08,283.08,283.08,283.08,283.08,283.08,289.32,289.32,289.32,289.32,289.32,289.32,289.32,289.32,289.32,289.32,289.32,289.32,293.64,293.64,293.64,293.64,293.64,293.64,293.64,293.64,293.64,293.64,293.64,293.64,302.76,302.76,302.76,302.76,302.76,302.76,302.76,302.76,302.76,302.76,302.76,302.76,301.32,301.32,301.32,301.32,301.32,301.32,301.32,301.32,301.32,301.32,301.32,301.32,298.68,298.68,298.68,298.68,298.68,298.68,298.68,298.68,298.68,298.68,298.68,298.68,303.84,303.84,303.84,303.84,303.84,303.84,303.84,303.84,303.84,303.84,303.84,303.84,357.6,357.6,357.6,357.6,357.6,357.6,357.6,357.6,357.6,357.6,357.6,357.6,374.775,374.775,374.775,374.775,374.775,374.775,374.775,374.775,374.775,374.775,374.775,374.775,407.325,407.325,407.325,407.325,407.325,407.325,407.325,407.325,407.325,407.325,407.325,407.325,435.075,435.075,435.075,435.075,435.075,435.075,435.075,435.075,435.075,435.075,435.075,435.075,460.8,460.8,460.8,460.8,460.8,460.8,460.8,460.8,460.8,460.8,460.8,460.8,461.55,461.55,461.55,461.55,461.55,461.55,461.55,461.55,461.55,461.55,461.55,461.55,504.525,504.525,504.525,504.525,504.525,504.525,504.525,504.525,504.525,504.525,504.525,504.525,538.875,538.875,538.875,538.875,538.875,538.875,538.875,538.875,538.875,538.875,538.875,538.875,514.95,514.95,514.95,514.95,514.95,514.95,514.95,514.95,514.95,514.95,514.95,514.95,546.9,546.9,546.9,546.9,546.9,546.9,546.9,546.9,546.9,546.9,546.9,546.9,569.325,569.325,569.325,569.325,569.325,569.325,569.325,569.325,569.325,569.325,569.325,569.325,612,612,612,612,612,612,612,612,612,612,612,612],[389.235,389.235,389.235,389.235,389.235,389.235,389.235,389.235,389.235,389.235,389.235,389.235,397.815,397.815,397.815,397.815,397.815,397.815,397.815,397.815,397.815,397.815,397.815,397.815,403.755,403.755,403.755,403.755,403.755,403.755,403.755,403.755,403.755,403.755,403.755,403.755,416.295,416.295,416.295,416.295,416.295,416.295,416.295,416.295,416.295,416.295,416.295,416.295,414.315,414.315,414.315,414.315,414.315,414.315,414.315,414.315,414.315,414.315,414.315,414.315,410.685,410.685,410.685,410.685,410.685,410.685,410.685,410.685,410.685,410.685,410.685,410.685,417.78,417.78,417.78,417.78,417.78,417.78,417.78,417.78,417.78,417.78,417.78,417.78,464.88,464.88,464.88,464.88,464.88,464.88,464.88,464.88,464.88,464.88,464.88,464.88,487.2075,487.2075,487.2075,487.2075,487.2075,487.2075,487.2075,487.2075,487.2075,487.2075,487.2075,487.2075,549.8887500000001,549.8887500000001,549.8887500000001,549.8887500000001,549.8887500000001,549.8887500000001,549.8887500000001,549.8887500000001,549.8887500000001,549.8887500000001,549.8887500000001,549.8887500000001,587.3512500000001,587.3512500000001,587.3512500000001,587.3512500000001,587.3512500000001,587.3512500000001,587.3512500000001,587.3512500000001,587.3512500000001,587.3512500000001,587.3512500000001,587.3512500000001,668.16,668.16,668.16,668.16,668.16,668.16,668.16,668.16,668.16,668.16,668.16,668.16,669.2474999999999,669.2474999999999,669.2474999999999,669.2474999999999,669.2474999999999,669.2474999999999,669.2474999999999,669.2474999999999,669.2474999999999,669.2474999999999,669.2474999999999,669.2474999999999,731.56125,731.56125,731.56125,731.56125,731.56125,731.56125,731.56125,731.56125,731.56125,731.56125,731.56125,731.56125,781.36875,781.36875,781.36875,781.36875,781.36875,781.36875,781.36875,781.36875,781.36875,781.36875,781.36875,781.36875,746.6775,746.6775,746.6775,746.6775,746.6775,746.6775,746.6775,746.6775,746.6775,746.6775,746.6775,746.6775,793.005,793.005,793.005,793.005,793.005,793.005,793.005,793.005,793.005,793.005,793.005,793.005,825.52125,825.52125,825.52125,825.52125,825.52125,825.52125,825.52125,825.52125,825.52125,825.52125,825.52125,825.52125,887.4,887.4,887.4,887.4,887.4,887.4,887.4,887.4,887.4,887.4,887.4,887.4]],"container":"<table class=\"cell-border stripe\">\n  <thead>\n    <tr>\n      <th>Year<\/th>\n      <th>Monthly Income<\/th>\n      <th>Age<\/th>\n      <th>Employee Contribution<\/th>\n      <th>Employer Contribution<\/th>\n      <th>Total Contribution<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"dom":"lfrtip","columnDefs":[{"className":"dt-center","targets":"_all"},{"name":"date","targets":0},{"name":"monthly_income","targets":1},{"name":"age","targets":2},{"name":"employee_contribution","targets":3},{"name":"employer_contribution","targets":4},{"name":"total_contribution","targets":5}],"order":[],"autoWidth":false,"orderClasses":false,"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[0]; $(this.api().cell(row, 0).node()).css({'text-align':'center'});\nvar value=data[1]; $(this.api().cell(row, 1).node()).css({'text-align':'center'});\nvar value=data[2]; $(this.api().cell(row, 2).node()).css({'text-align':'center'});\nvar value=data[3]; $(this.api().cell(row, 3).node()).css({'text-align':'center'});\nvar value=data[4]; $(this.api().cell(row, 4).node()).css({'text-align':'center'});\nvar value=data[5]; $(this.api().cell(row, 5).node()).css({'text-align':'center'});\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="processing-market-data." class="level5">
<h5 class="anchored" data-anchor-id="processing-market-data.">Processing Market Data.</h5>
<p>This chunk processes data for US equities, international equities, and bonds. It calculates monthly multipliers for returns based on historical closing values and yields. These multipliers will later be used to simulate the growth of investments over time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Processing market data for US equities, international equities, and bonds</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>us_equities <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"SPY_monthly_data.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">us_return =</span> close_value) <span class="sc">|&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">floor_date</span>(<span class="fu">as.Date</span>(date), <span class="at">unit =</span> <span class="st">"month"</span>),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">us_equities_mult =</span> <span class="dv">1</span> <span class="sc">+</span> (us_return <span class="sc">-</span> <span class="fu">lag</span>(us_return)) <span class="sc">/</span> <span class="fu">lag</span>(us_return)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>international_equities <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"international_equity_data.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">int_return =</span> close_value) <span class="sc">|&gt;</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">floor_date</span>(<span class="fu">as.Date</span>(date), <span class="at">unit =</span> <span class="st">"month"</span>),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">int_equities_mult =</span> <span class="dv">1</span> <span class="sc">+</span> (int_return <span class="sc">-</span> <span class="fu">lag</span>(int_return)) <span class="sc">/</span> <span class="fu">lag</span>(int_return)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>bonds <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"10year_bond_returns.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">bond_return =</span> yield_percent) <span class="sc">|&gt;</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">floor_date</span>(<span class="fu">as.Date</span>(date), <span class="at">unit =</span> <span class="st">"month"</span>),</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">bond_mult =</span> <span class="dv">1</span> <span class="sc">+</span> bond_return <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="defining-asset-allocation" class="level5">
<h5 class="anchored" data-anchor-id="defining-asset-allocation">Defining Asset Allocation</h5>
<p>This chunk defines the age-based asset allocation rules for investments in US equities, international equities, and bonds based on the Fidelity Freedom Fund model. A helper function is provided to retrieve the allocation percentages based on the investor’s age.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Asset allocation by age</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>allocation_by_age <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>age_range, <span class="sc">~</span>us_equities, <span class="sc">~</span>international_equities, <span class="sc">~</span>bonds,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"25-49"</span>, <span class="fl">0.54</span>, <span class="fl">0.36</span>, <span class="fl">0.10</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"50-59"</span>, <span class="fl">0.47</span>, <span class="fl">0.32</span>, <span class="fl">0.21</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"60-74"</span>, <span class="fl">0.34</span>, <span class="fl">0.23</span>, <span class="fl">0.43</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper function to get allocation based on age</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>get_allocation <span class="ot">&lt;-</span> <span class="cf">function</span>(age) {</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (age <span class="sc">&lt;=</span> <span class="dv">49</span>) {</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(allocation_by_age <span class="sc">|&gt;</span> <span class="fu">filter</span>(age_range <span class="sc">==</span> <span class="st">"25-49"</span>))</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (age <span class="sc">&lt;=</span> <span class="dv">59</span>) {</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(allocation_by_age <span class="sc">|&gt;</span> <span class="fu">filter</span>(age_range <span class="sc">==</span> <span class="st">"50-59"</span>))</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(allocation_by_age <span class="sc">|&gt;</span> <span class="fu">filter</span>(age_range <span class="sc">==</span> <span class="st">"60-74"</span>))</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="simulating-investment-growth" class="level5">
<h5 class="anchored" data-anchor-id="simulating-investment-growth">Simulating Investment Growth</h5>
<p>This chunk merges salary contributions and market data, then calculates monthly growth for investments in US equities, international equities, and bonds. It uses the asset allocation model to determine the proportion of contributions allocated to each asset type and applies monthly return multipliers to simulate growth over time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merging contributions with market data and simulating monthly investment growth</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>investment_data <span class="ot">&lt;-</span> monthly_contributions <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(us_equities <span class="sc">|&gt;</span> <span class="fu">select</span>(date, us_equities_mult), <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(international_equities <span class="sc">|&gt;</span> <span class="fu">select</span>(date, int_equities_mult), <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(bonds <span class="sc">|&gt;</span> <span class="fu">select</span>(date, bond_mult), <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">us_stocks =</span> <span class="dv">0</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">international_stocks =</span> <span class="dv">0</span>,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">bonds =</span> <span class="dv">0</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Initializing investment values for the first month</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>investment_data<span class="sc">$</span>us_stocks[<span class="dv">1</span>] <span class="ot">&lt;-</span> investment_data<span class="sc">$</span>total_contribution[<span class="dv">1</span>] <span class="sc">*</span> (<span class="fl">0.54</span> <span class="sc">+</span> <span class="fl">0.36</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>investment_data<span class="sc">$</span>bonds[<span class="dv">1</span>] <span class="ot">&lt;-</span> investment_data<span class="sc">$</span>total_contribution[<span class="dv">1</span>] <span class="sc">*</span> <span class="fl">0.10</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>investment_data<span class="sc">$</span>international_stocks[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulating investment growth for each month</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(investment_data))) {</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  date <span class="ot">&lt;-</span> investment_data<span class="sc">$</span>date[i]</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  age <span class="ot">&lt;-</span> investment_data<span class="sc">$</span>age[i]</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  total_contribution <span class="ot">&lt;-</span> investment_data<span class="sc">$</span>total_contribution[i]</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  allocation <span class="ot">&lt;-</span> <span class="fu">get_allocation</span>(age)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Updating US stocks</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    investment_data<span class="sc">$</span>us_stocks[i] <span class="ot">&lt;-</span> investment_data<span class="sc">$</span>us_stocks[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> <span class="fu">coalesce</span>(investment_data<span class="sc">$</span>us_equities_mult[i], <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>      total_contribution <span class="sc">*</span> (<span class="fu">ifelse</span>(date <span class="sc">&lt;</span> <span class="fu">as.Date</span>(<span class="st">"2007-04-01"</span>), allocation<span class="sc">$</span>us_equities <span class="sc">+</span> allocation<span class="sc">$</span>international_equities, allocation<span class="sc">$</span>us_equities))</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Updating international stocks</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2007-04-01"</span>) <span class="sc">&amp;&amp;</span> i <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    investment_data<span class="sc">$</span>international_stocks[i] <span class="ot">&lt;-</span> investment_data<span class="sc">$</span>international_stocks[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> <span class="fu">coalesce</span>(investment_data<span class="sc">$</span>int_equities_mult[i], <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>      total_contribution <span class="sc">*</span> allocation<span class="sc">$</span>international_equities</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (i <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    investment_data<span class="sc">$</span>international_stocks[i] <span class="ot">&lt;-</span> investment_data<span class="sc">$</span>international_stocks[i <span class="sc">-</span> <span class="dv">1</span>]</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Updating bonds</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>  bond_allocation <span class="ot">&lt;-</span> <span class="fl">0.1</span> <span class="sc">*</span> total_contribution</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (date <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2013-12-01"</span>)) {</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>      investment_data<span class="sc">$</span>bonds[i] <span class="ot">&lt;-</span> bond_allocation <span class="sc">*</span> (investment_data<span class="sc">$</span>bond_mult[i] <span class="sc">^</span> <span class="dv">10</span>)</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>      years_since_2013 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(<span class="fu">as.Date</span>(<span class="st">"2023-12-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2013-12-01"</span>), <span class="at">units =</span> <span class="st">"days"</span>)) <span class="sc">/</span> <span class="fl">365.25</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>      investment_data<span class="sc">$</span>bonds[i] <span class="ot">&lt;-</span> bond_allocation <span class="sc">*</span> (investment_data<span class="sc">$</span>bond_mult[i] <span class="sc">^</span> years_since_2013)</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (date <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2013-12-01"</span>)) {</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>      investment_data<span class="sc">$</span>bonds[i] <span class="ot">&lt;-</span> investment_data<span class="sc">$</span>bonds[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> bond_allocation <span class="sc">*</span> (investment_data<span class="sc">$</span>bond_mult[i] <span class="sc">^</span> <span class="dv">10</span>)</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>      years_since_2013 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(<span class="fu">as.Date</span>(<span class="st">"2023-12-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2013-12-01"</span>), <span class="at">units =</span> <span class="st">"days"</span>)) <span class="sc">/</span> <span class="fl">365.25</span></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>      investment_data<span class="sc">$</span>bonds[i] <span class="ot">&lt;-</span> investment_data<span class="sc">$</span>bonds[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> bond_allocation <span class="sc">*</span> (investment_data<span class="sc">$</span>bond_mult[i] <span class="sc">^</span> years_since_2013)</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="displaying-investment-data" class="level5">
<h5 class="anchored" data-anchor-id="displaying-investment-data">Displaying Investment Data</h5>
<p>This chunk displays the calculated investments (US stocks, international stocks, and bonds) over time in an interactive table. The data includes rounded values for each investment type and is formatted for clarity, providing a summary of monthly investments in the pension fund.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  investment_data <span class="sc">|&gt;</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(date, us_stocks, international_stocks, bonds) <span class="sc">|&gt;</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">date =</span> <span class="fu">format</span>(date, <span class="st">"%Y - %m"</span>),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">us_stocks =</span> <span class="fu">round</span>(us_stocks, <span class="dv">2</span>),</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">international_stocks =</span> <span class="fu">round</span>(international_stocks, <span class="dv">2</span>),</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">bonds =</span> <span class="fu">round</span>(bonds, <span class="dv">2</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;"</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Monthly Investment In The Pension Fund"</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">colnames =</span> <span class="fu">c</span>(<span class="st">"Year"</span>, <span class="st">"US Stocks Investment (USD)"</span>, <span class="st">"International Stocks Investment (USD)"</span>, <span class="st">"Bonds (USD)"</span>),</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">10</span>,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'lfrtip'</span>,</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">className =</span> <span class="st">"dt-center"</span>, <span class="at">targets =</span> <span class="st">"_all"</span>))</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">'cell-border stripe'</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatStyle</span>(</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"us_stocks"</span>, <span class="st">"international_stocks"</span>, <span class="st">"bonds"</span>),</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">textAlign =</span> <span class="st">"center"</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-cf7868a1c7faedc5e581" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-cf7868a1c7faedc5e581">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;\">Monthly Investment In The Pension Fund<\/caption>","data":[["2005 - 01","2005 - 02","2005 - 03","2005 - 04","2005 - 05","2005 - 06","2005 - 07","2005 - 08","2005 - 09","2005 - 10","2005 - 11","2005 - 12","2006 - 01","2006 - 02","2006 - 03","2006 - 04","2006 - 05","2006 - 06","2006 - 07","2006 - 08","2006 - 09","2006 - 10","2006 - 11","2006 - 12","2007 - 01","2007 - 02","2007 - 03","2007 - 04","2007 - 05","2007 - 06","2007 - 07","2007 - 08","2007 - 09","2007 - 10","2007 - 11","2007 - 12","2008 - 01","2008 - 02","2008 - 03","2008 - 04","2008 - 05","2008 - 06","2008 - 07","2008 - 08","2008 - 09","2008 - 10","2008 - 11","2008 - 12","2009 - 01","2009 - 02","2009 - 03","2009 - 04","2009 - 05","2009 - 06","2009 - 07","2009 - 08","2009 - 09","2009 - 10","2009 - 11","2009 - 12","2010 - 01","2010 - 02","2010 - 03","2010 - 04","2010 - 05","2010 - 06","2010 - 07","2010 - 08","2010 - 09","2010 - 10","2010 - 11","2010 - 12","2011 - 01","2011 - 02","2011 - 03","2011 - 04","2011 - 05","2011 - 06","2011 - 07","2011 - 08","2011 - 09","2011 - 10","2011 - 11","2011 - 12","2012 - 01","2012 - 02","2012 - 03","2012 - 04","2012 - 05","2012 - 06","2012 - 07","2012 - 08","2012 - 09","2012 - 10","2012 - 11","2012 - 12","2013 - 01","2013 - 02","2013 - 03","2013 - 04","2013 - 05","2013 - 06","2013 - 07","2013 - 08","2013 - 09","2013 - 10","2013 - 11","2013 - 12","2014 - 01","2014 - 02","2014 - 03","2014 - 04","2014 - 05","2014 - 06","2014 - 07","2014 - 08","2014 - 09","2014 - 10","2014 - 11","2014 - 12","2015 - 01","2015 - 02","2015 - 03","2015 - 04","2015 - 05","2015 - 06","2015 - 07","2015 - 08","2015 - 09","2015 - 10","2015 - 11","2015 - 12","2016 - 01","2016 - 02","2016 - 03","2016 - 04","2016 - 05","2016 - 06","2016 - 07","2016 - 08","2016 - 09","2016 - 10","2016 - 11","2016 - 12","2017 - 01","2017 - 02","2017 - 03","2017 - 04","2017 - 05","2017 - 06","2017 - 07","2017 - 08","2017 - 09","2017 - 10","2017 - 11","2017 - 12","2018 - 01","2018 - 02","2018 - 03","2018 - 04","2018 - 05","2018 - 06","2018 - 07","2018 - 08","2018 - 09","2018 - 10","2018 - 11","2018 - 12","2019 - 01","2019 - 02","2019 - 03","2019 - 04","2019 - 05","2019 - 06","2019 - 07","2019 - 08","2019 - 09","2019 - 10","2019 - 11","2019 - 12","2020 - 01","2020 - 02","2020 - 03","2020 - 04","2020 - 05","2020 - 06","2020 - 07","2020 - 08","2020 - 09","2020 - 10","2020 - 11","2020 - 12","2021 - 01","2021 - 02","2021 - 03","2021 - 04","2021 - 05","2021 - 06","2021 - 07","2021 - 08","2021 - 09","2021 - 10","2021 - 11","2021 - 12","2022 - 01","2022 - 02","2022 - 03","2022 - 04","2022 - 05","2022 - 06","2022 - 07","2022 - 08","2022 - 09","2022 - 10","2022 - 11","2022 - 12","2023 - 01","2023 - 02","2023 - 03","2023 - 04","2023 - 05","2023 - 06","2023 - 07","2023 - 08","2023 - 09","2023 - 10","2023 - 11","2023 - 12"],[350.31,707.95,1042.59,1373.37,1767.93,2113.81,2545,2871.45,3232.54,3506.4,4010.82,4332.35,4794.42,5179.9,5602.57,6031.37,6207.74,6554.57,6941.96,7451.48,7977.21,8586.66,9115.440000000001,9544.18,10051.1,10217.31,10658.26,11348.4,11951.37,11944.12,11788.18,12157.48,12786.55,13178.05,12885.65,12891.32,12336.7,12242.68,12298.23,13109.2,13532.16,12564.28,12676.18,13096.87,12020.02,10259.27,9769.959999999999,10011.02,9383.700000000001,8570.16,9412.9,10542.76,11353.75,11477.31,12528.31,13185.83,13783.36,13713.1,14752.65,15148.66,14791.14,15445.57,16511.71,16960.17,15805.63,15109.88,16334.92,15793.19,17308.94,18163.19,18356.22,19673.94,20328.71,21231.23,21338.29,22152.63,22100.56,21816.9,21576.82,20586.97,19255.56,21553.61,21662.38,21947.12,23183.4,24408.18,25301.81,25351.4,24047.39,25112.77,25628.33,26488.88,27234.68,26957.55,27328.61,27597.09,29238.78,29840.82,31065.75,31891.59,32873.52,32493.11,34401.24,33598.45,34722.58,36559.46,37871.98,38873.05,37761.3,39738.48,40150.51,40688.07,41890.74,42810.11,42493.3,44428.68,43870.32,45161.95,46661.09,46545.71,45442.65,48272.78,47579.53,48323.48,49220.79,48272.97,49618.16,46850.4,45715.3,49890.25,50348.65,49461.83,47313.33,47588.29,50842.79,51357.2,52544.91,52768.8,55007.37,55387.28,55426.14,54779.25,57111.26,58241.62,59598.38,62254.64,62377,63310.71,64518.76,64929.5,66578.62,67087.42,68415.78,70342.48,72807.10000000001,73629.89999999999,78123.45,75626.69,73604.14,74328.37,76479.06,76918.87,80112.28,83013.28999999999,83474.36,78049.75999999999,79841.36,72732.56,78821.60000000001,81642.34,83021.25,86678.53999999999,81416.61,86926.28,88506.22,87289.99000000001,88845.08,91074.64,94637.03999999999,97175.97,97390.59,89934.46000000001,78498.00999999999,88719.83,93200.78,94691.94,100522.42,107792.42,103596.47,101267.31,112536.73,116464.53,115547.33,119029.8,124297.08,131143.31,132274.02,135069.21,138636.2,143031.62,136199.71,146025.59,145121.92,151571.55,143858.15,139892.56,144982.32,132538.04,133117.89,121896.26,133402.06,128239.67,116188.99,125912.99,133193.36,125224.6,133401.35,130349,134969.8,137427.66,138363.77,147086.18,152202.51,150030.63,142713.38,139916.99,152999.26,159640.19],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,145.35,295.53,442.87,583.09,727.3,917.41,1121.16,1210.89,1321.51,1369.03,1515.85,1664.32,1912.68,2089.69,2064.51,2138.49,2177.46,2057.22,1738.83,1770.93,2022.79,1892.51,1850.78,2171.12,2590.92,3116.53,3184.52,3654.98,3894.3,4247.89,4245.76,4584.38,4690.83,4552.27,4743.5,5193.88,5234.14,4794.91,4862.23,5516.87,5458.81,6168.69,6521.59,6385.38,6889.16,7077.7,7405.58,7522.79,8066.78,7944.56,7991.48,7935.85,7397.2,6568.64,7457.25,7399.2,7108.92,7745.35,8305.42,8379.73,8376.889999999999,7570.66,8213.379999999999,8402.219999999999,8773.389999999999,9065.360000000001,9283.76,9599.799999999999,10114.51,10515.82,10525.86,10715.93,11274.03,11057.26,10668.75,11326.49,11257.33,12212.02,12774.99,12974.14,13217.59,12627.54,13514.29,13644.74,14021.4,14466.53,14714.79,14674.07,14998.14,14367.13,14572.27,14700.98,14183.45,14368.38,15396.66,15317.6,16231.66,16251.07,15808.41,15950.78,14903.13,14413.67,15565.23,15547.84,15226.54,14588,14445.83,15805.05,16352.18,16436.09,16326.52,17233.78,17567.19,17956.75,17866.21,17699.97,18104.11,19068.17,19522.7,20256.46,20894.12,21745.85,21834.68,22786.41,23145.96,23653.61,24329.98,24698.07,25204.52,26875.72,25683.32,25729.85,26110.65,25824.26,25215.06,26178.76,25799.37,26013.66,24088.7,24676.08,23458.05,25413.33,26007.7,26354.43,27285.63,25952.41,27341.32,27027.73,26548.89,27299.25,28419.94,28896.96,29957.55,29109.33,27358.01,23315.18,25072.71,26417.68,27597.5,28853.2,30296.15,29758.28,29316.56,33184.76,34978.76,35293.01,36210.42,36925.67,38057.37,39444.34,39123.01,38749.94,39521.42,38158.84,39386.59,37877.3,38906.47,38163.04,37185.24,37124.98,34910.33,35670.59,32745.64,34043.2,32736.88,29598.7,30796.1,35034.38,34036.18,37199.95,35772.72,36910.44,37811.75,36724.92,38178.31,39820.85,38275.83,36983.78,36004.29,39169.91,40671.5],[58.85,117.41,177.86,237.39,295.78,353.4,412.02,471.09,529.83,590.04,650.72,711,772.3,834.5,897.59,962.33,1027.81,1093.29,1158.65,1222.71,1285.81,1348.96,1411.33,1473.47,1537.75,1601.78,1664.84,1728.7,1792.91,1859.31,1925.08,1988.81,2051.63,2114.51,2175.14,2235.49,2295.59,2355.68,2414.46,2474.22,2535.13,2597.35,2659.03,2720,2779.81,2840.32,2899.21,2952.08,3005.22,3060.2,3114.92,3170.22,3227.49,3287.19,3345.97,3404.93,3462.81,3520.63,3578.51,3637.47,3696.7,3755.7,3814.93,3874.85,3932.34,3988.61,4043.86,4097.46,4150.81,4203.59,4257.51,4314.27,4372.58,4431.97,4490.39,4549.1,4606.18,4662.32,4718.47,4770.91,4821.74,4873.42,4924.4,4975.23,5031.73,5088.23,5145.85,5202.8,5258.36,5312.96,5367.07,5421.98,5477.12,5532.41,5587.16,5642.3,5701.16,5760.44,5819.6,5877.6,5936.59,5997.75,6060.6,6124.45,6188.72,6251.83,6315.54,6380.39,6453.29,6525.13,6597.04,6668.89,6739.69,6810.77,6881.43,6951.27,7021.86,7090.89,7160.12,7228.54,7299.3,7370.76,7442.63,7513.81,7586.82,7660.98,7734.86,7807.65,7880.45,7952.54,8025.98,8099.28,8181.45,8261.16,8341.73,8421.67,8501.610000000001,8580.23,8657.77,8735.77,8814.309999999999,8893.860000000001,8976.43,9061.870000000001,9146.959999999999,9231.959999999999,9317.459999999999,9401.469999999999,9485.48,9568.59,9652.76,9736.040000000001,9819.23,9903.73,9988.15,10072.99,10167.36,10264.35,10361.14,10458.22,10556.34,10653.8,10751.07,10848.33,10946.64,11046.4,11145.86,11242.56,11344.65,11446.44,11547.14,11647.45,11746.5,11842.4,11938.21,12030.05,12122.54,12215.11,12308.59,12402.54,12491.44,12578.09,12659.52,12739.26,12819.08,12899.38,12978.81,13058.48,13138.38,13219.16,13300.58,13382.49,13470.78,13560.66,13653.69,13747,13840.12,13932.33,14022.74,14112.8,14203.66,14296.41,14388.99,14480.75,14579.03,14678.97,14780.89,14889.16,14999.03,15111.49,15221.35,15331.22,15447.89,15569.84,15690.75,15808.55,15934.08,16062.31,16189.43,16314.11,16440.13,16568.36,16698.45,16831.97,16968.19,17110,17247.8,17379.41]],"container":"<table class=\"cell-border stripe\">\n  <thead>\n    <tr>\n      <th>Year<\/th>\n      <th>US Stocks Investment (USD)<\/th>\n      <th>International Stocks Investment (USD)<\/th>\n      <th>Bonds (USD)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"dom":"lfrtip","columnDefs":[{"className":"dt-center","targets":"_all"},{"name":"date","targets":0},{"name":"us_stocks","targets":1},{"name":"international_stocks","targets":2},{"name":"bonds","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[0]; $(this.api().cell(row, 0).node()).css({'text-align':'center'});\nvar value=data[1]; $(this.api().cell(row, 1).node()).css({'text-align':'center'});\nvar value=data[2]; $(this.api().cell(row, 2).node()).css({'text-align':'center'});\nvar value=data[3]; $(this.api().cell(row, 3).node()).css({'text-align':'center'});\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="visualising-investment-data" class="level5">
<h5 class="anchored" data-anchor-id="visualising-investment-data">Visualising Investment Data</h5>
<p>This code processes investment data and creates a line plot to visualize how investments in US stocks, international stocks, and bonds evolved over time, with clear labeling, color distinction, and a clean layout for easy interpretation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparing the data for plotting</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>investment_plot_data <span class="ot">&lt;-</span> investment_data <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, us_stocks, international_stocks, bonds) <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">us_stocks =</span> <span class="fu">round</span>(us_stocks, <span class="dv">2</span>),</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">international_stocks =</span> <span class="fu">round</span>(international_stocks, <span class="dv">2</span>),</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">bonds =</span> <span class="fu">round</span>(bonds, <span class="dv">2</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(us_stocks, international_stocks, bonds),</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"investment_type"</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"amount"</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating the line plot</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(investment_plot_data, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> amount, <span class="at">color =</span> investment_type)) <span class="sc">+</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Investment Distribution Over Time"</span>,</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Investment Amount (USD)"</span>,</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Investment Type"</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"us_stocks"</span> <span class="ot">=</span> <span class="st">"#377eb8"</span>, <span class="st">"international_stocks"</span> <span class="ot">=</span> <span class="st">"#4daf4a"</span>, <span class="st">"bonds"</span> <span class="ot">=</span> <span class="st">"#e41a1c"</span>),</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Bonds"</span>, <span class="st">"International Stocks"</span>, <span class="st">"US Stocks"</span>)</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_labels =</span> <span class="st">"%Y"</span>, </span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">"2 years"</span> </span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The plot clearly shows that US stocks (S&amp;P 500 index) have significantly outperformed other investments.</p>
</section>
<section id="optional-retirement-plan-orp-benefit-calculation" class="level5">
<h5 class="anchored" data-anchor-id="optional-retirement-plan-orp-benefit-calculation">Optional Retirement Plan (ORP) Benefit Calculation</h5>
<p>This code calculates the benefits under the Optional Retirement Plan (ORP) after completing the employment period. It determines the years of work, the total accumulated benefit (sum of investments), and the monthly benefit based on the 4% withdrawal rule. The results are presented in an interactive table for clear and organized viewing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating ORP benefits</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>years_of_work <span class="ot">&lt;-</span> <span class="dv">2023</span> <span class="sc">-</span> <span class="dv">2005</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>total_benefit <span class="ot">&lt;-</span> investment_data <span class="sc">|&gt;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">==</span> <span class="fu">max</span>(date)) <span class="sc">|&gt;</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pension_fund =</span> <span class="fu">sum</span>(us_stocks, international_stocks, bonds, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(total_pension_fund)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>monthly_benefit <span class="ot">&lt;-</span> <span class="fu">round</span>((total_benefit <span class="sc">*</span> <span class="fl">0.04</span>) <span class="sc">/</span> <span class="dv">12</span>, <span class="dv">2</span>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>pension_results <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"Years of Work"</span>, <span class="st">"Total Benefit (pension)"</span>, <span class="st">"Monthly Benefit (4% Rule)"</span>),</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">Value =</span> <span class="fu">c</span>(years_of_work, <span class="fu">round</span>(total_benefit, <span class="dv">2</span>), monthly_benefit)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  pension_results,</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;"</span>,</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Optional Retirement Plan Calculation"</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'t'</span>,</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">ordering =</span> <span class="cn">FALSE</span>,</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">className =</span> <span class="st">"dt-center"</span>, <span class="at">targets =</span> <span class="st">"_all"</span>))</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">'cell-border stripe'</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatStyle</span>(</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">names</span>(pension_results),</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">textAlign =</span> <span class="st">"center"</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-fc19b5080bbb857cadd0" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-fc19b5080bbb857cadd0">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;\">Optional Retirement Plan Calculation<\/caption>","data":[["Years of Work","Total Benefit (pension)","Monthly Benefit (4% Rule)"],[19,217691.1,725.64]],"container":"<table class=\"cell-border stripe\">\n  <thead>\n    <tr>\n      <th>Metric<\/th>\n      <th>Value<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","ordering":false,"columnDefs":[{"className":"dt-center","targets":"_all"},{"name":"Metric","targets":0},{"name":"Value","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[0]; $(this.api().cell(row, 0).node()).css({'text-align':'center'});\nvar value=data[1]; $(this.api().cell(row, 1).node()).css({'text-align':'center'});\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
</section>
<section id="task-6---fixed-rate-analysis" class="level2">
<h2 class="anchored" data-anchor-id="task-6---fixed-rate-analysis">Task 6 - Fixed-Rate Analysis</h2>
<p>In Task 6, we simulate the performance of retirement plans (TRS and ORP) over a 30-year retirement period under fixed-rate assumptions. The analysis projects whether funds are sufficient, calculates average monthly income, and examines income differences between TRS and ORP.</p>
<section id="dynamic-projection-of-orp-pension-fund-for-30-years-post-retirement" class="level4">
<h4 class="anchored" data-anchor-id="dynamic-projection-of-orp-pension-fund-for-30-years-post-retirement">Dynamic Projection of ORP Pension Fund for 30 Years Post-Retirement</h4>
<p>This code simulates the evolution of the pension fund after retirement, assuming a 4% annual withdrawal rate and fixed average returns for US stocks, international stocks, and bonds. The simulation projects the fund’s performance over 30 years and dynamically adjusts monthly payments based on the remaining portfolio balance. The results are presented in an interactive table for analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulating pension fund growth and withdrawals post-retirement</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>years_after_retirement <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>monthly_withdrawal_rate <span class="ot">&lt;-</span> <span class="fl">0.04</span> <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>retirement_start_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2024-01-01"</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>avg_us_return <span class="ot">&lt;-</span> <span class="fu">mean</span>(us_equities<span class="sc">$</span>us_equities_mult, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>avg_int_return <span class="ot">&lt;-</span> <span class="fu">mean</span>(international_equities<span class="sc">$</span>int_equities_mult, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>avg_bond_return <span class="ot">&lt;-</span> (<span class="fu">mean</span>(bonds<span class="sc">$</span>bond_mult, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>initial_us_stocks <span class="ot">&lt;-</span> investment_data<span class="sc">$</span>us_stocks[<span class="fu">nrow</span>(investment_data)]</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>initial_int_stocks <span class="ot">&lt;-</span> investment_data<span class="sc">$</span>international_stocks[<span class="fu">nrow</span>(investment_data)]</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>initial_bonds <span class="ot">&lt;-</span> investment_data<span class="sc">$</span>bonds[<span class="fu">nrow</span>(investment_data)]</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>total_benefit <span class="ot">&lt;-</span> initial_us_stocks <span class="sc">+</span> initial_int_stocks <span class="sc">+</span> initial_bonds</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>monthly_withdrawal <span class="ot">&lt;-</span> total_benefit <span class="sc">*</span> monthly_withdrawal_rate</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>allocation <span class="ot">&lt;-</span> <span class="fu">get_allocation</span>(<span class="at">age =</span> <span class="dv">65</span>)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>us_allocation <span class="ot">&lt;-</span> allocation<span class="sc">$</span>us_equities</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>int_allocation <span class="ot">&lt;-</span> allocation<span class="sc">$</span>international_equities</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>bond_allocation <span class="ot">&lt;-</span> allocation<span class="sc">$</span>bonds</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>projection <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">Month =</span> <span class="fu">seq.Date</span>(<span class="at">from =</span> retirement_start_date, <span class="at">by =</span> <span class="st">"1 month"</span>, <span class="at">length.out =</span> years_after_retirement <span class="sc">*</span> <span class="dv">12</span>),</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">US_Stocks =</span> <span class="fu">numeric</span>(years_after_retirement <span class="sc">*</span> <span class="dv">12</span>),</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">International_Stocks =</span> <span class="fu">numeric</span>(years_after_retirement <span class="sc">*</span> <span class="dv">12</span>),</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">Bonds =</span> <span class="fu">numeric</span>(years_after_retirement <span class="sc">*</span> <span class="dv">12</span>),</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">Total_Portfolio =</span> <span class="fu">numeric</span>(years_after_retirement <span class="sc">*</span> <span class="dv">12</span>)</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>projection<span class="sc">$</span>US_Stocks[<span class="dv">1</span>] <span class="ot">&lt;-</span> initial_us_stocks</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>projection<span class="sc">$</span>International_Stocks[<span class="dv">1</span>] <span class="ot">&lt;-</span> initial_int_stocks</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>projection<span class="sc">$</span>Bonds[<span class="dv">1</span>] <span class="ot">&lt;-</span> initial_bonds</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>projection<span class="sc">$</span>Total_Portfolio[<span class="dv">1</span>] <span class="ot">&lt;-</span> total_benefit <span class="sc">-</span> monthly_withdrawal</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>projection<span class="sc">$</span>Monthly_Payment <span class="ot">&lt;-</span> monthly_withdrawal</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(projection)) {</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>  projection<span class="sc">$</span>Monthly_Payment[i <span class="sc">-</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> projection<span class="sc">$</span>Total_Portfolio[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> monthly_withdrawal_rate</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>  int_deduction <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(projection<span class="sc">$</span>International_Stocks[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">min</span>(int_allocation <span class="sc">*</span> projection<span class="sc">$</span>Monthly_Payment[i <span class="sc">-</span> <span class="dv">1</span>], projection<span class="sc">$</span>International_Stocks[i <span class="sc">-</span> <span class="dv">1</span>]), <span class="dv">0</span>)</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>  bond_deduction <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(projection<span class="sc">$</span>Bonds[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">min</span>(bond_allocation <span class="sc">*</span> projection<span class="sc">$</span>Monthly_Payment[i <span class="sc">-</span> <span class="dv">1</span>], projection<span class="sc">$</span>Bonds[i <span class="sc">-</span> <span class="dv">1</span>]), <span class="dv">0</span>)</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>  total_deductions <span class="ot">&lt;-</span> int_deduction <span class="sc">+</span> bond_deduction</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>  us_deduction <span class="ot">&lt;-</span> projection<span class="sc">$</span>Monthly_Payment[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">-</span> total_deductions</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>  projection<span class="sc">$</span>US_Stocks[i] <span class="ot">&lt;-</span> projection<span class="sc">$</span>US_Stocks[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> avg_us_return) <span class="sc">-</span> us_deduction</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>  projection<span class="sc">$</span>International_Stocks[i] <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">0</span>, projection<span class="sc">$</span>International_Stocks[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> avg_int_return) <span class="sc">-</span> int_deduction)</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>  projection<span class="sc">$</span>Bonds[i] <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">0</span>, projection<span class="sc">$</span>Bonds[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> avg_bond_return) <span class="sc">-</span> bond_deduction)</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>  projection<span class="sc">$</span>Total_Portfolio[i] <span class="ot">&lt;-</span> projection<span class="sc">$</span>US_Stocks[i] <span class="sc">+</span> projection<span class="sc">$</span>International_Stocks[i] <span class="sc">+</span> projection<span class="sc">$</span>Bonds[i]</span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>projection<span class="sc">$</span>Monthly_Payment[<span class="fu">nrow</span>(projection)] <span class="ot">&lt;-</span> projection<span class="sc">$</span>Total_Portfolio[<span class="fu">nrow</span>(projection)] <span class="sc">*</span> monthly_withdrawal_rate</span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>  projection <span class="sc">|&gt;</span></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">Month =</span> <span class="fu">format</span>(Month, <span class="st">"%Y - %m"</span>),</span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>      <span class="at">US_Stocks =</span> <span class="fu">round</span>(US_Stocks, <span class="dv">2</span>),</span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>      <span class="at">International_Stocks =</span> <span class="fu">round</span>(International_Stocks, <span class="dv">2</span>),</span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>      <span class="at">Bonds =</span> <span class="fu">round</span>(Bonds, <span class="dv">2</span>),</span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>      <span class="at">Total_Portfolio =</span> <span class="fu">round</span>(Total_Portfolio, <span class="dv">2</span>),</span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>      <span class="at">Monthly_Payment =</span> <span class="fu">round</span>(Monthly_Payment, <span class="dv">2</span>)</span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;"</span>,</span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Projection of Pension Fund After Retirement For 30 Years (Dynamic Monthly Payments)"</span></span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a>  <span class="at">colnames =</span> <span class="fu">c</span>(<span class="st">"Month"</span>, <span class="st">"US Stocks Investment (USD)"</span>, <span class="st">"International Stocks Investment (USD)"</span>, <span class="st">"Bonds (USD)"</span>, <span class="st">"Total Portfolio (USD)"</span>, <span class="st">"Monthly Payment (USD)"</span>),</span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">12</span>,</span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'lfrtip'</span>,</span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">className =</span> <span class="st">"dt-center"</span>, <span class="at">targets =</span> <span class="st">"_all"</span>))</span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">'cell-border stripe'</span></span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatStyle</span>(</span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"Month"</span>, <span class="st">"US_Stocks"</span>, <span class="st">"International_Stocks"</span>, <span class="st">"Bonds"</span>, <span class="st">"Total_Portfolio"</span>, <span class="st">"Monthly_Payment"</span>),</span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">textAlign =</span> <span class="st">"center"</span></span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-377c29a227af5fb3bccc" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-377c29a227af5fb3bccc">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;\">Projection of Pension Fund After Retirement For 30 Years (Dynamic Monthly Payments)<\/caption>","data":[["2024 - 01","2024 - 02","2024 - 03","2024 - 04","2024 - 05","2024 - 06","2024 - 07","2024 - 08","2024 - 09","2024 - 10","2024 - 11","2024 - 12","2025 - 01","2025 - 02","2025 - 03","2025 - 04","2025 - 05","2025 - 06","2025 - 07","2025 - 08","2025 - 09","2025 - 10","2025 - 11","2025 - 12","2026 - 01","2026 - 02","2026 - 03","2026 - 04","2026 - 05","2026 - 06","2026 - 07","2026 - 08","2026 - 09","2026 - 10","2026 - 11","2026 - 12","2027 - 01","2027 - 02","2027 - 03","2027 - 04","2027 - 05","2027 - 06","2027 - 07","2027 - 08","2027 - 09","2027 - 10","2027 - 11","2027 - 12","2028 - 01","2028 - 02","2028 - 03","2028 - 04","2028 - 05","2028 - 06","2028 - 07","2028 - 08","2028 - 09","2028 - 10","2028 - 11","2028 - 12","2029 - 01","2029 - 02","2029 - 03","2029 - 04","2029 - 05","2029 - 06","2029 - 07","2029 - 08","2029 - 09","2029 - 10","2029 - 11","2029 - 12","2030 - 01","2030 - 02","2030 - 03","2030 - 04","2030 - 05","2030 - 06","2030 - 07","2030 - 08","2030 - 09","2030 - 10","2030 - 11","2030 - 12","2031 - 01","2031 - 02","2031 - 03","2031 - 04","2031 - 05","2031 - 06","2031 - 07","2031 - 08","2031 - 09","2031 - 10","2031 - 11","2031 - 12","2032 - 01","2032 - 02","2032 - 03","2032 - 04","2032 - 05","2032 - 06","2032 - 07","2032 - 08","2032 - 09","2032 - 10","2032 - 11","2032 - 12","2033 - 01","2033 - 02","2033 - 03","2033 - 04","2033 - 05","2033 - 06","2033 - 07","2033 - 08","2033 - 09","2033 - 10","2033 - 11","2033 - 12","2034 - 01","2034 - 02","2034 - 03","2034 - 04","2034 - 05","2034 - 06","2034 - 07","2034 - 08","2034 - 09","2034 - 10","2034 - 11","2034 - 12","2035 - 01","2035 - 02","2035 - 03","2035 - 04","2035 - 05","2035 - 06","2035 - 07","2035 - 08","2035 - 09","2035 - 10","2035 - 11","2035 - 12","2036 - 01","2036 - 02","2036 - 03","2036 - 04","2036 - 05","2036 - 06","2036 - 07","2036 - 08","2036 - 09","2036 - 10","2036 - 11","2036 - 12","2037 - 01","2037 - 02","2037 - 03","2037 - 04","2037 - 05","2037 - 06","2037 - 07","2037 - 08","2037 - 09","2037 - 10","2037 - 11","2037 - 12","2038 - 01","2038 - 02","2038 - 03","2038 - 04","2038 - 05","2038 - 06","2038 - 07","2038 - 08","2038 - 09","2038 - 10","2038 - 11","2038 - 12","2039 - 01","2039 - 02","2039 - 03","2039 - 04","2039 - 05","2039 - 06","2039 - 07","2039 - 08","2039 - 09","2039 - 10","2039 - 11","2039 - 12","2040 - 01","2040 - 02","2040 - 03","2040 - 04","2040 - 05","2040 - 06","2040 - 07","2040 - 08","2040 - 09","2040 - 10","2040 - 11","2040 - 12","2041 - 01","2041 - 02","2041 - 03","2041 - 04","2041 - 05","2041 - 06","2041 - 07","2041 - 08","2041 - 09","2041 - 10","2041 - 11","2041 - 12","2042 - 01","2042 - 02","2042 - 03","2042 - 04","2042 - 05","2042 - 06","2042 - 07","2042 - 08","2042 - 09","2042 - 10","2042 - 11","2042 - 12","2043 - 01","2043 - 02","2043 - 03","2043 - 04","2043 - 05","2043 - 06","2043 - 07","2043 - 08","2043 - 09","2043 - 10","2043 - 11","2043 - 12","2044 - 01","2044 - 02","2044 - 03","2044 - 04","2044 - 05","2044 - 06","2044 - 07","2044 - 08","2044 - 09","2044 - 10","2044 - 11","2044 - 12","2045 - 01","2045 - 02","2045 - 03","2045 - 04","2045 - 05","2045 - 06","2045 - 07","2045 - 08","2045 - 09","2045 - 10","2045 - 11","2045 - 12","2046 - 01","2046 - 02","2046 - 03","2046 - 04","2046 - 05","2046 - 06","2046 - 07","2046 - 08","2046 - 09","2046 - 10","2046 - 11","2046 - 12","2047 - 01","2047 - 02","2047 - 03","2047 - 04","2047 - 05","2047 - 06","2047 - 07","2047 - 08","2047 - 09","2047 - 10","2047 - 11","2047 - 12","2048 - 01","2048 - 02","2048 - 03","2048 - 04","2048 - 05","2048 - 06","2048 - 07","2048 - 08","2048 - 09","2048 - 10","2048 - 11","2048 - 12","2049 - 01","2049 - 02","2049 - 03","2049 - 04","2049 - 05","2049 - 06","2049 - 07","2049 - 08","2049 - 09","2049 - 10","2049 - 11","2049 - 12","2050 - 01","2050 - 02","2050 - 03","2050 - 04","2050 - 05","2050 - 06","2050 - 07","2050 - 08","2050 - 09","2050 - 10","2050 - 11","2050 - 12","2051 - 01","2051 - 02","2051 - 03","2051 - 04","2051 - 05","2051 - 06","2051 - 07","2051 - 08","2051 - 09","2051 - 10","2051 - 11","2051 - 12","2052 - 01","2052 - 02","2052 - 03","2052 - 04","2052 - 05","2052 - 06","2052 - 07","2052 - 08","2052 - 09","2052 - 10","2052 - 11","2052 - 12","2053 - 01","2053 - 02","2053 - 03","2053 - 04","2053 - 05","2053 - 06","2053 - 07","2053 - 08","2053 - 09","2053 - 10","2053 - 11","2053 - 12"],[159640.19,160643.95,161654.02,162671.26,163695.73,164727.47,165766.54,166812.98,167866.86,168928.21,169997.11,171073.59,172157.71,173249.53,174349.09,175456.47,176571.7,177694.85,178825.96,179965.11,181112.34,182267.71,183431.27,184603.09,185783.23,186971.74,188168.68,189374.11,190588.09,191810.69,193041.95,194281.95,195530.74,196788.39,198054.96,199330.51,200615.11,201908.81,203211.69,204523.81,205845.23,207176.02,208516.24,209865.96,211225.25,212594.18,213972.81,215361.22,216759.46,218167.61,219585.75,221013.93,222452.24,223900.74,225359.5,226710.55,227815.28,228925.56,230042.02,231164.72,232293.68,233428.93,234570.52,235718.49,236872.85,238033.66,239200.95,240374.76,241555.11,242742.06,243935.64,245135.88,246342.82,247556.51,248776.97,250004.25,251238.39,252479.42,253727.39,254982.34,256244.29,257513.3,258789.41,260072.64,261363.05,262660.68,263965.56,265277.74,266597.26,267924.16,269258.48,270600.26,271949.56,273306.4,274670.83,276042.9,277422.65,278810.12,280205.35,281608.4,283019.3,284438.1,285864.85,287299.58,288742.35,290193.2,291652.17,293119.32,294594.68,296078.31,297570.26,299070.56,300579.27,302096.43,303622.1,305156.32,306699.14,308250.61,309810.77,311379.68,312957.39,314543.94,316139.4,317743.79,319357.19,320979.64,322611.19,324251.89,325901.79,327560.95,329229.42,330907.26,332594.51,334291.22,335997.46,337713.28,339438.73,341173.86,342918.74,344673.41,346437.93,348212.37,349996.76,351791.18,353595.67,355410.3,357235.12,359070.2,360915.58,362771.33,364637.5,366514.16,368401.37,370299.18,372207.65,374126.86,376056.84,377997.68,379949.43,381912.15,383885.9,385870.75,387866.75,389873.99,391892.5,393922.37,395963.66,398016.42,400080.74,402156.66,404244.26,406343.6,408454.75,410577.79,412712.76,414859.75,417018.82,419190.04,421373.48,423569.21,425777.29,427997.81,430230.82,432476.4,434734.63,437005.56,439289.29,441585.87,443895.38,446217.9,448553.49,450902.24,453264.22,455639.5,458028.15,460430.27,462845.91,465275.16,467718.1,470174.8,472645.34,475129.8,477628.26,479932.58,482090,484256.82,486433.37,488619.71,490815.87,493021.91,495237.86,497463.77,499699.69,501945.65,504201.71,506467.91,508744.3,511030.92,513327.81,515635.03,517952.62,520280.63,522619.1,524968.0699999999,527327.61,529697.76,532078.55,534470.05,536872.29,539285.33,541709.22,544144.01,546589.73,549046.45,551514.21,553993.0600000001,556483.0600000001,558984.24,561496.67,564020.39,566555.45,569101.91,571659.8100000001,574229.21,576810.16,579402.71,582006.91,584622.8199999999,587250.48,589889.95,592541.29,595204.55,597879.77,600567.02,603266.35,605977.8100000001,608701.45,611437.34,614185.52,616946.0600000001,619719.01,622504.41,625302.34,628112.84,630935.98,633771.8,636620.37,639481.75,642355.98,645243.13,648143.26,651056.4300000001,653982.6800000001,656922.09,659874.72,662840.61,665819.83,668812.45,671818.51,674838.09,677871.24,680918.02,683978.49,687052.72,690140.77,693242.7,696358.5699999999,699488.4399999999,702632.38,705790.46,708962.72,712149.25,715350.1,718565.33,721795.02,725039.22,728298,731571.4300000001,734859.5699999999,738162.5,741480.26,744812.9399999999,748160.6,751523.3100000001,754901.13,758294.13,761702.38,765125.95,768564.91,772019.33,775489.27,778974.8,782476.01,785992.95,789525.7,793074.3199999999,796638.9,800219.5,803816.1899999999,807429.04,811058.14,814703.54,818365.34,822043.59,825738.37,829449.76,833177.83,836922.65,840684.3100000001,844462.88,848258.42,852071.03,855900.78,859747.73,863611.98,867493.6,871392.66,875309.25,879243.4399999999,883195.3199999999,887164.95,891152.4300000001,895157.83,899181.24,903222.72,907282.37,911360.27,915456.5,919571.14,923704.27,927855.98,932026.35,936215.46,940423.41,944650.26,948896.12,953161.05,957445.16,961748.52,966071.23],[40671.5,40581.23,40489.74,40397.58,40304.75,40211.24,40117.05,40022.18,39926.61,39830.34,39733.37,39635.69,39537.29,39438.18,39338.35,39237.78,39136.48,39034.44,38931.65,38828.11,38723.81,38618.75,38512.92,38406.31,38298.92,38190.75,38081.79,37972.03,37861.46,37750.08,37637.89,37524.87,37411.03,37296.35,37180.83,37064.47,36947.25,36829.17,36710.23,36590.41,36469.71,36348.13,36225.66,36102.28,35978.01,35852.82,35726.71,35599.67,35471.7,35342.8,35212.94,35082.14,34950.37,34817.63,34683.92,34549.23,34413.55,34276.87,34139.19,34000.5,33860.8,33720.08,33578.33,33435.55,33291.73,33146.87,33000.96,32854,32705.97,32556.87,32406.7,32255.45,32103.11,31949.68,31795.15,31639.51,31482.76,31324.88,31165.89,31005.76,30844.49,30682.08,30518.52,30353.79,30187.9,30020.84,29852.6,29683.17,29512.55,29340.73,29167.71,28993.46,28818,28641.31,28463.39,28284.22,28103.8,27922.13,27739.19,27554.98,27369.49,27182.72,26994.65,26805.28,26614.6,26422.6,26229.28,26034.63,25838.63,25641.3,25442.6,25242.54,25041.11,24838.31,24634.11,24428.52,24221.53,24013.12,23803.3,23592.05,23379.36,23165.23,22949.65,22732.6,22514.09,22294.09,22072.61,21849.64,21625.16,21399.17,21171.65,20942.61,20712.03,20479.9,20246.21,20010.96,19774.13,19535.72,19295.71,19054.1,18810.88,18566.04,18319.57,18071.45,17821.69,17570.27,17317.18,17062.41,16805.95,16547.8,16287.94,16026.36,15763.05,15498.01,15231.22,14962.67,14692.35,14420.25,14146.37,13870.69,13593.2,13313.89,13032.75,12749.77,12464.93,12178.24,11889.67,11599.22,11306.88,11012.63,10716.46,10418.37,10118.34,9816.35,9512.41,9206.5,8898.6,8588.709999999999,8276.809999999999,7962.89,7646.94,7328.95,7008.91,6686.8,6362.61,6036.34,5707.96,5377.47,5044.86,4710.11,4373.2,4034.14,3692.9,3349.47,3003.85,2656.01,2305.94,1953.64,1599.08,1242.26,883.17,521.78,158.09,0.3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[17379.41,17110.44,16838.86,16565.69,16290.93,16014.56,15736.57,15456.96,15175.71,14892.81,14608.25,14322.01,14034.09,13744.47,13453.14,13160.1,12865.32,12568.8,12270.53,11970.48,11668.66,11365.05,11059.63,10752.39,10443.33,10132.42,9819.66,9505.030000000001,9188.52,8870.120000000001,8549.82,8227.59,7903.43,7577.32,7249.26,6919.22,6587.2,6253.18,5917.14,5579.08,5238.97,4896.81,4552.58,4206.26,3857.84,3507.32,3154.66,2799.86,2442.91,2083.78,1722.47,1358.95,993.22,625.25,255.04,0.62,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[216965.47,218335.62,218982.62,219634.53,220291.41,220953.27,221620.16,222292.12,222969.17,223651.36,224338.72,225031.28,225729.09,226432.18,227140.58,227854.35,228573.5,229298.08,230028.14,230763.7,231504.8,232251.5,233003.81,233761.8,234525.48,235294.91,236070.13,236851.17,237638.08,238430.89,239229.66,240034.41,240845.2,241662.07,242485.06,243314.21,244149.56,244991.16,245839.06,246693.29,247553.91,248420.95,249294.47,250174.51,251061.1,251954.31,252854.18,253760.75,254674.07,255594.19,256521.16,257455.02,258395.83,259343.62,260298.46,261260.39,262228.83,263202.43,264181.21,265165.22,266154.48,267149.01,268148.85,269154.04,270164.59,271180.54,272201.91,273228.75,274261.08,275298.93,276342.34,277391.33,278445.93,279506.18,280572.12,281643.76,282721.15,283804.31,284893.28,285988.1,287088.79,288195.38,289307.92,290426.43,291550.96,292681.52,293818.16,294960.91,296109.81,297264.89,298426.19,299593.73,300767.56,301947.71,303134.22,304327.12,305526.45,306732.25,307944.54,309163.38,310388.79,311620.82,312859.49,314104.85,315356.94,316615.8,317881.45,319153.94,320433.32,321719.61,323012.86,324313.1,325620.38,326934.74,328256.21,329584.84,330920.67,332263.73,333614.07,334971.73,336336.75,337709.17,339089.04,340476.4,341871.28,343273.73,344683.8,346101.53,347526.95,348960.12,350401.08,351849.87,353306.53,354771.12,356243.67,357724.24,359212.86,360709.58,362214.45,363727.51,365248.81,366778.4,368316.33,369862.63,371417.36,372980.57,374552.3,376132.61,377721.53,379319.13,380925.44,382540.52,384164.42,385797.19,387438.87,389089.52,390749.19,392417.94,394095.8,395782.83,397479.09,399184.63,400899.5,402623.75,404357.44,406100.61,407853.33,409615.65,411387.61,413169.29,414960.72,416761.97,418573.09,420394.14,422225.18,424066.25,425917.42,427778.75,429650.29,431532.1,433424.23,435326.76,437239.73,439163.2,441097.24,443041.9,444997.25,446963.34,448940.24,450928,452926.7,454936.38,456957.12,458988.97,461032,463086.27,465151.85,467228.8,469317.18,471417.06,473528.51,475651.58,477786.35,479932.88,482090,484256.82,486433.37,488619.71,490815.87,493021.91,495237.86,497463.77,499699.69,501945.65,504201.71,506467.91,508744.3,511030.92,513327.81,515635.03,517952.62,520280.63,522619.1,524968.0699999999,527327.61,529697.76,532078.55,534470.05,536872.29,539285.33,541709.22,544144.01,546589.73,549046.45,551514.21,553993.0600000001,556483.0600000001,558984.24,561496.67,564020.39,566555.45,569101.91,571659.8100000001,574229.21,576810.16,579402.71,582006.91,584622.8199999999,587250.48,589889.95,592541.29,595204.55,597879.77,600567.02,603266.35,605977.8100000001,608701.45,611437.34,614185.52,616946.0600000001,619719.01,622504.41,625302.34,628112.84,630935.98,633771.8,636620.37,639481.75,642355.98,645243.13,648143.26,651056.4300000001,653982.6800000001,656922.09,659874.72,662840.61,665819.83,668812.45,671818.51,674838.09,677871.24,680918.02,683978.49,687052.72,690140.77,693242.7,696358.5699999999,699488.4399999999,702632.38,705790.46,708962.72,712149.25,715350.1,718565.33,721795.02,725039.22,728298,731571.4300000001,734859.5699999999,738162.5,741480.26,744812.9399999999,748160.6,751523.3100000001,754901.13,758294.13,761702.38,765125.95,768564.91,772019.33,775489.27,778974.8,782476.01,785992.95,789525.7,793074.3199999999,796638.9,800219.5,803816.1899999999,807429.04,811058.14,814703.54,818365.34,822043.59,825738.37,829449.76,833177.83,836922.65,840684.3100000001,844462.88,848258.42,852071.03,855900.78,859747.73,863611.98,867493.6,871392.66,875309.25,879243.4399999999,883195.3199999999,887164.95,891152.4300000001,895157.83,899181.24,903222.72,907282.37,911360.27,915456.5,919571.14,923704.27,927855.98,932026.35,936215.46,940423.41,944650.26,948896.12,953161.05,957445.16,961748.52,966071.23],[723.22,727.79,729.9400000000001,732.12,734.3,736.51,738.73,740.97,743.23,745.5,747.8,750.1,752.4299999999999,754.77,757.14,759.51,761.91,764.33,766.76,769.21,771.6799999999999,774.17,776.6799999999999,779.21,781.75,784.3200000000001,786.9,789.5,792.13,794.77,797.4299999999999,800.11,802.8200000000001,805.54,808.28,811.05,813.83,816.64,819.46,822.3099999999999,825.1799999999999,828.0700000000001,830.98,833.92,836.87,839.85,842.85,845.87,848.91,851.98,855.0700000000001,858.1799999999999,861.3200000000001,864.48,867.66,870.87,874.1,877.34,880.6,883.88,887.1799999999999,890.5,893.83,897.1799999999999,900.55,903.9400000000001,907.34,910.76,914.2,917.66,921.14,924.64,928.15,931.6900000000001,935.24,938.8099999999999,942.4,946.01,949.64,953.29,956.96,960.65,964.36,968.09,971.84,975.61,979.39,983.2,987.03,990.88,994.75,998.65,1002.56,1006.49,1010.45,1014.42,1018.42,1022.44,1026.48,1030.54,1034.63,1038.74,1042.86,1047.02,1051.19,1055.39,1059.6,1063.85,1068.11,1072.4,1076.71,1081.04,1085.4,1089.78,1094.19,1098.62,1103.07,1107.55,1112.05,1116.57,1121.12,1125.7,1130.3,1134.92,1139.57,1144.25,1148.95,1153.67,1158.42,1163.2,1168,1172.83,1177.69,1182.57,1187.48,1192.41,1197.38,1202.37,1207.38,1212.43,1217.5,1222.59,1227.72,1232.88,1238.06,1243.27,1248.51,1253.78,1259.07,1264.4,1269.75,1275.14,1280.55,1285.99,1291.46,1296.97,1302.5,1308.06,1313.65,1319.28,1324.93,1330.62,1336.33,1342.08,1347.86,1353.67,1359.51,1365.39,1371.29,1377.23,1383.2,1389.21,1395.24,1401.31,1407.42,1413.55,1419.72,1425.93,1432.17,1438.44,1444.75,1451.09,1457.47,1463.88,1470.32,1476.81,1483.32,1489.88,1496.47,1503.09,1509.76,1516.45,1523.19,1529.96,1536.77,1543.62,1550.51,1557.43,1564.39,1571.39,1578.43,1585.51,1592.62,1599.78,1606.97,1614.19,1621.44,1628.73,1636.05,1643.41,1650.79,1658.21,1665.67,1673.15,1680.67,1688.23,1695.81,1703.44,1711.09,1718.78,1726.51,1734.27,1742.06,1749.89,1757.76,1765.66,1773.6,1781.57,1789.57,1797.62,1805.7,1813.81,1821.97,1830.15,1838.38,1846.64,1854.94,1863.28,1871.66,1880.07,1888.52,1897.01,1905.53,1914.1,1922.7,1931.34,1940.02,1948.74,1957.5,1966.3,1975.14,1984.02,1992.93,2001.89,2010.89,2019.93,2029,2038.12,2047.29,2056.49,2065.73,2075.01,2084.34,2093.71,2103.12,2112.57,2122.07,2131.61,2141.19,2150.81,2160.48,2170.19,2179.94,2189.74,2199.58,2209.47,2219.4,2229.37,2239.4,2249.46,2259.57,2269.73,2279.93,2290.18,2300.47,2310.81,2321.2,2331.63,2342.11,2352.63,2363.21,2373.83,2384.5,2395.22,2405.98,2416.8,2427.66,2438.57,2449.53,2460.54,2471.6,2482.71,2493.87,2505.08,2516.34,2527.65,2539.01,2550.42,2561.88,2573.4,2584.96,2596.58,2608.25,2619.98,2631.75,2643.58,2655.46,2667.4,2679.39,2691.43,2703.53,2715.68,2727.88,2740.15,2752.46,2764.83,2777.26,2789.74,2802.28,2814.88,2827.53,2840.24,2853,2865.83,2878.71,2891.65,2904.64,2917.7,2930.81,2943.98,2957.22,2970.51,2983.86,2997.27,3010.74,3024.27,3037.87,3051.52,3065.24,3079.01,3092.85,3106.75,3120.72,3134.74,3148.83,3162.99,3177.2,3191.48,3205.83,3220.24]],"container":"<table class=\"cell-border stripe\">\n  <thead>\n    <tr>\n      <th>Month<\/th>\n      <th>US Stocks Investment (USD)<\/th>\n      <th>International Stocks Investment (USD)<\/th>\n      <th>Bonds (USD)<\/th>\n      <th>Total Portfolio (USD)<\/th>\n      <th>Monthly Payment (USD)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":12,"dom":"lfrtip","columnDefs":[{"className":"dt-center","targets":"_all"},{"name":"Month","targets":0},{"name":"US_Stocks","targets":1},{"name":"International_Stocks","targets":2},{"name":"Bonds","targets":3},{"name":"Total_Portfolio","targets":4},{"name":"Monthly_Payment","targets":5}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,12,25,50,100],"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[0]; $(this.api().cell(row, 0).node()).css({'text-align':'center'});\nvar value=data[1]; $(this.api().cell(row, 1).node()).css({'text-align':'center'});\nvar value=data[2]; $(this.api().cell(row, 2).node()).css({'text-align':'center'});\nvar value=data[3]; $(this.api().cell(row, 3).node()).css({'text-align':'center'});\nvar value=data[4]; $(this.api().cell(row, 4).node()).css({'text-align':'center'});\nvar value=data[5]; $(this.api().cell(row, 5).node()).css({'text-align':'center'});\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
</div>
</div>
<p>After 30 years of 4% annual pension withdrawals, the total portfolio grew significantly, primarily driven by US stocks. In contrast, international stocks and bonds were depleted over time, as their average annual returns were insufficient to sustain the 4% withdrawal rate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add age column if not already present</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">"Age"</span> <span class="sc">%in%</span> <span class="fu">names</span>(projection)) {</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  projection<span class="sc">$</span>Age <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">65</span>, <span class="dv">95</span>, <span class="at">length.out =</span> <span class="fu">nrow</span>(projection))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Line plot for US_Stocks, International_Stocks, Bonds, and Monthly_Payment</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(projection, <span class="fu">aes</span>(<span class="at">x =</span> Age)) <span class="sc">+</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> US_Stocks, <span class="at">color =</span> <span class="st">"US Stocks"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> International_Stocks, <span class="at">color =</span> <span class="st">"International Stocks"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Bonds, <span class="at">color =</span> <span class="st">"Bonds"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Monthly_Payment, <span class="at">color =</span> <span class="st">"Monthly Payment"</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Amount (USD)"</span>,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">dollar_format</span>()</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Age (Years)"</span>,</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">65</span>, <span class="dv">95</span>, <span class="at">by =</span> <span class="dv">5</span>), </span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">65</span>, <span class="dv">95</span>, <span class="at">by =</span> <span class="dv">5</span>),</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> .,</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"Year"</span>,</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">65</span>, <span class="dv">95</span>, <span class="at">by =</span> <span class="dv">5</span>),</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="cf">function</span>(x) <span class="dv">2024</span> <span class="sc">+</span> x <span class="sc">-</span> <span class="dv">65</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"US Stocks"</span> <span class="ot">=</span> <span class="st">"blue"</span>, </span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>               <span class="st">"International Stocks"</span> <span class="ot">=</span> <span class="st">"red"</span>, </span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Bonds"</span> <span class="ot">=</span> <span class="st">"green"</span>, </span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Monthly Payment"</span> <span class="ot">=</span> <span class="st">"purple"</span>),</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Legend"</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Projection of ORP Pension Fund Over 30 Years"</span>,</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age (Years)"</span>,</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Amount (USD)"</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x.bottom =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x.top =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x.top =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The plot clearly illustrates that US stock investments consistently outpace the 4% annual withdrawals, while international stock and bond investments are gradually exhausted.</p>
</section>
<section id="dynamic-projection-of-trs-pension-fund-for-30-years-post-retirement" class="level4">
<h4 class="anchored" data-anchor-id="dynamic-projection-of-trs-pension-fund-for-30-years-post-retirement">Dynamic Projection of TRS Pension Fund for 30 Years Post-Retirement</h4>
<p>This code chunk simulates the TRS pension fund over 30 years post-retirement, starting in January 2024. The initial monthly benefit is calculated using the employee’s final average salary and years of service. Inflation adjustments are applied annually each September, based on capped CPI inflation (1% minimum, 3% maximum). Monthly benefits remain constant throughout the year until the next adjustment. The results provide a clear view of how TRS benefits evolve, ensuring financial stability over an extended retirement period.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining constants and initializing variables</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>initial_monthly_benefit <span class="ot">&lt;-</span> results <span class="sc">|&gt;</span> <span class="fu">filter</span>(Metric <span class="sc">==</span> <span class="st">"Monthly Benefit (pension)"</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(Value)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>retirement_start_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2024-01-01"</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>years_after_retirement <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating average annual CPI inflation using historical data</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>avg_cpi_inflation <span class="ot">&lt;-</span> <span class="fu">mean</span>(cpi_data<span class="sc">$</span>inflation, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>cpi_adjustments <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="dv">2024</span><span class="sc">:</span>(<span class="dv">2024</span> <span class="sc">+</span> years_after_retirement <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">avg_inflation =</span> avg_cpi_inflation <span class="sc">*</span> <span class="dv">12</span>  <span class="co"># Converting monthly average to annual percentage</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_inflation =</span> <span class="fu">ceiling</span>(avg_inflation <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">/</span> <span class="dv">10</span>,  <span class="co"># Rounding up to the nearest tenth of a percent</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">capped_inflation =</span> <span class="fu">pmax</span>(<span class="dv">1</span>, <span class="fu">pmin</span>(avg_inflation <span class="sc">/</span> <span class="dv">2</span>, <span class="dv">3</span>))  <span class="co"># Applying cap: minimum 1%, maximum 3%</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating TRS projection table and setting initial values</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>trs_projection <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">Month =</span> <span class="fu">seq.Date</span>(<span class="at">from =</span> retirement_start_date, <span class="at">by =</span> <span class="st">"1 month"</span>, <span class="at">length.out =</span> years_after_retirement <span class="sc">*</span> <span class="dv">12</span>),</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">Monthly_Benefit =</span> <span class="fu">numeric</span>(years_after_retirement <span class="sc">*</span> <span class="dv">12</span>),</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">Inflation_Adjustment =</span> <span class="fu">numeric</span>(years_after_retirement <span class="sc">*</span> <span class="dv">12</span>)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>trs_projection<span class="sc">$</span>Monthly_Benefit[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="ot">&lt;-</span> initial_monthly_benefit  <span class="co"># Setting benefits from Jan to Aug 2024</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>trs_projection<span class="sc">$</span>Inflation_Adjustment[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapping inflation adjustments and calculating monthly benefits</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>years_after_retirement) {</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>  current_year <span class="ot">&lt;-</span> <span class="dv">2024</span> <span class="sc">+</span> year <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>  inflation_row <span class="ot">&lt;-</span> cpi_adjustments <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> current_year)</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>  inflation_adjustment <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">nrow</span>(inflation_row) <span class="sc">==</span> <span class="dv">0</span>) <span class="dv">1</span> <span class="cf">else</span> inflation_row<span class="sc">$</span>capped_inflation</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>  start_index <span class="ot">&lt;-</span> (year <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">12</span> <span class="sc">+</span> <span class="dv">9</span>  <span class="co"># Starting index for September</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>  end_index <span class="ot">&lt;-</span> start_index <span class="sc">+</span> <span class="dv">11</span>      <span class="co"># Ending index for next year's August</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (start_index <span class="sc">&gt;</span> <span class="fu">nrow</span>(trs_projection)) <span class="cf">break</span></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>  previous_benefit <span class="ot">&lt;-</span> <span class="cf">if</span> (start_index <span class="sc">==</span> <span class="dv">9</span>) initial_monthly_benefit <span class="cf">else</span> trs_projection<span class="sc">$</span>Monthly_Benefit[start_index <span class="sc">-</span> <span class="dv">1</span>]</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>  new_benefit <span class="ot">&lt;-</span> previous_benefit <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> inflation_adjustment <span class="sc">/</span> <span class="dv">100</span>)</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>  trs_projection<span class="sc">$</span>Monthly_Benefit[start_index<span class="sc">:</span><span class="fu">min</span>(end_index, <span class="fu">nrow</span>(trs_projection))] <span class="ot">&lt;-</span> new_benefit</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>  trs_projection<span class="sc">$</span>Inflation_Adjustment[start_index<span class="sc">:</span><span class="fu">min</span>(end_index, <span class="fu">nrow</span>(trs_projection))] <span class="ot">&lt;-</span> inflation_adjustment</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Displaying the updated TRS projection as an interactive table</span></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>  trs_projection <span class="sc">|&gt;</span> </span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">Month =</span> <span class="fu">format</span>(Month, <span class="st">"%Y - %m"</span>),</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">Monthly_Benefit =</span> <span class="fu">round</span>(Monthly_Benefit, <span class="dv">2</span>),</span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">Inflation_Adjustment =</span> <span class="fu">round</span>(Inflation_Adjustment, <span class="dv">2</span>)</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;"</span>,</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Teachers Retirement System (TRS) Monthly Pension Projection"</span></span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">colnames =</span> <span class="fu">c</span>(<span class="st">"Month"</span>, <span class="st">"Monthly Benefit (USD)"</span>, <span class="st">"Inflation Adjustment (%)"</span>),</span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">12</span>,</span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'lfrtip'</span>,</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">className =</span> <span class="st">"dt-center"</span>, <span class="at">targets =</span> <span class="st">"_all"</span>))</span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">'cell-border stripe'</span></span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatStyle</span>(</span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"Month"</span>, <span class="st">"Monthly_Benefit"</span>, <span class="st">"Inflation_Adjustment"</span>),</span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">textAlign =</span> <span class="st">"center"</span></span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-f5308b4a3162ebab6e24" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f5308b4a3162ebab6e24">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;\">Teachers Retirement System (TRS) Monthly Pension Projection<\/caption>","data":[["2024 - 01","2024 - 02","2024 - 03","2024 - 04","2024 - 05","2024 - 06","2024 - 07","2024 - 08","2024 - 09","2024 - 10","2024 - 11","2024 - 12","2025 - 01","2025 - 02","2025 - 03","2025 - 04","2025 - 05","2025 - 06","2025 - 07","2025 - 08","2025 - 09","2025 - 10","2025 - 11","2025 - 12","2026 - 01","2026 - 02","2026 - 03","2026 - 04","2026 - 05","2026 - 06","2026 - 07","2026 - 08","2026 - 09","2026 - 10","2026 - 11","2026 - 12","2027 - 01","2027 - 02","2027 - 03","2027 - 04","2027 - 05","2027 - 06","2027 - 07","2027 - 08","2027 - 09","2027 - 10","2027 - 11","2027 - 12","2028 - 01","2028 - 02","2028 - 03","2028 - 04","2028 - 05","2028 - 06","2028 - 07","2028 - 08","2028 - 09","2028 - 10","2028 - 11","2028 - 12","2029 - 01","2029 - 02","2029 - 03","2029 - 04","2029 - 05","2029 - 06","2029 - 07","2029 - 08","2029 - 09","2029 - 10","2029 - 11","2029 - 12","2030 - 01","2030 - 02","2030 - 03","2030 - 04","2030 - 05","2030 - 06","2030 - 07","2030 - 08","2030 - 09","2030 - 10","2030 - 11","2030 - 12","2031 - 01","2031 - 02","2031 - 03","2031 - 04","2031 - 05","2031 - 06","2031 - 07","2031 - 08","2031 - 09","2031 - 10","2031 - 11","2031 - 12","2032 - 01","2032 - 02","2032 - 03","2032 - 04","2032 - 05","2032 - 06","2032 - 07","2032 - 08","2032 - 09","2032 - 10","2032 - 11","2032 - 12","2033 - 01","2033 - 02","2033 - 03","2033 - 04","2033 - 05","2033 - 06","2033 - 07","2033 - 08","2033 - 09","2033 - 10","2033 - 11","2033 - 12","2034 - 01","2034 - 02","2034 - 03","2034 - 04","2034 - 05","2034 - 06","2034 - 07","2034 - 08","2034 - 09","2034 - 10","2034 - 11","2034 - 12","2035 - 01","2035 - 02","2035 - 03","2035 - 04","2035 - 05","2035 - 06","2035 - 07","2035 - 08","2035 - 09","2035 - 10","2035 - 11","2035 - 12","2036 - 01","2036 - 02","2036 - 03","2036 - 04","2036 - 05","2036 - 06","2036 - 07","2036 - 08","2036 - 09","2036 - 10","2036 - 11","2036 - 12","2037 - 01","2037 - 02","2037 - 03","2037 - 04","2037 - 05","2037 - 06","2037 - 07","2037 - 08","2037 - 09","2037 - 10","2037 - 11","2037 - 12","2038 - 01","2038 - 02","2038 - 03","2038 - 04","2038 - 05","2038 - 06","2038 - 07","2038 - 08","2038 - 09","2038 - 10","2038 - 11","2038 - 12","2039 - 01","2039 - 02","2039 - 03","2039 - 04","2039 - 05","2039 - 06","2039 - 07","2039 - 08","2039 - 09","2039 - 10","2039 - 11","2039 - 12","2040 - 01","2040 - 02","2040 - 03","2040 - 04","2040 - 05","2040 - 06","2040 - 07","2040 - 08","2040 - 09","2040 - 10","2040 - 11","2040 - 12","2041 - 01","2041 - 02","2041 - 03","2041 - 04","2041 - 05","2041 - 06","2041 - 07","2041 - 08","2041 - 09","2041 - 10","2041 - 11","2041 - 12","2042 - 01","2042 - 02","2042 - 03","2042 - 04","2042 - 05","2042 - 06","2042 - 07","2042 - 08","2042 - 09","2042 - 10","2042 - 11","2042 - 12","2043 - 01","2043 - 02","2043 - 03","2043 - 04","2043 - 05","2043 - 06","2043 - 07","2043 - 08","2043 - 09","2043 - 10","2043 - 11","2043 - 12","2044 - 01","2044 - 02","2044 - 03","2044 - 04","2044 - 05","2044 - 06","2044 - 07","2044 - 08","2044 - 09","2044 - 10","2044 - 11","2044 - 12","2045 - 01","2045 - 02","2045 - 03","2045 - 04","2045 - 05","2045 - 06","2045 - 07","2045 - 08","2045 - 09","2045 - 10","2045 - 11","2045 - 12","2046 - 01","2046 - 02","2046 - 03","2046 - 04","2046 - 05","2046 - 06","2046 - 07","2046 - 08","2046 - 09","2046 - 10","2046 - 11","2046 - 12","2047 - 01","2047 - 02","2047 - 03","2047 - 04","2047 - 05","2047 - 06","2047 - 07","2047 - 08","2047 - 09","2047 - 10","2047 - 11","2047 - 12","2048 - 01","2048 - 02","2048 - 03","2048 - 04","2048 - 05","2048 - 06","2048 - 07","2048 - 08","2048 - 09","2048 - 10","2048 - 11","2048 - 12","2049 - 01","2049 - 02","2049 - 03","2049 - 04","2049 - 05","2049 - 06","2049 - 07","2049 - 08","2049 - 09","2049 - 10","2049 - 11","2049 - 12","2050 - 01","2050 - 02","2050 - 03","2050 - 04","2050 - 05","2050 - 06","2050 - 07","2050 - 08","2050 - 09","2050 - 10","2050 - 11","2050 - 12","2051 - 01","2051 - 02","2051 - 03","2051 - 04","2051 - 05","2051 - 06","2051 - 07","2051 - 08","2051 - 09","2051 - 10","2051 - 11","2051 - 12","2052 - 01","2052 - 02","2052 - 03","2052 - 04","2052 - 05","2052 - 06","2052 - 07","2052 - 08","2052 - 09","2052 - 10","2052 - 11","2052 - 12","2053 - 01","2053 - 02","2053 - 03","2053 - 04","2053 - 05","2053 - 06","2053 - 07","2053 - 08","2053 - 09","2053 - 10","2053 - 11","2053 - 12"],[1779,1779,1779,1779,1779,1779,1779,1779,1802.13,1802.13,1802.13,1802.13,1802.13,1802.13,1802.13,1802.13,1802.13,1802.13,1802.13,1802.13,1825.55,1825.55,1825.55,1825.55,1825.55,1825.55,1825.55,1825.55,1825.55,1825.55,1825.55,1825.55,1849.29,1849.29,1849.29,1849.29,1849.29,1849.29,1849.29,1849.29,1849.29,1849.29,1849.29,1849.29,1873.33,1873.33,1873.33,1873.33,1873.33,1873.33,1873.33,1873.33,1873.33,1873.33,1873.33,1873.33,1897.68,1897.68,1897.68,1897.68,1897.68,1897.68,1897.68,1897.68,1897.68,1897.68,1897.68,1897.68,1922.35,1922.35,1922.35,1922.35,1922.35,1922.35,1922.35,1922.35,1922.35,1922.35,1922.35,1922.35,1947.34,1947.34,1947.34,1947.34,1947.34,1947.34,1947.34,1947.34,1947.34,1947.34,1947.34,1947.34,1972.66,1972.66,1972.66,1972.66,1972.66,1972.66,1972.66,1972.66,1972.66,1972.66,1972.66,1972.66,1998.3,1998.3,1998.3,1998.3,1998.3,1998.3,1998.3,1998.3,1998.3,1998.3,1998.3,1998.3,2024.28,2024.28,2024.28,2024.28,2024.28,2024.28,2024.28,2024.28,2024.28,2024.28,2024.28,2024.28,2050.59,2050.59,2050.59,2050.59,2050.59,2050.59,2050.59,2050.59,2050.59,2050.59,2050.59,2050.59,2077.25,2077.25,2077.25,2077.25,2077.25,2077.25,2077.25,2077.25,2077.25,2077.25,2077.25,2077.25,2104.26,2104.26,2104.26,2104.26,2104.26,2104.26,2104.26,2104.26,2104.26,2104.26,2104.26,2104.26,2131.61,2131.61,2131.61,2131.61,2131.61,2131.61,2131.61,2131.61,2131.61,2131.61,2131.61,2131.61,2159.32,2159.32,2159.32,2159.32,2159.32,2159.32,2159.32,2159.32,2159.32,2159.32,2159.32,2159.32,2187.39,2187.39,2187.39,2187.39,2187.39,2187.39,2187.39,2187.39,2187.39,2187.39,2187.39,2187.39,2215.83,2215.83,2215.83,2215.83,2215.83,2215.83,2215.83,2215.83,2215.83,2215.83,2215.83,2215.83,2244.64,2244.64,2244.64,2244.64,2244.64,2244.64,2244.64,2244.64,2244.64,2244.64,2244.64,2244.64,2273.82,2273.82,2273.82,2273.82,2273.82,2273.82,2273.82,2273.82,2273.82,2273.82,2273.82,2273.82,2303.38,2303.38,2303.38,2303.38,2303.38,2303.38,2303.38,2303.38,2303.38,2303.38,2303.38,2303.38,2333.32,2333.32,2333.32,2333.32,2333.32,2333.32,2333.32,2333.32,2333.32,2333.32,2333.32,2333.32,2363.65,2363.65,2363.65,2363.65,2363.65,2363.65,2363.65,2363.65,2363.65,2363.65,2363.65,2363.65,2394.38,2394.38,2394.38,2394.38,2394.38,2394.38,2394.38,2394.38,2394.38,2394.38,2394.38,2394.38,2425.51,2425.51,2425.51,2425.51,2425.51,2425.51,2425.51,2425.51,2425.51,2425.51,2425.51,2425.51,2457.04,2457.04,2457.04,2457.04,2457.04,2457.04,2457.04,2457.04,2457.04,2457.04,2457.04,2457.04,2488.98,2488.98,2488.98,2488.98,2488.98,2488.98,2488.98,2488.98,2488.98,2488.98,2488.98,2488.98,2521.34,2521.34,2521.34,2521.34,2521.34,2521.34,2521.34,2521.34,2521.34,2521.34,2521.34,2521.34,2554.11,2554.11,2554.11,2554.11,2554.11,2554.11,2554.11,2554.11,2554.11,2554.11,2554.11,2554.11,2587.32,2587.32,2587.32,2587.32,2587.32,2587.32,2587.32,2587.32,2587.32,2587.32,2587.32,2587.32,2620.95,2620.95,2620.95,2620.95],[0,0,0,0,0,0,0,0,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3,1.3]],"container":"<table class=\"cell-border stripe\">\n  <thead>\n    <tr>\n      <th>Month<\/th>\n      <th>Monthly Benefit (USD)<\/th>\n      <th>Inflation Adjustment (%)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":12,"dom":"lfrtip","columnDefs":[{"className":"dt-center","targets":"_all"},{"name":"Month","targets":0},{"name":"Monthly_Benefit","targets":1},{"name":"Inflation_Adjustment","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,12,25,50,100],"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[0]; $(this.api().cell(row, 0).node()).css({'text-align':'center'});\nvar value=data[1]; $(this.api().cell(row, 1).node()).css({'text-align':'center'});\nvar value=data[2]; $(this.api().cell(row, 2).node()).css({'text-align':'center'});\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="comparison-of-monthly-payments-trs-vs-orp" class="level4">
<h4 class="anchored" data-anchor-id="comparison-of-monthly-payments-trs-vs-orp">Comparison of Monthly Payments: TRS vs ORP</h4>
<p>This code compares monthly payments under the Teachers Retirement System (TRS) and the Optional Retirement Plan (ORP) over the 30-year retirement period. It merges the datasets containing monthly benefits for TRS and ORP, renames columns for clarity, and rounds the monetary values for better readability. The resulting table is displayed interactively using the datatable function with formatted columns and a custom caption.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a comparison table for TRS and ORP monthly payments</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  trs_projection <span class="sc">|&gt;</span> <span class="fu">select</span>(Month, Monthly_Benefit),  </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  projection <span class="sc">|&gt;</span> <span class="fu">select</span>(Month, Monthly_Payment),     </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">"Month"</span>                                     </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(                                           </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">TRS_Monthly_Benefit =</span> Monthly_Benefit,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ORP_Monthly_Payment =</span> Monthly_Payment</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(                                           </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">TRS_Monthly_Benefit =</span> <span class="fu">round</span>(TRS_Monthly_Benefit, <span class="dv">2</span>),</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">ORP_Monthly_Payment =</span> <span class="fu">round</span>(ORP_Monthly_Payment, <span class="dv">2</span>)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Displaying the interactive comparison table</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  comparison <span class="sc">|&gt;</span> </span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">format</span>(Month, <span class="st">"%Y-%m"</span>)),         </span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;"</span>,</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Comparison of Monthly Payments: TRS vs ORP"</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">colnames =</span> <span class="fu">c</span>(<span class="st">"Month"</span>, <span class="st">"TRS Monthly Benefit (USD)"</span>, <span class="st">"ORP Monthly Payment (USD)"</span>),  </span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(                               </span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">12</span>,                            </span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'lfrtip'</span>,                              </span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">className =</span> <span class="st">"dt-center"</span>, <span class="at">targets =</span> <span class="st">"_all"</span>))  </span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,                              </span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">'cell-border stripe'</span>                  </span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-c38085676cedb6018de8" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c38085676cedb6018de8">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;\">Comparison of Monthly Payments: TRS vs ORP<\/caption>","data":[["2024-01","2024-02","2024-03","2024-04","2024-05","2024-06","2024-07","2024-08","2024-09","2024-10","2024-11","2024-12","2025-01","2025-02","2025-03","2025-04","2025-05","2025-06","2025-07","2025-08","2025-09","2025-10","2025-11","2025-12","2026-01","2026-02","2026-03","2026-04","2026-05","2026-06","2026-07","2026-08","2026-09","2026-10","2026-11","2026-12","2027-01","2027-02","2027-03","2027-04","2027-05","2027-06","2027-07","2027-08","2027-09","2027-10","2027-11","2027-12","2028-01","2028-02","2028-03","2028-04","2028-05","2028-06","2028-07","2028-08","2028-09","2028-10","2028-11","2028-12","2029-01","2029-02","2029-03","2029-04","2029-05","2029-06","2029-07","2029-08","2029-09","2029-10","2029-11","2029-12","2030-01","2030-02","2030-03","2030-04","2030-05","2030-06","2030-07","2030-08","2030-09","2030-10","2030-11","2030-12","2031-01","2031-02","2031-03","2031-04","2031-05","2031-06","2031-07","2031-08","2031-09","2031-10","2031-11","2031-12","2032-01","2032-02","2032-03","2032-04","2032-05","2032-06","2032-07","2032-08","2032-09","2032-10","2032-11","2032-12","2033-01","2033-02","2033-03","2033-04","2033-05","2033-06","2033-07","2033-08","2033-09","2033-10","2033-11","2033-12","2034-01","2034-02","2034-03","2034-04","2034-05","2034-06","2034-07","2034-08","2034-09","2034-10","2034-11","2034-12","2035-01","2035-02","2035-03","2035-04","2035-05","2035-06","2035-07","2035-08","2035-09","2035-10","2035-11","2035-12","2036-01","2036-02","2036-03","2036-04","2036-05","2036-06","2036-07","2036-08","2036-09","2036-10","2036-11","2036-12","2037-01","2037-02","2037-03","2037-04","2037-05","2037-06","2037-07","2037-08","2037-09","2037-10","2037-11","2037-12","2038-01","2038-02","2038-03","2038-04","2038-05","2038-06","2038-07","2038-08","2038-09","2038-10","2038-11","2038-12","2039-01","2039-02","2039-03","2039-04","2039-05","2039-06","2039-07","2039-08","2039-09","2039-10","2039-11","2039-12","2040-01","2040-02","2040-03","2040-04","2040-05","2040-06","2040-07","2040-08","2040-09","2040-10","2040-11","2040-12","2041-01","2041-02","2041-03","2041-04","2041-05","2041-06","2041-07","2041-08","2041-09","2041-10","2041-11","2041-12","2042-01","2042-02","2042-03","2042-04","2042-05","2042-06","2042-07","2042-08","2042-09","2042-10","2042-11","2042-12","2043-01","2043-02","2043-03","2043-04","2043-05","2043-06","2043-07","2043-08","2043-09","2043-10","2043-11","2043-12","2044-01","2044-02","2044-03","2044-04","2044-05","2044-06","2044-07","2044-08","2044-09","2044-10","2044-11","2044-12","2045-01","2045-02","2045-03","2045-04","2045-05","2045-06","2045-07","2045-08","2045-09","2045-10","2045-11","2045-12","2046-01","2046-02","2046-03","2046-04","2046-05","2046-06","2046-07","2046-08","2046-09","2046-10","2046-11","2046-12","2047-01","2047-02","2047-03","2047-04","2047-05","2047-06","2047-07","2047-08","2047-09","2047-10","2047-11","2047-12","2048-01","2048-02","2048-03","2048-04","2048-05","2048-06","2048-07","2048-08","2048-09","2048-10","2048-11","2048-12","2049-01","2049-02","2049-03","2049-04","2049-05","2049-06","2049-07","2049-08","2049-09","2049-10","2049-11","2049-12","2050-01","2050-02","2050-03","2050-04","2050-05","2050-06","2050-07","2050-08","2050-09","2050-10","2050-11","2050-12","2051-01","2051-02","2051-03","2051-04","2051-05","2051-06","2051-07","2051-08","2051-09","2051-10","2051-11","2051-12","2052-01","2052-02","2052-03","2052-04","2052-05","2052-06","2052-07","2052-08","2052-09","2052-10","2052-11","2052-12","2053-01","2053-02","2053-03","2053-04","2053-05","2053-06","2053-07","2053-08","2053-09","2053-10","2053-11","2053-12"],[1779,1779,1779,1779,1779,1779,1779,1779,1802.13,1802.13,1802.13,1802.13,1802.13,1802.13,1802.13,1802.13,1802.13,1802.13,1802.13,1802.13,1825.55,1825.55,1825.55,1825.55,1825.55,1825.55,1825.55,1825.55,1825.55,1825.55,1825.55,1825.55,1849.29,1849.29,1849.29,1849.29,1849.29,1849.29,1849.29,1849.29,1849.29,1849.29,1849.29,1849.29,1873.33,1873.33,1873.33,1873.33,1873.33,1873.33,1873.33,1873.33,1873.33,1873.33,1873.33,1873.33,1897.68,1897.68,1897.68,1897.68,1897.68,1897.68,1897.68,1897.68,1897.68,1897.68,1897.68,1897.68,1922.35,1922.35,1922.35,1922.35,1922.35,1922.35,1922.35,1922.35,1922.35,1922.35,1922.35,1922.35,1947.34,1947.34,1947.34,1947.34,1947.34,1947.34,1947.34,1947.34,1947.34,1947.34,1947.34,1947.34,1972.66,1972.66,1972.66,1972.66,1972.66,1972.66,1972.66,1972.66,1972.66,1972.66,1972.66,1972.66,1998.3,1998.3,1998.3,1998.3,1998.3,1998.3,1998.3,1998.3,1998.3,1998.3,1998.3,1998.3,2024.28,2024.28,2024.28,2024.28,2024.28,2024.28,2024.28,2024.28,2024.28,2024.28,2024.28,2024.28,2050.59,2050.59,2050.59,2050.59,2050.59,2050.59,2050.59,2050.59,2050.59,2050.59,2050.59,2050.59,2077.25,2077.25,2077.25,2077.25,2077.25,2077.25,2077.25,2077.25,2077.25,2077.25,2077.25,2077.25,2104.26,2104.26,2104.26,2104.26,2104.26,2104.26,2104.26,2104.26,2104.26,2104.26,2104.26,2104.26,2131.61,2131.61,2131.61,2131.61,2131.61,2131.61,2131.61,2131.61,2131.61,2131.61,2131.61,2131.61,2159.32,2159.32,2159.32,2159.32,2159.32,2159.32,2159.32,2159.32,2159.32,2159.32,2159.32,2159.32,2187.39,2187.39,2187.39,2187.39,2187.39,2187.39,2187.39,2187.39,2187.39,2187.39,2187.39,2187.39,2215.83,2215.83,2215.83,2215.83,2215.83,2215.83,2215.83,2215.83,2215.83,2215.83,2215.83,2215.83,2244.64,2244.64,2244.64,2244.64,2244.64,2244.64,2244.64,2244.64,2244.64,2244.64,2244.64,2244.64,2273.82,2273.82,2273.82,2273.82,2273.82,2273.82,2273.82,2273.82,2273.82,2273.82,2273.82,2273.82,2303.38,2303.38,2303.38,2303.38,2303.38,2303.38,2303.38,2303.38,2303.38,2303.38,2303.38,2303.38,2333.32,2333.32,2333.32,2333.32,2333.32,2333.32,2333.32,2333.32,2333.32,2333.32,2333.32,2333.32,2363.65,2363.65,2363.65,2363.65,2363.65,2363.65,2363.65,2363.65,2363.65,2363.65,2363.65,2363.65,2394.38,2394.38,2394.38,2394.38,2394.38,2394.38,2394.38,2394.38,2394.38,2394.38,2394.38,2394.38,2425.51,2425.51,2425.51,2425.51,2425.51,2425.51,2425.51,2425.51,2425.51,2425.51,2425.51,2425.51,2457.04,2457.04,2457.04,2457.04,2457.04,2457.04,2457.04,2457.04,2457.04,2457.04,2457.04,2457.04,2488.98,2488.98,2488.98,2488.98,2488.98,2488.98,2488.98,2488.98,2488.98,2488.98,2488.98,2488.98,2521.34,2521.34,2521.34,2521.34,2521.34,2521.34,2521.34,2521.34,2521.34,2521.34,2521.34,2521.34,2554.11,2554.11,2554.11,2554.11,2554.11,2554.11,2554.11,2554.11,2554.11,2554.11,2554.11,2554.11,2587.32,2587.32,2587.32,2587.32,2587.32,2587.32,2587.32,2587.32,2587.32,2587.32,2587.32,2587.32,2620.95,2620.95,2620.95,2620.95],[723.22,727.79,729.9400000000001,732.12,734.3,736.51,738.73,740.97,743.23,745.5,747.8,750.1,752.4299999999999,754.77,757.14,759.51,761.91,764.33,766.76,769.21,771.6799999999999,774.17,776.6799999999999,779.21,781.75,784.3200000000001,786.9,789.5,792.13,794.77,797.4299999999999,800.11,802.8200000000001,805.54,808.28,811.05,813.83,816.64,819.46,822.3099999999999,825.1799999999999,828.0700000000001,830.98,833.92,836.87,839.85,842.85,845.87,848.91,851.98,855.0700000000001,858.1799999999999,861.3200000000001,864.48,867.66,870.87,874.1,877.34,880.6,883.88,887.1799999999999,890.5,893.83,897.1799999999999,900.55,903.9400000000001,907.34,910.76,914.2,917.66,921.14,924.64,928.15,931.6900000000001,935.24,938.8099999999999,942.4,946.01,949.64,953.29,956.96,960.65,964.36,968.09,971.84,975.61,979.39,983.2,987.03,990.88,994.75,998.65,1002.56,1006.49,1010.45,1014.42,1018.42,1022.44,1026.48,1030.54,1034.63,1038.74,1042.86,1047.02,1051.19,1055.39,1059.6,1063.85,1068.11,1072.4,1076.71,1081.04,1085.4,1089.78,1094.19,1098.62,1103.07,1107.55,1112.05,1116.57,1121.12,1125.7,1130.3,1134.92,1139.57,1144.25,1148.95,1153.67,1158.42,1163.2,1168,1172.83,1177.69,1182.57,1187.48,1192.41,1197.38,1202.37,1207.38,1212.43,1217.5,1222.59,1227.72,1232.88,1238.06,1243.27,1248.51,1253.78,1259.07,1264.4,1269.75,1275.14,1280.55,1285.99,1291.46,1296.97,1302.5,1308.06,1313.65,1319.28,1324.93,1330.62,1336.33,1342.08,1347.86,1353.67,1359.51,1365.39,1371.29,1377.23,1383.2,1389.21,1395.24,1401.31,1407.42,1413.55,1419.72,1425.93,1432.17,1438.44,1444.75,1451.09,1457.47,1463.88,1470.32,1476.81,1483.32,1489.88,1496.47,1503.09,1509.76,1516.45,1523.19,1529.96,1536.77,1543.62,1550.51,1557.43,1564.39,1571.39,1578.43,1585.51,1592.62,1599.78,1606.97,1614.19,1621.44,1628.73,1636.05,1643.41,1650.79,1658.21,1665.67,1673.15,1680.67,1688.23,1695.81,1703.44,1711.09,1718.78,1726.51,1734.27,1742.06,1749.89,1757.76,1765.66,1773.6,1781.57,1789.57,1797.62,1805.7,1813.81,1821.97,1830.15,1838.38,1846.64,1854.94,1863.28,1871.66,1880.07,1888.52,1897.01,1905.53,1914.1,1922.7,1931.34,1940.02,1948.74,1957.5,1966.3,1975.14,1984.02,1992.93,2001.89,2010.89,2019.93,2029,2038.12,2047.29,2056.49,2065.73,2075.01,2084.34,2093.71,2103.12,2112.57,2122.07,2131.61,2141.19,2150.81,2160.48,2170.19,2179.94,2189.74,2199.58,2209.47,2219.4,2229.37,2239.4,2249.46,2259.57,2269.73,2279.93,2290.18,2300.47,2310.81,2321.2,2331.63,2342.11,2352.63,2363.21,2373.83,2384.5,2395.22,2405.98,2416.8,2427.66,2438.57,2449.53,2460.54,2471.6,2482.71,2493.87,2505.08,2516.34,2527.65,2539.01,2550.42,2561.88,2573.4,2584.96,2596.58,2608.25,2619.98,2631.75,2643.58,2655.46,2667.4,2679.39,2691.43,2703.53,2715.68,2727.88,2740.15,2752.46,2764.83,2777.26,2789.74,2802.28,2814.88,2827.53,2840.24,2853,2865.83,2878.71,2891.65,2904.64,2917.7,2930.81,2943.98,2957.22,2970.51,2983.86,2997.27,3010.74,3024.27,3037.87,3051.52,3065.24,3079.01,3092.85,3106.75,3120.72,3134.74,3148.83,3162.99,3177.2,3191.48,3205.83,3220.24]],"container":"<table class=\"cell-border stripe\">\n  <thead>\n    <tr>\n      <th>Month<\/th>\n      <th>TRS Monthly Benefit (USD)<\/th>\n      <th>ORP Monthly Payment (USD)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":12,"dom":"lfrtip","columnDefs":[{"className":"dt-center","targets":"_all"},{"name":"Month","targets":0},{"name":"TRS_Monthly_Benefit","targets":1},{"name":"ORP_Monthly_Payment","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,12,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="comparison-of-monthly-payments-and-accumulated-totals-trs-vs-orp" class="level4">
<h4 class="anchored" data-anchor-id="comparison-of-monthly-payments-and-accumulated-totals-trs-vs-orp">Comparison of Monthly Payments and Accumulated Totals: TRS vs ORP</h4>
<p>This table presents the monthly pension payments, the total investment portfolio, the accumulated TRS payments over 30 years, and the combined ORP plan monthly payments with the total investment portfolio.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a comparison table for TRS and ORP monthly payments</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  trs_projection <span class="sc">|&gt;</span> <span class="fu">select</span>(Month, Monthly_Benefit),  </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  projection <span class="sc">|&gt;</span> <span class="fu">select</span>(Month, Monthly_Payment, Total_Portfolio),     </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">"Month"</span>                                     </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(                                           </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">TRS_Monthly_Benefit =</span> Monthly_Benefit,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ORP_Monthly_Payment =</span> Monthly_Payment</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(                                           </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">TRS_Monthly_Benefit =</span> <span class="fu">round</span>(TRS_Monthly_Benefit, <span class="dv">2</span>),</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">ORP_Monthly_Payment =</span> <span class="fu">round</span>(ORP_Monthly_Payment, <span class="dv">2</span>),</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Total_Portfolio =</span> <span class="fu">round</span>(Total_Portfolio, <span class="dv">2</span>)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">Accumulated_TRS_Payments =</span> <span class="fu">round</span>(<span class="fu">cumsum</span>(TRS_Monthly_Benefit), <span class="dv">2</span>),  <span class="co"># Cumulative TRS payments, rounded</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">ORP_Payment_with_Total =</span> <span class="fu">round</span>(ORP_Monthly_Payment <span class="sc">+</span> Total_Portfolio, <span class="dv">2</span>)  <span class="co"># ORP Payment + Total Investment, rounded</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Displaying the interactive comparison table</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>  comparison <span class="sc">|&gt;</span> </span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">format</span>(Month, <span class="st">"%Y-%m"</span>)),         </span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> htmltools<span class="sc">::</span>tags<span class="sc">$</span><span class="fu">caption</span>(</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;"</span>,</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Comparison of Monthly Payments and Accumulated Totals: TRS vs ORP"</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">colnames =</span> <span class="fu">c</span>(</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Month"</span>, </span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"TRS Monthly Benefit (USD)"</span>, </span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ORP Monthly Payment (USD)"</span>, </span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Total Portfolio (USD)"</span>, </span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Accumulated TRS Payments (USD)"</span>, </span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ORP Payment + Total Portfolio (USD)"</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>  ),  </span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(                               </span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">12</span>,                            </span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'lfrtip'</span>,                              </span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">className =</span> <span class="st">"dt-center"</span>, <span class="at">targets =</span> <span class="st">"_all"</span>))  </span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,                              </span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">'cell-border stripe'</span>                  </span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatStyle</span>(</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"Month"</span>, <span class="st">"TRS_Monthly_Benefit"</span>, <span class="st">"ORP_Monthly_Payment"</span>, <span class="st">"Total_Portfolio"</span>, <span class="st">"Accumulated_TRS_Payments"</span>, <span class="st">"ORP_Payment_with_Total"</span>),</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">textAlign =</span> <span class="st">"center"</span></span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-2bba433447ebd49487cc" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-2bba433447ebd49487cc">{"x":{"filter":"none","vertical":false,"caption":"<caption style=\"caption-side: top; text-align: center; font-weight: bold; font-size: 20px;\">Comparison of Monthly Payments and Accumulated Totals: TRS vs ORP<\/caption>","data":[["2024-01","2024-02","2024-03","2024-04","2024-05","2024-06","2024-07","2024-08","2024-09","2024-10","2024-11","2024-12","2025-01","2025-02","2025-03","2025-04","2025-05","2025-06","2025-07","2025-08","2025-09","2025-10","2025-11","2025-12","2026-01","2026-02","2026-03","2026-04","2026-05","2026-06","2026-07","2026-08","2026-09","2026-10","2026-11","2026-12","2027-01","2027-02","2027-03","2027-04","2027-05","2027-06","2027-07","2027-08","2027-09","2027-10","2027-11","2027-12","2028-01","2028-02","2028-03","2028-04","2028-05","2028-06","2028-07","2028-08","2028-09","2028-10","2028-11","2028-12","2029-01","2029-02","2029-03","2029-04","2029-05","2029-06","2029-07","2029-08","2029-09","2029-10","2029-11","2029-12","2030-01","2030-02","2030-03","2030-04","2030-05","2030-06","2030-07","2030-08","2030-09","2030-10","2030-11","2030-12","2031-01","2031-02","2031-03","2031-04","2031-05","2031-06","2031-07","2031-08","2031-09","2031-10","2031-11","2031-12","2032-01","2032-02","2032-03","2032-04","2032-05","2032-06","2032-07","2032-08","2032-09","2032-10","2032-11","2032-12","2033-01","2033-02","2033-03","2033-04","2033-05","2033-06","2033-07","2033-08","2033-09","2033-10","2033-11","2033-12","2034-01","2034-02","2034-03","2034-04","2034-05","2034-06","2034-07","2034-08","2034-09","2034-10","2034-11","2034-12","2035-01","2035-02","2035-03","2035-04","2035-05","2035-06","2035-07","2035-08","2035-09","2035-10","2035-11","2035-12","2036-01","2036-02","2036-03","2036-04","2036-05","2036-06","2036-07","2036-08","2036-09","2036-10","2036-11","2036-12","2037-01","2037-02","2037-03","2037-04","2037-05","2037-06","2037-07","2037-08","2037-09","2037-10","2037-11","2037-12","2038-01","2038-02","2038-03","2038-04","2038-05","2038-06","2038-07","2038-08","2038-09","2038-10","2038-11","2038-12","2039-01","2039-02","2039-03","2039-04","2039-05","2039-06","2039-07","2039-08","2039-09","2039-10","2039-11","2039-12","2040-01","2040-02","2040-03","2040-04","2040-05","2040-06","2040-07","2040-08","2040-09","2040-10","2040-11","2040-12","2041-01","2041-02","2041-03","2041-04","2041-05","2041-06","2041-07","2041-08","2041-09","2041-10","2041-11","2041-12","2042-01","2042-02","2042-03","2042-04","2042-05","2042-06","2042-07","2042-08","2042-09","2042-10","2042-11","2042-12","2043-01","2043-02","2043-03","2043-04","2043-05","2043-06","2043-07","2043-08","2043-09","2043-10","2043-11","2043-12","2044-01","2044-02","2044-03","2044-04","2044-05","2044-06","2044-07","2044-08","2044-09","2044-10","2044-11","2044-12","2045-01","2045-02","2045-03","2045-04","2045-05","2045-06","2045-07","2045-08","2045-09","2045-10","2045-11","2045-12","2046-01","2046-02","2046-03","2046-04","2046-05","2046-06","2046-07","2046-08","2046-09","2046-10","2046-11","2046-12","2047-01","2047-02","2047-03","2047-04","2047-05","2047-06","2047-07","2047-08","2047-09","2047-10","2047-11","2047-12","2048-01","2048-02","2048-03","2048-04","2048-05","2048-06","2048-07","2048-08","2048-09","2048-10","2048-11","2048-12","2049-01","2049-02","2049-03","2049-04","2049-05","2049-06","2049-07","2049-08","2049-09","2049-10","2049-11","2049-12","2050-01","2050-02","2050-03","2050-04","2050-05","2050-06","2050-07","2050-08","2050-09","2050-10","2050-11","2050-12","2051-01","2051-02","2051-03","2051-04","2051-05","2051-06","2051-07","2051-08","2051-09","2051-10","2051-11","2051-12","2052-01","2052-02","2052-03","2052-04","2052-05","2052-06","2052-07","2052-08","2052-09","2052-10","2052-11","2052-12","2053-01","2053-02","2053-03","2053-04","2053-05","2053-06","2053-07","2053-08","2053-09","2053-10","2053-11","2053-12"],[1779,1779,1779,1779,1779,1779,1779,1779,1802.13,1802.13,1802.13,1802.13,1802.13,1802.13,1802.13,1802.13,1802.13,1802.13,1802.13,1802.13,1825.55,1825.55,1825.55,1825.55,1825.55,1825.55,1825.55,1825.55,1825.55,1825.55,1825.55,1825.55,1849.29,1849.29,1849.29,1849.29,1849.29,1849.29,1849.29,1849.29,1849.29,1849.29,1849.29,1849.29,1873.33,1873.33,1873.33,1873.33,1873.33,1873.33,1873.33,1873.33,1873.33,1873.33,1873.33,1873.33,1897.68,1897.68,1897.68,1897.68,1897.68,1897.68,1897.68,1897.68,1897.68,1897.68,1897.68,1897.68,1922.35,1922.35,1922.35,1922.35,1922.35,1922.35,1922.35,1922.35,1922.35,1922.35,1922.35,1922.35,1947.34,1947.34,1947.34,1947.34,1947.34,1947.34,1947.34,1947.34,1947.34,1947.34,1947.34,1947.34,1972.66,1972.66,1972.66,1972.66,1972.66,1972.66,1972.66,1972.66,1972.66,1972.66,1972.66,1972.66,1998.3,1998.3,1998.3,1998.3,1998.3,1998.3,1998.3,1998.3,1998.3,1998.3,1998.3,1998.3,2024.28,2024.28,2024.28,2024.28,2024.28,2024.28,2024.28,2024.28,2024.28,2024.28,2024.28,2024.28,2050.59,2050.59,2050.59,2050.59,2050.59,2050.59,2050.59,2050.59,2050.59,2050.59,2050.59,2050.59,2077.25,2077.25,2077.25,2077.25,2077.25,2077.25,2077.25,2077.25,2077.25,2077.25,2077.25,2077.25,2104.26,2104.26,2104.26,2104.26,2104.26,2104.26,2104.26,2104.26,2104.26,2104.26,2104.26,2104.26,2131.61,2131.61,2131.61,2131.61,2131.61,2131.61,2131.61,2131.61,2131.61,2131.61,2131.61,2131.61,2159.32,2159.32,2159.32,2159.32,2159.32,2159.32,2159.32,2159.32,2159.32,2159.32,2159.32,2159.32,2187.39,2187.39,2187.39,2187.39,2187.39,2187.39,2187.39,2187.39,2187.39,2187.39,2187.39,2187.39,2215.83,2215.83,2215.83,2215.83,2215.83,2215.83,2215.83,2215.83,2215.83,2215.83,2215.83,2215.83,2244.64,2244.64,2244.64,2244.64,2244.64,2244.64,2244.64,2244.64,2244.64,2244.64,2244.64,2244.64,2273.82,2273.82,2273.82,2273.82,2273.82,2273.82,2273.82,2273.82,2273.82,2273.82,2273.82,2273.82,2303.38,2303.38,2303.38,2303.38,2303.38,2303.38,2303.38,2303.38,2303.38,2303.38,2303.38,2303.38,2333.32,2333.32,2333.32,2333.32,2333.32,2333.32,2333.32,2333.32,2333.32,2333.32,2333.32,2333.32,2363.65,2363.65,2363.65,2363.65,2363.65,2363.65,2363.65,2363.65,2363.65,2363.65,2363.65,2363.65,2394.38,2394.38,2394.38,2394.38,2394.38,2394.38,2394.38,2394.38,2394.38,2394.38,2394.38,2394.38,2425.51,2425.51,2425.51,2425.51,2425.51,2425.51,2425.51,2425.51,2425.51,2425.51,2425.51,2425.51,2457.04,2457.04,2457.04,2457.04,2457.04,2457.04,2457.04,2457.04,2457.04,2457.04,2457.04,2457.04,2488.98,2488.98,2488.98,2488.98,2488.98,2488.98,2488.98,2488.98,2488.98,2488.98,2488.98,2488.98,2521.34,2521.34,2521.34,2521.34,2521.34,2521.34,2521.34,2521.34,2521.34,2521.34,2521.34,2521.34,2554.11,2554.11,2554.11,2554.11,2554.11,2554.11,2554.11,2554.11,2554.11,2554.11,2554.11,2554.11,2587.32,2587.32,2587.32,2587.32,2587.32,2587.32,2587.32,2587.32,2587.32,2587.32,2587.32,2587.32,2620.95,2620.95,2620.95,2620.95],[723.22,727.79,729.9400000000001,732.12,734.3,736.51,738.73,740.97,743.23,745.5,747.8,750.1,752.4299999999999,754.77,757.14,759.51,761.91,764.33,766.76,769.21,771.6799999999999,774.17,776.6799999999999,779.21,781.75,784.3200000000001,786.9,789.5,792.13,794.77,797.4299999999999,800.11,802.8200000000001,805.54,808.28,811.05,813.83,816.64,819.46,822.3099999999999,825.1799999999999,828.0700000000001,830.98,833.92,836.87,839.85,842.85,845.87,848.91,851.98,855.0700000000001,858.1799999999999,861.3200000000001,864.48,867.66,870.87,874.1,877.34,880.6,883.88,887.1799999999999,890.5,893.83,897.1799999999999,900.55,903.9400000000001,907.34,910.76,914.2,917.66,921.14,924.64,928.15,931.6900000000001,935.24,938.8099999999999,942.4,946.01,949.64,953.29,956.96,960.65,964.36,968.09,971.84,975.61,979.39,983.2,987.03,990.88,994.75,998.65,1002.56,1006.49,1010.45,1014.42,1018.42,1022.44,1026.48,1030.54,1034.63,1038.74,1042.86,1047.02,1051.19,1055.39,1059.6,1063.85,1068.11,1072.4,1076.71,1081.04,1085.4,1089.78,1094.19,1098.62,1103.07,1107.55,1112.05,1116.57,1121.12,1125.7,1130.3,1134.92,1139.57,1144.25,1148.95,1153.67,1158.42,1163.2,1168,1172.83,1177.69,1182.57,1187.48,1192.41,1197.38,1202.37,1207.38,1212.43,1217.5,1222.59,1227.72,1232.88,1238.06,1243.27,1248.51,1253.78,1259.07,1264.4,1269.75,1275.14,1280.55,1285.99,1291.46,1296.97,1302.5,1308.06,1313.65,1319.28,1324.93,1330.62,1336.33,1342.08,1347.86,1353.67,1359.51,1365.39,1371.29,1377.23,1383.2,1389.21,1395.24,1401.31,1407.42,1413.55,1419.72,1425.93,1432.17,1438.44,1444.75,1451.09,1457.47,1463.88,1470.32,1476.81,1483.32,1489.88,1496.47,1503.09,1509.76,1516.45,1523.19,1529.96,1536.77,1543.62,1550.51,1557.43,1564.39,1571.39,1578.43,1585.51,1592.62,1599.78,1606.97,1614.19,1621.44,1628.73,1636.05,1643.41,1650.79,1658.21,1665.67,1673.15,1680.67,1688.23,1695.81,1703.44,1711.09,1718.78,1726.51,1734.27,1742.06,1749.89,1757.76,1765.66,1773.6,1781.57,1789.57,1797.62,1805.7,1813.81,1821.97,1830.15,1838.38,1846.64,1854.94,1863.28,1871.66,1880.07,1888.52,1897.01,1905.53,1914.1,1922.7,1931.34,1940.02,1948.74,1957.5,1966.3,1975.14,1984.02,1992.93,2001.89,2010.89,2019.93,2029,2038.12,2047.29,2056.49,2065.73,2075.01,2084.34,2093.71,2103.12,2112.57,2122.07,2131.61,2141.19,2150.81,2160.48,2170.19,2179.94,2189.74,2199.58,2209.47,2219.4,2229.37,2239.4,2249.46,2259.57,2269.73,2279.93,2290.18,2300.47,2310.81,2321.2,2331.63,2342.11,2352.63,2363.21,2373.83,2384.5,2395.22,2405.98,2416.8,2427.66,2438.57,2449.53,2460.54,2471.6,2482.71,2493.87,2505.08,2516.34,2527.65,2539.01,2550.42,2561.88,2573.4,2584.96,2596.58,2608.25,2619.98,2631.75,2643.58,2655.46,2667.4,2679.39,2691.43,2703.53,2715.68,2727.88,2740.15,2752.46,2764.83,2777.26,2789.74,2802.28,2814.88,2827.53,2840.24,2853,2865.83,2878.71,2891.65,2904.64,2917.7,2930.81,2943.98,2957.22,2970.51,2983.86,2997.27,3010.74,3024.27,3037.87,3051.52,3065.24,3079.01,3092.85,3106.75,3120.72,3134.74,3148.83,3162.99,3177.2,3191.48,3205.83,3220.24],[216965.47,218335.62,218982.62,219634.53,220291.41,220953.27,221620.16,222292.12,222969.17,223651.36,224338.72,225031.28,225729.09,226432.18,227140.58,227854.35,228573.5,229298.08,230028.14,230763.7,231504.8,232251.5,233003.81,233761.8,234525.48,235294.91,236070.13,236851.17,237638.08,238430.89,239229.66,240034.41,240845.2,241662.07,242485.06,243314.21,244149.56,244991.16,245839.06,246693.29,247553.91,248420.95,249294.47,250174.51,251061.1,251954.31,252854.18,253760.75,254674.07,255594.19,256521.16,257455.02,258395.83,259343.62,260298.46,261260.39,262228.83,263202.43,264181.21,265165.22,266154.48,267149.01,268148.85,269154.04,270164.59,271180.54,272201.91,273228.75,274261.08,275298.93,276342.34,277391.33,278445.93,279506.18,280572.12,281643.76,282721.15,283804.31,284893.28,285988.1,287088.79,288195.38,289307.92,290426.43,291550.96,292681.52,293818.16,294960.91,296109.81,297264.89,298426.19,299593.73,300767.56,301947.71,303134.22,304327.12,305526.45,306732.25,307944.54,309163.38,310388.79,311620.82,312859.49,314104.85,315356.94,316615.8,317881.45,319153.94,320433.32,321719.61,323012.86,324313.1,325620.38,326934.74,328256.21,329584.84,330920.67,332263.73,333614.07,334971.73,336336.75,337709.17,339089.04,340476.4,341871.28,343273.73,344683.8,346101.53,347526.95,348960.12,350401.08,351849.87,353306.53,354771.12,356243.67,357724.24,359212.86,360709.58,362214.45,363727.51,365248.81,366778.4,368316.33,369862.63,371417.36,372980.57,374552.3,376132.61,377721.53,379319.13,380925.44,382540.52,384164.42,385797.19,387438.87,389089.52,390749.19,392417.94,394095.8,395782.83,397479.09,399184.63,400899.5,402623.75,404357.44,406100.61,407853.33,409615.65,411387.61,413169.29,414960.72,416761.97,418573.09,420394.14,422225.18,424066.25,425917.42,427778.75,429650.29,431532.1,433424.23,435326.76,437239.73,439163.2,441097.24,443041.9,444997.25,446963.34,448940.24,450928,452926.7,454936.38,456957.12,458988.97,461032,463086.27,465151.85,467228.8,469317.18,471417.06,473528.51,475651.58,477786.35,479932.88,482090,484256.82,486433.37,488619.71,490815.87,493021.91,495237.86,497463.77,499699.69,501945.65,504201.71,506467.91,508744.3,511030.92,513327.81,515635.03,517952.62,520280.63,522619.1,524968.0699999999,527327.61,529697.76,532078.55,534470.05,536872.29,539285.33,541709.22,544144.01,546589.73,549046.45,551514.21,553993.0600000001,556483.0600000001,558984.24,561496.67,564020.39,566555.45,569101.91,571659.8100000001,574229.21,576810.16,579402.71,582006.91,584622.8199999999,587250.48,589889.95,592541.29,595204.55,597879.77,600567.02,603266.35,605977.8100000001,608701.45,611437.34,614185.52,616946.0600000001,619719.01,622504.41,625302.34,628112.84,630935.98,633771.8,636620.37,639481.75,642355.98,645243.13,648143.26,651056.4300000001,653982.6800000001,656922.09,659874.72,662840.61,665819.83,668812.45,671818.51,674838.09,677871.24,680918.02,683978.49,687052.72,690140.77,693242.7,696358.5699999999,699488.4399999999,702632.38,705790.46,708962.72,712149.25,715350.1,718565.33,721795.02,725039.22,728298,731571.4300000001,734859.5699999999,738162.5,741480.26,744812.9399999999,748160.6,751523.3100000001,754901.13,758294.13,761702.38,765125.95,768564.91,772019.33,775489.27,778974.8,782476.01,785992.95,789525.7,793074.3199999999,796638.9,800219.5,803816.1899999999,807429.04,811058.14,814703.54,818365.34,822043.59,825738.37,829449.76,833177.83,836922.65,840684.3100000001,844462.88,848258.42,852071.03,855900.78,859747.73,863611.98,867493.6,871392.66,875309.25,879243.4399999999,883195.3199999999,887164.95,891152.4300000001,895157.83,899181.24,903222.72,907282.37,911360.27,915456.5,919571.14,923704.27,927855.98,932026.35,936215.46,940423.41,944650.26,948896.12,953161.05,957445.16,961748.52,966071.23],[1779,3558,5337,7116,8895,10674,12453,14232,16034.13,17836.26,19638.39,21440.52,23242.65,25044.78,26846.91,28649.04,30451.17,32253.3,34055.43,35857.56,37683.11,39508.66,41334.21,43159.76,44985.31,46810.86,48636.41,50461.96,52287.51,54113.06,55938.61,57764.16,59613.45,61462.74,63312.03,65161.32,67010.61,68859.89999999999,70709.19,72558.48,74407.77,76257.06,78106.35000000001,79955.64,81828.97,83702.3,85575.63,87448.96000000001,89322.28999999999,91195.62,93068.95,94942.28,96815.61,98688.94,100562.27,102435.6,104333.28,106230.96,108128.64,110026.32,111924,113821.68,115719.36,117617.04,119514.72,121412.4,123310.08,125207.76,127130.11,129052.46,130974.81,132897.16,134819.51,136741.86,138664.21,140586.56,142508.91,144431.26,146353.61,148275.96,150223.3,152170.64,154117.98,156065.32,158012.66,159960,161907.34,163854.68,165802.02,167749.36,169696.7,171644.04,173616.7,175589.36,177562.02,179534.68,181507.34,183480,185452.66,187425.32,189397.98,191370.64,193343.3,195315.96,197314.26,199312.56,201310.86,203309.16,205307.46,207305.76,209304.06,211302.36,213300.66,215298.96,217297.26,219295.56,221319.84,223344.12,225368.4,227392.68,229416.96,231441.24,233465.52,235489.8,237514.08,239538.36,241562.64,243586.92,245637.51,247688.1,249738.69,251789.28,253839.87,255890.46,257941.05,259991.64,262042.23,264092.82,266143.41,268194,270271.25,272348.5,274425.75,276503,278580.25,280657.5,282734.75,284812,286889.25,288966.5,291043.75,293121,295225.26,297329.52,299433.78,301538.04,303642.3,305746.56,307850.82,309955.08,312059.34,314163.6,316267.86,318372.12,320503.73,322635.34,324766.95,326898.56,329030.17,331161.78,333293.39,335425,337556.61,339688.22,341819.83,343951.44,346110.76,348270.08,350429.4,352588.72,354748.04,356907.36,359066.68,361226,363385.32,365544.64,367703.96,369863.28,372050.67,374238.06,376425.45,378612.84,380800.23,382987.62,385175.01,387362.4,389549.79,391737.18,393924.57,396111.96,398327.79,400543.62,402759.45,404975.28,407191.11,409406.94,411622.77,413838.6,416054.43,418270.26,420486.09,422701.92,424946.56,427191.2,429435.84,431680.48,433925.12,436169.76,438414.4,440659.04,442903.68,445148.32,447392.96,449637.6,451911.42,454185.24,456459.06,458732.88,461006.7,463280.52,465554.34,467828.16,470101.98,472375.8,474649.62,476923.44,479226.82,481530.2,483833.58,486136.96,488440.34,490743.72,493047.1,495350.48,497653.86,499957.24,502260.62,504564,506897.32,509230.64,511563.96,513897.28,516230.6,518563.92,520897.24,523230.56,525563.88,527897.2,530230.52,532563.84,534927.49,537291.14,539654.79,542018.4399999999,544382.09,546745.74,549109.39,551473.04,553836.6899999999,556200.34,558563.99,560927.64,563322.02,565716.4,568110.78,570505.16,572899.54,575293.92,577688.3,580082.6800000001,582477.0600000001,584871.4399999999,587265.8199999999,589660.2,592085.71,594511.22,596936.73,599362.24,601787.75,604213.26,606638.77,609064.28,611489.79,613915.3,616340.8100000001,618766.3199999999,621223.36,623680.4,626137.4399999999,628594.48,631051.52,633508.5600000001,635965.6,638422.64,640879.6800000001,643336.72,645793.76,648250.8,650739.78,653228.76,655717.74,658206.72,660695.7,663184.6800000001,665673.66,668162.64,670651.62,673140.6,675629.58,678118.5600000001,680639.9,683161.24,685682.58,688203.92,690725.26,693246.6,695767.9399999999,698289.28,700810.62,703331.96,705853.3,708374.64,710928.75,713482.86,716036.97,718591.08,721145.1899999999,723699.3,726253.41,728807.52,731361.63,733915.74,736469.85,739023.96,741611.28,744198.6,746785.92,749373.24,751960.5600000001,754547.88,757135.2,759722.52,762309.84,764897.16,767484.48,770071.8,772692.75,775313.7,777934.65,780555.6],[217688.69,219063.41,219712.56,220366.65,221025.71,221689.78,222358.89,223033.09,223712.4,224396.86,225086.52,225781.38,226481.52,227186.95,227897.72,228613.86,229335.41,230062.41,230794.9,231532.91,232276.48,233025.67,233780.49,234541.01,235307.23,236079.23,236857.03,237640.67,238430.21,239225.66,240027.09,240834.52,241648.02,242467.61,243293.34,244125.26,244963.39,245807.8,246658.52,247515.6,248379.09,249249.02,250125.45,251008.43,251897.97,252794.16,253697.03,254606.62,255522.98,256446.17,257376.23,258313.2,259257.15,260208.1,261166.12,262131.26,263102.93,264079.77,265061.81,266049.1,267041.66,268039.51,269042.68,270051.22,271065.14,272084.48,273109.25,274139.51,275175.28,276216.59,277263.48,278315.97,279374.08,280437.87,281507.36,282582.57,283663.55,284750.32,285842.92,286941.39,288045.75,289156.03,290272.28,291394.52,292522.8,293657.13,294797.55,295944.11,297096.84,298255.77,299420.94,300592.38,301770.12,302954.2,304144.67,305341.54,306544.87,307754.69,308971.02,310193.92,311423.42,312659.56,313902.35,315151.87,316408.13,317671.19,318941.05,320217.79,321501.43,322792.01,324089.57,325394.14,326705.78,328024.52,329350.4,330683.46,332023.74,333371.28,334726.12,336088.3,337457.87,338834.87,340219.34,341611.32,343010.85,344417.98,345832.75,347255.2,348685.37,350123.32,351569.08,353022.7,354484.22,355953.69,357431.15,358916.65,360410.24,361911.95,363421.83,364939.94,366466.31,368000.99,369544.05,371095.51,372655.42,374223.84,375800.81,377386.39,378980.6,380583.53,382195.19,383815.66,385444.97,387083.18,388730.33,390386.49,392051.69,393726,395409.45,397102.11,398804.02,400515.25,402235.83,403965.83,405705.3,407454.28,409212.84,410981.04,412758.9,414546.52,416343.92,418151.18,419968.33,421795.45,423632.6,425479.8,427337.14,429204.68,431082.46,432970.54,434868.98,436777.85,438697.2,440627.08,442567.56,444518.71,446480.57,448453.22,450436.71,452431.09,454436.46,456452.83,458480.31,460518.93,462568.77,464629.89,466702.36,468786.23,470881.57,472988.45,475106.94,477237.09,479378.97,481532.66,483696.97,485871.01,488054.81,490248.44,492451.92,494665.32,496888.65,499121.98,501365.36,503618.8,505882.38,508156.14,510440.11,512734.36,515038.9,517353.81,519679.13,522014.9,524361.16,526717.96,529085.37,531463.42,533852.15,536251.62,538661.86,541082.95,543514.92,545957.8199999999,548411.7,550876.6,553352.59,555839.7,558338,560847.52,563368.33,565900.46,568443.97,570998.92,573565.34,576143.3100000001,578732.86,581334.05,583946.9300000001,586571.5600000001,589207.98,591856.25,594516.4300000001,597188.5699999999,599872.7,602568.91,605277.24,607997.74,610730.45,613475.46,616232.8100000001,619002.55,621784.74,624579.42,627386.6800000001,630206.55,633039.1,635884.37,638742.4399999999,641613.36,644497.17,647393.9399999999,650303.74,653226.62,656162.62,659111.83,662074.3,665050.08,668039.23,671041.8199999999,674057.91,677087.55,680130.8100000001,683187.75,686258.42,689342.9,692441.24,695553.51,698679.77,701820.0699999999,704974.49,708143.09,711325.9300000001,714523.08,717734.6,720960.55,724201,727456.02,730725.66,734010,737309.1,740623.04,743951.86,747295.65,750654.47,754028.39,757417.47,760821.78,764241.39,767676.37,771126.79,774592.73,778074.23,781571.38,785084.26,788612.9300000001,792157.45,795717.9,799294.36,802886.9,806495.58,810120.47,813761.67,817419.22,821093.22,824783.74,828490.83,832214.59,835955.09,839712.39,843486.59,847277.76,851085.95,854911.27,858753.78,862613.5600000001,866490.6899999999,870385.25,874297.3,878226.95,882174.25,886139.3,890122.17,894122.9399999999,898141.6899999999,902178.51,906233.46,910306.64,914398.14,918508.02,922636.38,926783.28,930948.83,935133.1,939336.1800000001,943558.15,947799.09,952059.11,956338.25,960636.64,964954.35,969291.47]],"container":"<table class=\"cell-border stripe\">\n  <thead>\n    <tr>\n      <th>Month<\/th>\n      <th>TRS Monthly Benefit (USD)<\/th>\n      <th>ORP Monthly Payment (USD)<\/th>\n      <th>Total Portfolio (USD)<\/th>\n      <th>Accumulated TRS Payments (USD)<\/th>\n      <th>ORP Payment + Total Portfolio (USD)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":12,"dom":"lfrtip","columnDefs":[{"className":"dt-center","targets":"_all"},{"name":"Month","targets":0},{"name":"TRS_Monthly_Benefit","targets":1},{"name":"ORP_Monthly_Payment","targets":2},{"name":"Total_Portfolio","targets":3},{"name":"Accumulated_TRS_Payments","targets":4},{"name":"ORP_Payment_with_Total","targets":5}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,12,25,50,100],"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[0]; $(this.api().cell(row, 0).node()).css({'text-align':'center'});\nvar value=data[1]; $(this.api().cell(row, 1).node()).css({'text-align':'center'});\nvar value=data[2]; $(this.api().cell(row, 2).node()).css({'text-align':'center'});\nvar value=data[3]; $(this.api().cell(row, 3).node()).css({'text-align':'center'});\nvar value=data[4]; $(this.api().cell(row, 4).node()).css({'text-align':'center'});\nvar value=data[5]; $(this.api().cell(row, 5).node()).css({'text-align':'center'});\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="comparison-of-monthly-payments-trs-vs-orp-1" class="level4">
<h4 class="anchored" data-anchor-id="comparison-of-monthly-payments-trs-vs-orp-1">Comparison of Monthly Payments: TRS vs ORP</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating age from retirement (65 years old)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span> comparison <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age =</span> <span class="dv">65</span> <span class="sc">+</span> (<span class="fu">as.numeric</span>(Month <span class="sc">-</span> <span class="fu">min</span>(Month)) <span class="sc">/</span> <span class="fl">365.25</span> <span class="sc">*</span> <span class="dv">12</span>) <span class="sc">/</span> <span class="dv">12</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot to compare the two monthly payments</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(comparison, <span class="fu">aes</span>(<span class="at">x =</span> Age)) <span class="sc">+</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> TRS_Monthly_Benefit, <span class="at">color =</span> <span class="st">"TRS Monthly Benefit"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> ORP_Monthly_Payment, <span class="at">color =</span> <span class="st">"ORP Monthly Payment"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Comparison of Monthly Payments: TRS vs ORP"</span>,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age (Years)"</span>,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Monthly Payment (USD)"</span>,</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Payment Type"</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"TRS Monthly Benefit"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"ORP Monthly Payment"</span> <span class="ot">=</span> <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">65</span>, <span class="dv">95</span>, <span class="at">by =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From the plot, we observe that pension payments under the two plans converge around the age of 90. Considering the average life expectancy in the USA is approximately 77.5 years, it is highly likely that, by withdrawing only 4% annually from the ORP pension fund, the individual will receive lower monthly payments compared to the TRS plan. However, the ORP plan offers the advantage of leaving a significant remaining balance in the pension fund, which can be passed on to heirs (such as children) after the individual’s death.</p>
</section>
<section id="visualization-of-comparison-of-accumulated-trs-payments-and-orp-payment-with-total-portfolio" class="level4">
<h4 class="anchored" data-anchor-id="visualization-of-comparison-of-accumulated-trs-payments-and-orp-payment-with-total-portfolio">Visualization of Comparison of Accumulated TRS Payments and ORP Payment with Total Portfolio</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding an Age column to the dataset</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span> comparison <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age =</span> <span class="dv">65</span> <span class="sc">+</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(Month, <span class="fu">as.Date</span>(<span class="st">"2024-01-01"</span>), <span class="at">units =</span> <span class="st">"days"</span>)) <span class="sc">/</span> <span class="fl">365.25</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot to compare Accumulated TRS Payments and ORP Payment with Total Portfolio</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(comparison, <span class="fu">aes</span>(<span class="at">x =</span> Age)) <span class="sc">+</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Accumulated_TRS_Payments, <span class="at">color =</span> <span class="st">"Accumulated TRS Payments"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> ORP_Payment_with_Total, <span class="at">color =</span> <span class="st">"ORP Payment + Total Portfolio"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Comparison of Accumulated TRS Payments and ORP Payment with Total Portfolio"</span>,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age (Years)"</span>,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Amount (USD)"</span>,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Legend"</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Accumulated TRS Payments"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"ORP Payment + Total Portfolio"</span> <span class="ot">=</span> <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">65</span>, <span class="dv">95</span>, <span class="at">by =</span> <span class="dv">2</span>), </span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.01</span>)</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This plot illustrates that, due to substantial investment growth in the ORP plan over 19 years of employment, the ORP plan eventually surpasses the traditional TRS plan.</p>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Based on the analysis conducted in this project, the choice between the Teachers Retirement System (TRS) and the Optional Retirement Plan (ORP) depends on the employee’s age, salary, expected lifetime, and risk tolerance.</p>
<section id="recommendation" class="level4">
<h4 class="anchored" data-anchor-id="recommendation">Recommendation</h4>
<p>For younger employees with a longer career horizon and higher risk tolerance: - <strong>ORP is recommended.</strong> - It offers higher potential growth through market-driven investments in equities and bonds. - Remaining funds can be passed to heirs, making ORP a strong option for wealth preservation. - However, returns are subject to market fluctuations, introducing variability in retirement income.</p>
<p>For older employees nearing retirement or those with low risk tolerance: - <strong>TRS is recommended.</strong> - TRS provides a guaranteed lifetime pension with predictable payments adjusted for inflation. - It ensures financial stability regardless of market conditions, making it a safer choice for those prioritizing security.</p>
</section>
<section id="final-guidance" class="level4">
<h4 class="anchored" data-anchor-id="final-guidance">Final Guidance</h4>
<p>Choose <strong>TRS</strong> for stability and guaranteed income. Opt for <strong>ORP</strong> if maximizing returns and leaving an inheritance align with your goals. Regularly reassess your plan based on life circumstances and market trends.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ayrama\.github\.io\/STA9750-2024-FALL\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>